function G1(D){D.innerHTML="";let U=document.createElement("div");U.className="header";let _=document.createElement("h1");_.textContent="Lithography Simulator";let F=document.createElement("span");F.className="subtitle",F.textContent="Fourier Optics / Aerial Image";let G=document.createElement("button");G.className="download-btn",G.textContent="Export PNG",U.append(_,F,G);let J=document.createElement("div");J.className="panel",J.dataset.panel="mask";let $=document.createElement("div");$.className="panel panel-heatmap",$.dataset.panel="view";let Q=document.createElement("div");Q.className="heatmap-container";let A=document.createElement("canvas");Q.appendChild(A),$.appendChild(Q);let K=document.createElement("div");K.className="panel panel-params",K.dataset.panel="params";let X=document.createElement("div");X.className="panel-title",X.textContent="Parameters",K.appendChild(X);let j=document.createElement("div");j.className="timing-readout",j.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,K.appendChild(j);let V=document.createElement("div");V.className="zoom-bar";let W=document.createElement("button");W.className="zoom-btn",W.textContent="−";let L=document.createElement("input");L.type="range",L.className="zoom-slider",L.min="0.5",L.max="4",L.step="0.1",L.value="1";let M=document.createElement("button");M.className="zoom-btn",M.textContent="+";let T=document.createElement("span");T.className="zoom-label",T.textContent="100%",V.append(W,L,M,T),Q.appendChild(V);let q=document.createElement("div");q.className="mobile-tab-bar";let O=[{key:"mask",label:"Mask"},{key:"view",label:"View"},{key:"params",label:"Params"}],C=[];for(let H of O){let Z=document.createElement("button");Z.className="mobile-tab-btn",Z.textContent=H.label,Z.dataset.tab=H.key,Z.addEventListener("click",()=>{D.dataset.activeTab=H.key;for(let w of C)w.classList.toggle("active",w.dataset.tab===H.key)}),C.push(Z),q.appendChild(Z)}return D.dataset.activeTab="view",C[1].classList.add("active"),D.append(U,J,$,K,q),{maskPanel:J,heatmapCanvas:A,paramsPanel:K,timingReadout:j,zoomSlider:L,zoomInBtn:M,zoomOutBtn:W,zoomLabel:T,heatmapContainer:Q,mobileTabBar:q,downloadBtn:G}}var _1=[],e=!1,n={wavelength:248,na:0.75,sigma:0.5,defocus:0},f={mask:new Float32Array(65536),params:{...n}};function t(){if(e)return;e=!0,requestAnimationFrame(()=>{e=!1;for(let D of _1)D(f)})}function x(){return f}function J1(D){_1.push(D)}function m(D){f.mask=D,t()}function Q1(D,U){f.params[D]=U,t()}function $1(){Object.assign(f.params,n),t()}function p(){return new Float32Array(65536)}function M1(){let D=p(),U=10,_=5;for(let F=0;F<256;F++)for(let G=0;G<256;G++)if(G%10<5)D[F*256+G]=1;return D}function T1(){let D=p(),U=20,_=6,F=Math.floor(7);for(let G=0;G<256;G++)for(let J=0;J<256;J++){let $=G%20,Q=J%20;if($>=F&&$<F+6&&Q>=F&&Q<F+6)D[G*256+J]=1}return D}function I1(){let D=p(),U=6,_=125,F=131;for(let G=0;G<256;G++)for(let J=125;J<131;J++)D[G*256+J]=1;return D}function P1(){let D=p(),U=5,_=2;for(let F=0;F<256;F++)for(let G=0;G<256;G++)if(G%5<2)D[F*256+G]=1;return D}function R1(){let D=p(),U=128,_=128,F=60,G=10;for(let J=0;J<256;J++)for(let $=0;$<256;$++){let Q=J-128,A=$-128,K=A>=0&&A<60&&Q>=-5&&Q<5,X=Q>=0&&Q<60&&A>=-5&&A<5;if(K||X)D[J*256+$]=1}return D}var A1=[{name:"line_space",label:"Line/Space (10px)",generate:M1},{name:"contacts",label:"Contact Holes",generate:T1},{name:"isolated_line",label:"Isolated Line",generate:I1},{name:"dense_lines",label:"Dense Lines (5px)",generate:P1},{name:"l_shape",label:"L-Shape Corner",generate:R1}];var I=256;function C1(D,U){let _=U/2,F=[],G=Math.floor(U/2);switch(D){case"square":for(let J=-G;J<=G;J++)for(let $=-G;$<=G;$++)F.push([$,J]);break;case"circle":for(let J=-G;J<=G;J++)for(let $=-G;$<=G;$++)if($*$+J*J<=_*_)F.push([$,J]);break;case"ring":{let J=_*0.6;for(let $=-G;$<=G;$++)for(let Q=-G;Q<=G;Q++){let A=Q*Q+$*$;if(A<=_*_&&A>=J*J)F.push([Q,$])}break}case"cross":{let J=Math.max(1,Math.floor(U/6));for(let $=-G;$<=G;$++)for(let Q=-G;Q<=G;Q++)if(Math.abs(Q)<=J||Math.abs($)<=J)F.push([Q,$]);break}case"lineH":{let J=Math.max(1,Math.floor(U/6));for(let $=-J;$<=J;$++)for(let Q=-G;Q<=G;Q++)F.push([Q,$]);break}case"lineV":{let J=Math.max(1,Math.floor(U/6));for(let $=-G;$<=G;$++)for(let Q=-J;Q<=J;Q++)F.push([Q,$]);break}}return F}var w1=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function K1(D){let U=document.createElement("div");U.className="panel-title",U.textContent="Mask Editor",D.appendChild(U);let _=document.createElement("div");_.className="panel-mask",D.appendChild(_);let F=document.createElement("div");F.className="mask-canvas-wrap";let G=document.createElement("canvas");G.width=I,G.height=I,F.appendChild(G),_.appendChild(F);let J=G.getContext("2d"),$="brush",Q="square",A=20,K=!1,X=1;function j(){let Y=x().mask,E=J.createImageData(I,I),R=E.data;for(let P=0;P<I*I;P++){let u=Y[P]>0?255:0;R[P*4]=u,R[P*4+1]=u,R[P*4+2]=u,R[P*4+3]=255}J.putImageData(E,0,0)}function V(Y){let E=G.getBoundingClientRect(),R=I/E.width,P=I/E.height,u=Math.floor((Y.clientX-E.left)*R),b=Math.floor((Y.clientY-E.top)*P);return[Math.max(0,Math.min(I-1,u)),Math.max(0,Math.min(I-1,b))]}function W(Y,E,R){for(let P=-1;P<=1;P++)for(let u=-1;u<=1;u++){let b=Y+u,S=E+P;if(b>=0&&b<I&&S>=0&&S<I)R[S*I+b]=X}}function L(Y,E,R){let P=C1(Q,A);for(let[u,b]of P){let S=Y+u,s=E+b;if(S>=0&&S<I&&s>=0&&s<I)R[s*I+S]=X}}function M(Y){let[E,R]=V(Y),P=x().mask;if($==="stamp")L(E,R,P);else W(E,R,P);j(),m(P)}G.style.touchAction="none",G.addEventListener("pointerdown",(Y)=>{K=!0,X=Y.button===2?0:1,G.setPointerCapture(Y.pointerId),M(Y)}),G.addEventListener("pointermove",(Y)=>{if(K)M(Y)}),G.addEventListener("pointerup",(Y)=>{K=!1,G.releasePointerCapture(Y.pointerId)}),G.addEventListener("pointerleave",()=>{K=!1}),G.addEventListener("contextmenu",(Y)=>Y.preventDefault());let T=document.createElement("div");T.className="tool-toggle";let q=document.createElement("button");q.textContent="BRUSH",q.classList.add("active");let O=document.createElement("button");O.textContent="STAMP";function C(Y){$=Y,q.classList.toggle("active",Y==="brush"),O.classList.toggle("active",Y==="stamp"),H.style.display=Y==="stamp"?"":"none"}q.addEventListener("click",()=>C("brush")),O.addEventListener("click",()=>C("stamp")),T.append(q,O),_.appendChild(T);let H=document.createElement("div");H.className="stamp-options",H.style.display="none";let Z=document.createElement("div");Z.className="stamp-shape-row";let w=[];for(let Y of w1){let E=document.createElement("button");if(E.className="stamp-btn",E.textContent=Y.label,Y.key===Q)E.classList.add("active");E.addEventListener("click",()=>{Q=Y.key,w.forEach((R)=>R.classList.remove("active")),E.classList.add("active")}),w.push(E),Z.appendChild(E)}H.appendChild(Z);let y=document.createElement("div");y.className="param-group";let h=document.createElement("div");h.className="param-label";let z=document.createElement("span");z.className="param-name",z.textContent="Stamp Size";let k=document.createElement("span");k.className="param-value",k.textContent=String(A),h.append(z,k);let v=document.createElement("input");v.type="range",v.min="4",v.max="60",v.value=String(A),v.addEventListener("input",()=>{A=Number(v.value),k.textContent=String(A)}),y.append(h,v),H.appendChild(y),_.appendChild(H);let r=document.createElement("div");r.className="preset-buttons";let g=null;for(let Y of A1){let E=document.createElement("button");E.className="preset-btn",E.textContent=Y.label,E.addEventListener("click",()=>{let R=Y.generate();if(m(R),j(),g)g.classList.remove("active");E.classList.add("active"),g=E}),r.appendChild(E)}_.appendChild(r);let l=document.createElement("div");l.className="mask-tools";let d=document.createElement("button");d.textContent="CLEAR",d.addEventListener("click",()=>{if(m(new Float32Array(I*I)),j(),g)g.classList.remove("active");g=null});let i=document.createElement("button");return i.textContent="INVERT",i.addEventListener("click",()=>{let Y=x().mask;for(let E=0;E<I*I;E++)Y[E]=Y[E]>0?0:1;m(Y),j()}),l.append(d,i),_.appendChild(l),j(),{setDisplaySize(Y){G.style.width=Y+"px",G.style.height=Y+"px"}}}var a=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function u1(D){if(!Number.isFinite(D))return 128;return Math.round(Math.max(128,Math.min(768,D)))}function X1(D,U){let _=document.createElement("div");_.className="canvas-size-controls";let F=document.createElement("div");F.className="param-group";let G=document.createElement("div");G.className="param-label";let J=document.createElement("span");J.className="param-name",J.textContent="Canvas Size";let $=document.createElement("span");$.className="param-value";let Q=document.createElement("span");Q.className="param-unit",Q.textContent="px";let A=document.createElement("span");A.append($,Q),G.append(J,A);let K=document.createElement("input");K.type="range",K.min=String(128),K.max=String(768),K.step="1",K.value=String(384),F.append(G,K),_.appendChild(F);let X=document.createElement("div");X.className="size-preset-row";let j=[];for(let T of a){let q=document.createElement("button");q.className="stamp-btn",q.textContent=T.label,q.addEventListener("click",()=>M(T.size)),j.push(q),X.appendChild(q)}_.appendChild(X);let V=document.createElement("div");V.className="size-input-row";let W=document.createElement("input");W.type="number",W.className="size-text-input",W.min=String(128),W.max=String(768),W.value=String(384);let L=document.createElement("span");L.className="param-unit",L.textContent="px",W.addEventListener("change",()=>{M(Number(W.value))}),V.append(W,L),_.appendChild(V),D.appendChild(_);function M(T){let q=u1(T);K.value=String(q),$.textContent=String(q),W.value=String(q);for(let O=0;O<a.length;O++)j[O].classList.toggle("active",a[O].size===q);U(q)}K.addEventListener("input",()=>{M(Number(K.value))}),M(384)}var y1=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}];function Y1(D){let U=[];for(let F of y1){let G=document.createElement("div");G.className="param-group";let J=document.createElement("div");J.className="param-label";let $=document.createElement("span");$.className="param-name",$.textContent=F.label;let Q=document.createElement("span"),A=document.createElement("span");A.className="param-value";let K=document.createElement("span");K.className="param-unit",K.textContent=F.unit,Q.append(A,K),J.append($,Q);let X=document.createElement("input");X.type="range",X.min=String(F.min),X.max=String(F.max),X.step=String(F.step),X.value=String(x().params[F.key]);let j=(V)=>{A.textContent=V.toFixed(F.decimals)};j(x().params[F.key]),X.addEventListener("input",()=>{let V=parseFloat(X.value);j(V),Q1(F.key,V)}),G.append(J,X),D.appendChild(G),U.push({def:F,input:X,updateDisplay:j})}let _=document.createElement("button");_.className="reset-params-btn",_.textContent="Reset Defaults",_.addEventListener("click",()=>{$1();for(let{def:F,input:G,updateDisplay:J}of U){let $=n[F.key];G.value=String($),J($)}}),D.appendChild(_)}var H1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,E1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var B1=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function q1(){let D=new Uint8Array(1024);for(let U=0;U<256;U++){let _=B1[U];D[U*4+0]=_[0],D[U*4+1]=_[1],D[U*4+2]=_[2],D[U*4+3]=255}return D}var B=256;class U1{gl;program;intensityTex;colormapTex;vao;constructor(D){D.width=B,D.height=B;let U=D.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!U)throw Error("WebGL2 not supported");this.gl=U;let _=U.getExtension("EXT_color_buffer_float");this.program=this.createProgram(H1,E1),this.vao=U.createVertexArray(),this.intensityTex=U.createTexture(),U.bindTexture(U.TEXTURE_2D,this.intensityTex),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texImage2D(U.TEXTURE_2D,0,U.R32F,B,B,0,U.RED,U.FLOAT,null),this.colormapTex=U.createTexture(),U.bindTexture(U.TEXTURE_2D,this.colormapTex),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE);let F=q1();U.texImage2D(U.TEXTURE_2D,0,U.RGBA,256,1,0,U.RGBA,U.UNSIGNED_BYTE,F),U.useProgram(this.program),U.uniform1i(U.getUniformLocation(this.program,"uIntensity"),0),U.uniform1i(U.getUniformLocation(this.program,"uColormap"),1)}draw(D){let U=this.gl;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,this.intensityTex),U.texSubImage2D(U.TEXTURE_2D,0,0,0,B,B,U.RED,U.FLOAT,D),U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,this.colormapTex),U.useProgram(this.program),U.bindVertexArray(this.vao),U.viewport(0,0,B,B),U.drawArrays(U.TRIANGLES,0,3)}resize(D,U){}createProgram(D,U){let _=this.gl,F=this.compileShader(_.VERTEX_SHADER,D),G=this.compileShader(_.FRAGMENT_SHADER,U),J=_.createProgram();if(_.attachShader(J,F),_.attachShader(J,G),_.linkProgram(J),!_.getProgramParameter(J,_.LINK_STATUS)){let $=_.getProgramInfoLog(J);throw _.deleteProgram(J),Error("Shader link error: "+$)}return _.deleteShader(F),_.deleteShader(G),J}compileShader(D,U){let _=this.gl,F=_.createShader(D);if(_.shaderSource(F,U),_.compileShader(F),!_.getShaderParameter(F,_.COMPILE_STATUS)){let G=_.getShaderInfoLog(F);throw _.deleteShader(F),Error("Shader compile error: "+G)}return F}}function k1(D,U){let _=0;for(let F=0;F<U;F++)_=_<<1|D&1,D>>=1;return _}function v1(D){let U=Math.log2(D)|0,_=new Uint32Array(D);for(let F=0;F<D;F++)_[F]=k1(F,U);return _}var Z1=new Map,j1=new Map;function b1(D){let U=Z1.get(D);if(!U)U=v1(D),Z1.set(D,U);return U}function S1(D,U){let _=`${D}_${U?1:0}`,F=j1.get(_);if(!F){let G=D*2;F=new Float64Array(D*2);let $=(U?1:-1)*Math.PI/D;for(let Q=0;Q<D;Q++){let A=$*Q;F[Q*2]=Math.cos(A),F[Q*2+1]=Math.sin(A)}j1.set(_,F)}return F}function V1(D,U,_,F=0,G=1){let J=Math.log2(U)|0,$=b1(U);if(G===1&&F===0)for(let Q=0;Q<U;Q++){let A=$[Q];if(A>Q){let K=Q*2,X=A*2,j=D[K];D[K]=D[X],D[X]=j,j=D[K+1],D[K+1]=D[X+1],D[X+1]=j}}else{let Q=new Float64Array(U*2);for(let A=0;A<U;A++){let K=(F+A*G)*2,X=$[A]*2;Q[X]=D[K],Q[X+1]=D[K+1]}for(let A=0;A<U;A++){let K=(F+A*G)*2;D[K]=Q[A*2],D[K+1]=Q[A*2+1]}}for(let Q=1;Q<=J;Q++){let A=1<<Q,K=A>>1,X=S1(K,_);for(let j=0;j<U;j+=A)for(let V=0;V<K;V++){let W=(F+(j+V)*G)*2,L=(F+(j+V+K)*G)*2,M=X[V*2],T=X[V*2+1],q=D[L],O=D[L+1],C=M*q-T*O,H=M*O+T*q,Z=D[W],w=D[W+1];D[W]=Z+C,D[W+1]=w+H,D[L]=Z-C,D[L+1]=w-H}}if(_){let Q=1/U;for(let A=0;A<U;A++){let K=(F+A*G)*2;D[K]*=Q,D[K+1]*=Q}}}function D1(D,U,_){let F=new Float64Array(U*2);for(let J=0;J<U;J++){let $=J*U*2;F.set(D.subarray($,$+U*2)),V1(F,U,_),D.set(F,$)}let G=new Float64Array(U*2);for(let J=0;J<U;J++){for(let $=0;$<U;$++)G[$*2]=D[($*U+J)*2],G[$*2+1]=D[($*U+J)*2+1];V1(G,U,_);for(let $=0;$<U;$++)D[($*U+J)*2]=G[$*2],D[($*U+J)*2+1]=G[$*2+1]}}function F1(D,U){let _=U>>1;for(let F=0;F<_;F++)for(let G=0;G<U;G++){let J=F+_,$=(G+_)%U,Q=(F*U+G)*2,A=(J*U+$)*2,K=D[Q];D[Q]=D[A],D[A]=K,K=D[Q+1],D[Q+1]=D[A+1],D[A+1]=K}}function W1(D,U,_){let{wavelength:F,na:G,sigma:J,defocus:$}=_,Q=19.53125,A=1/(U*19.53125),X=G*(1+J)/F,j=X*X,V=$*1000,W=Math.PI*F*V,L=U>>1;for(let M=0;M<U;M++){let T=(M-L)*A,q=T*T;for(let O=0;O<U;O++){let C=(O-L)*A,H=C*C+q,Z=(M*U+O)*2;if(H>j)D[Z]=0,D[Z+1]=0;else if(V!==0){let w=W*H,y=Math.cos(w),h=Math.sin(w),z=D[Z],k=D[Z+1];D[Z]=z*y-k*h,D[Z+1]=z*h+k*y}}}}var c=256,N=c*c,o=null;function x1(){if(!o||o.length!==N*2)o=new Float64Array(N*2);return o}function L1(D,U){let _=performance.now(),F=x1();for(let Q=0;Q<N;Q++)F[Q*2]=D[Q],F[Q*2+1]=0;D1(F,c,!1),F1(F,c),W1(F,c,U),F1(F,c),D1(F,c,!0);let G=new Float32Array(N),J=0;for(let Q=0;Q<N;Q++){let A=F[Q*2],K=F[Q*2+1],X=A*A+K*K;if(G[Q]=X,X>J)J=X}if(J>0){let Q=1/J;for(let A=0;A<N;A++)G[A]*=Q}let $=performance.now()-_;return{intensity:G,timeMs:$}}function O1(){let D=document.getElementById("app"),{maskPanel:U,heatmapCanvas:_,paramsPanel:F,timingReadout:G,zoomSlider:J,zoomInBtn:$,zoomOutBtn:Q,zoomLabel:A,heatmapContainer:K,downloadBtn:X}=G1(D),j=K1(U),V=document.createElement("div");F.insertBefore(V,F.firstChild),X1(V,(H)=>{_.style.width=H+"px",_.style.height=H+"px"});let W=document.createElement("div");W.style.padding="10px 0",F.insertBefore(W,G),Y1(W);let L=new U1(_),M=document.getElementById("timing-sim"),T=document.getElementById("timing-render");J1((H)=>{let Z=L1(H.mask,H.params);M.textContent=Z.timeMs.toFixed(1);let w=performance.now();L.draw(Z.intensity);let y=performance.now()-w;T.textContent=y.toFixed(1)});let q=0;function O(H){if(q===0)q=_.offsetWidth;if(H===1)_.style.width="",_.style.height="",_.style.maxWidth="",_.style.maxHeight="",_.style.minWidth="",_.style.minHeight="";else{let Z=q*H;_.style.width=`${Z}px`,_.style.height=`${Z}px`,_.style.maxWidth="none",_.style.maxHeight="none",_.style.minWidth=`${Z}px`,_.style.minHeight=`${Z}px`}A.textContent=`${Math.round(H*100)}%`,J.value=String(H)}J.addEventListener("input",()=>{O(parseFloat(J.value))}),Q.addEventListener("click",()=>{let H=Math.max(0.5,parseFloat(J.value)-0.1);O(Math.round(H*10)/10)}),$.addEventListener("click",()=>{let H=Math.min(4,parseFloat(J.value)+0.1);O(Math.round(H*10)/10)}),X.addEventListener("click",()=>{let H=document.createElement("a"),Z=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);H.download=`lithography-simulation-${Z}.png`,H.href=_.toDataURL("image/png"),H.click()});let C=U.querySelector(".preset-btn");if(C)C.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",O1);else O1();
