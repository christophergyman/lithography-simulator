function $1(U){U.innerHTML="";let G=document.createElement("div");G.className="header";let J=document.createElement("h1");J.textContent="Lithography Simulator";let Q=document.createElement("span");Q.className="subtitle",Q.textContent="Fourier Optics / Aerial Image";let $=document.createElement("button");$.className="download-btn",$.textContent="Export PNG",G.append(J,Q,$);let Y=document.createElement("div");Y.className="panel",Y.dataset.panel="mask";let q=document.createElement("div");q.className="panel panel-heatmap",q.dataset.panel="view";let X=document.createElement("div");X.className="heatmap-container";let j=document.createElement("canvas");X.appendChild(j),q.appendChild(X);let K=document.createElement("div");K.className="panel panel-params",K.dataset.panel="params";let V=document.createElement("div");V.className="panel-title",V.textContent="Parameters",K.appendChild(V);let Z=document.createElement("div");Z.className="timing-readout",Z.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,K.appendChild(Z);let T=document.createElement("div");T.className="zoom-bar";let F=document.createElement("button");F.className="zoom-btn",F.textContent="−";let L=document.createElement("input");L.type="range",L.className="zoom-slider",L.min="0.5",L.max="4",L.step="0.1",L.value="1";let _=document.createElement("button");_.className="zoom-btn",_.textContent="+";let O=document.createElement("span");O.className="zoom-label",O.textContent="100%",T.append(F,L,_,O),X.appendChild(T);let H=document.createElement("div");H.className="mobile-tab-bar";let I=[{key:"mask",label:"Mask"},{key:"view",label:"View"},{key:"params",label:"Params"}],R=[];for(let W of I){let M=document.createElement("button");M.className="mobile-tab-btn",M.textContent=W.label,M.dataset.tab=W.key,M.addEventListener("click",()=>{U.dataset.activeTab=W.key;for(let w of R)w.classList.toggle("active",w.dataset.tab===W.key)}),R.push(M),H.appendChild(M)}return U.dataset.activeTab="view",R[1].classList.add("active"),U.append(G,Y,q,K,H),{maskPanel:Y,heatmapCanvas:j,paramsPanel:K,timingReadout:Z,zoomSlider:L,zoomInBtn:_,zoomOutBtn:F,zoomLabel:O,heatmapContainer:X,mobileTabBar:H,downloadBtn:$}}var f={z4:0,z5:0,z6:0,z7:0,z8:0,z9:0,z10:0,z11:0};function C1(U){return 1.7320508075688772*(2*U*U-1)}function R1(U,G){return 2.449489742783178*U*U*Math.sin(2*G)}function w1(U,G){return 2.449489742783178*U*U*Math.cos(2*G)}function B1(U,G){return 2.8284271247461903*(3*U*U*U-2*U)*Math.sin(G)}function y1(U,G){return 2.8284271247461903*(3*U*U*U-2*U)*Math.cos(G)}function k1(U){let G=U*U;return 2.23606797749979*(6*G*G-6*G+1)}function x1(U,G){return 2.8284271247461903*U*U*U*Math.sin(3*G)}function v1(U,G){return 2.8284271247461903*U*U*U*Math.cos(3*G)}function X1(U,G,J){let Q=0;if(J.z4!==0)Q+=J.z4*C1(U);if(J.z5!==0)Q+=J.z5*R1(U,G);if(J.z6!==0)Q+=J.z6*w1(U,G);if(J.z7!==0)Q+=J.z7*B1(U,G);if(J.z8!==0)Q+=J.z8*y1(U,G);if(J.z9!==0)Q+=J.z9*k1(U);if(J.z10!==0)Q+=J.z10*x1(U,G);if(J.z11!==0)Q+=J.z11*v1(U,G);return Q}var Y1=256,q1=[],a=!1,o={wavelength:248,na:0.75,sigma:0.5,defocus:0,zernike:{...f}},h={mask:new Float32Array(Y1*Y1),params:{...o,zernike:{...f}}};function n(){if(a)return;a=!0,requestAnimationFrame(()=>{a=!1;for(let U of q1)U(h)})}function b(){return h}function j1(U){q1.push(U)}function d(U){h.mask=U,n()}function K1(U,G){h.params[U]=G,n()}function V1(U,G){h.params.zernike[U]=G,n()}function H1(){Object.assign(h.params,o),h.params.zernike={...f},n()}function l(){return new Float32Array(65536)}function b1(){let U=l(),G=10,J=5;for(let Q=0;Q<256;Q++)for(let $=0;$<256;$++)if($%10<5)U[Q*256+$]=1;return U}function S1(){let U=l(),G=20,J=6,Q=Math.floor(7);for(let $=0;$<256;$++)for(let Y=0;Y<256;Y++){let q=$%20,X=Y%20;if(q>=Q&&q<Q+6&&X>=Q&&X<Q+6)U[$*256+Y]=1}return U}function z1(){let U=l(),G=6,J=125,Q=131;for(let $=0;$<256;$++)for(let Y=125;Y<131;Y++)U[$*256+Y]=1;return U}function N1(){let U=l(),G=5,J=2;for(let Q=0;Q<256;Q++)for(let $=0;$<256;$++)if($%5<2)U[Q*256+$]=1;return U}function g1(){let U=l(),G=128,J=128,Q=60,$=10;for(let Y=0;Y<256;Y++)for(let q=0;q<256;q++){let X=Y-128,j=q-128,K=j>=0&&j<60&&X>=-5&&X<5,V=X>=0&&X<60&&j>=-5&&j<5;if(K||V)U[Y*256+q]=1}return U}var Z1=[{name:"line_space",label:"Line/Space (10px)",generate:b1},{name:"contacts",label:"Contact Holes",generate:S1},{name:"isolated_line",label:"Isolated Line",generate:z1},{name:"dense_lines",label:"Dense Lines (5px)",generate:N1},{name:"l_shape",label:"L-Shape Corner",generate:g1}];var P=256;function u1(U,G){let J=G/2,Q=[],$=Math.floor(G/2);switch(U){case"square":for(let Y=-$;Y<=$;Y++)for(let q=-$;q<=$;q++)Q.push([q,Y]);break;case"circle":for(let Y=-$;Y<=$;Y++)for(let q=-$;q<=$;q++)if(q*q+Y*Y<=J*J)Q.push([q,Y]);break;case"ring":{let Y=J*0.6;for(let q=-$;q<=$;q++)for(let X=-$;X<=$;X++){let j=X*X+q*q;if(j<=J*J&&j>=Y*Y)Q.push([X,q])}break}case"cross":{let Y=Math.max(1,Math.floor(G/6));for(let q=-$;q<=$;q++)for(let X=-$;X<=$;X++)if(Math.abs(X)<=Y||Math.abs(q)<=Y)Q.push([X,q]);break}case"lineH":{let Y=Math.max(1,Math.floor(G/6));for(let q=-Y;q<=Y;q++)for(let X=-$;X<=$;X++)Q.push([X,q]);break}case"lineV":{let Y=Math.max(1,Math.floor(G/6));for(let q=-$;q<=$;q++)for(let X=-Y;X<=Y;X++)Q.push([X,q]);break}}return Q}var c1=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function _1(U){let G=document.createElement("div");G.className="panel-title",G.textContent="Mask Editor",U.appendChild(G);let J=document.createElement("div");J.className="panel-mask",U.appendChild(J);let Q=document.createElement("div");Q.className="mask-canvas-wrap";let $=document.createElement("canvas");$.width=P,$.height=P,Q.appendChild($),J.appendChild(Q);let Y=$.getContext("2d"),q="brush",X="square",j=20,K=!1,V=1;function Z(){let A=b().mask,D=Y.createImageData(P,P),C=D.data;for(let E=0;E<P*P;E++){let y=A[E]>0?255:0;C[E*4]=y,C[E*4+1]=y,C[E*4+2]=y,C[E*4+3]=255}Y.putImageData(D,0,0)}function T(A){let D=$.getBoundingClientRect(),C=P/D.width,E=P/D.height,y=Math.floor((A.clientX-D.left)*C),u=Math.floor((A.clientY-D.top)*E);return[Math.max(0,Math.min(P-1,y)),Math.max(0,Math.min(P-1,u))]}function F(A,D,C){for(let E=-1;E<=1;E++)for(let y=-1;y<=1;y++){let u=A+y,c=D+E;if(u>=0&&u<P&&c>=0&&c<P)C[c*P+u]=V}}function L(A,D,C){let E=u1(X,j);for(let[y,u]of E){let c=A+y,e=D+u;if(c>=0&&c<P&&e>=0&&e<P)C[e*P+c]=V}}function _(A){let[D,C]=T(A),E=b().mask;if(q==="stamp")L(D,C,E);else F(D,C,E);Z(),d(E)}$.style.touchAction="none",$.addEventListener("pointerdown",(A)=>{K=!0,V=A.button===2?0:1,$.setPointerCapture(A.pointerId),_(A)}),$.addEventListener("pointermove",(A)=>{if(K)_(A)}),$.addEventListener("pointerup",(A)=>{K=!1,$.releasePointerCapture(A.pointerId)}),$.addEventListener("pointerleave",()=>{K=!1}),$.addEventListener("contextmenu",(A)=>A.preventDefault());let O=document.createElement("div");O.className="tool-toggle";let H=document.createElement("button");H.textContent="BRUSH",H.classList.add("active");let I=document.createElement("button");I.textContent="STAMP";function R(A){q=A,H.classList.toggle("active",A==="brush"),I.classList.toggle("active",A==="stamp"),W.style.display=A==="stamp"?"":"none"}H.addEventListener("click",()=>R("brush")),I.addEventListener("click",()=>R("stamp")),O.append(H,I),J.appendChild(O);let W=document.createElement("div");W.className="stamp-options",W.style.display="none";let M=document.createElement("div");M.className="stamp-shape-row";let w=[];for(let A of c1){let D=document.createElement("button");if(D.className="stamp-btn",D.textContent=A.label,A.key===X)D.classList.add("active");D.addEventListener("click",()=>{X=A.key,w.forEach((C)=>C.classList.remove("active")),D.classList.add("active")}),w.push(D),M.appendChild(D)}W.appendChild(M);let x=document.createElement("div");x.className="param-group";let k=document.createElement("div");k.className="param-label";let S=document.createElement("span");S.className="param-name",S.textContent="Stamp Size";let z=document.createElement("span");z.className="param-value",z.textContent=String(j),k.append(S,z);let B=document.createElement("input");B.type="range",B.min="4",B.max="60",B.value=String(j),B.addEventListener("input",()=>{j=Number(B.value),z.textContent=String(j)}),x.append(k,B),W.appendChild(x),J.appendChild(W);let N=document.createElement("div");N.className="preset-buttons";let v=null;for(let A of Z1){let D=document.createElement("button");D.className="preset-btn",D.textContent=A.label,D.addEventListener("click",()=>{let C=A.generate();if(d(C),Z(),v)v.classList.remove("active");D.classList.add("active"),v=D}),N.appendChild(D)}J.appendChild(N);let i=document.createElement("div");i.className="mask-tools";let s=document.createElement("button");s.textContent="CLEAR",s.addEventListener("click",()=>{if(d(new Float32Array(P*P)),Z(),v)v.classList.remove("active");v=null});let t=document.createElement("button");return t.textContent="INVERT",t.addEventListener("click",()=>{let A=b().mask;for(let D=0;D<P*P;D++)A[D]=A[D]>0?0:1;d(A),Z()}),i.append(s,t),J.appendChild(i),Z(),{setDisplaySize(A){$.style.width=A+"px",$.style.height=A+"px"}}}var G1=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function h1(U){if(!Number.isFinite(U))return 128;return Math.round(Math.max(128,Math.min(768,U)))}function A1(U,G){let J=document.createElement("div");J.className="canvas-size-controls";let Q=document.createElement("div");Q.className="param-group";let $=document.createElement("div");$.className="param-label";let Y=document.createElement("span");Y.className="param-name",Y.textContent="Canvas Size";let q=document.createElement("span");q.className="param-value";let X=document.createElement("span");X.className="param-unit",X.textContent="px";let j=document.createElement("span");j.append(q,X),$.append(Y,j);let K=document.createElement("input");K.type="range",K.min=String(128),K.max=String(768),K.step="1",K.value=String(384),Q.append($,K),J.appendChild(Q);let V=document.createElement("div");V.className="size-preset-row";let Z=[];for(let O of G1){let H=document.createElement("button");H.className="stamp-btn",H.textContent=O.label,H.addEventListener("click",()=>_(O.size)),Z.push(H),V.appendChild(H)}J.appendChild(V);let T=document.createElement("div");T.className="size-input-row";let F=document.createElement("input");F.type="number",F.className="size-text-input",F.min=String(128),F.max=String(768),F.value=String(384);let L=document.createElement("span");L.className="param-unit",L.textContent="px",F.addEventListener("change",()=>{_(Number(F.value))}),T.append(F,L),J.appendChild(T),U.appendChild(J);function _(O){let H=h1(O);K.value=String(H),q.textContent=String(H),F.value=String(H);for(let I=0;I<G1.length;I++)Z[I].classList.toggle("active",G1[I].size===H);G(H)}K.addEventListener("input",()=>{_(Number(K.value))}),_(384)}var m1=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}],f1=[{key:"z4",label:"Defocus",noll:4},{key:"z5",label:"Oblq Astig",noll:5},{key:"z6",label:"Vert Astig",noll:6},{key:"z7",label:"Vert Coma",noll:7},{key:"z8",label:"Horz Coma",noll:8},{key:"z9",label:"Spherical",noll:9},{key:"z10",label:"Oblq Trefoil",noll:10},{key:"z11",label:"Vert Trefoil",noll:11}];function F1(U){let G=[];for(let j of m1){let K=document.createElement("div");K.className="param-group";let V=document.createElement("div");V.className="param-label";let Z=document.createElement("span");Z.className="param-name",Z.textContent=j.label;let T=document.createElement("span"),F=document.createElement("span");F.className="param-value";let L=document.createElement("span");L.className="param-unit",L.textContent=j.unit,T.append(F,L),V.append(Z,T);let _=document.createElement("input");_.type="range",_.min=String(j.min),_.max=String(j.max),_.step=String(j.step),_.value=String(b().params[j.key]);let O=(H)=>{F.textContent=H.toFixed(j.decimals)};O(b().params[j.key]),_.addEventListener("input",()=>{let H=parseFloat(_.value);O(H),K1(j.key,H)}),K.append(V,_),U.appendChild(K),G.push({def:j,input:_,updateDisplay:O})}let J=document.createElement("div");J.className="aberration-section";let Q=document.createElement("button");Q.className="aberration-toggle",Q.innerHTML='<span class="aberration-arrow">▶</span> Aberrations (Zernike)';let $=!1,Y=document.createElement("div");Y.className="aberration-body",Y.style.display="none";let q=[];for(let j of f1){let K=document.createElement("div");K.className="param-group zernike-group";let V=document.createElement("div");V.className="param-label";let Z=document.createElement("span");Z.className="param-name",Z.textContent=`Z${j.noll} ${j.label}`;let T=document.createElement("span"),F=document.createElement("span");F.className="param-value";let L=document.createElement("span");L.className="param-unit",L.textContent="λ",T.append(F,L),V.append(Z,T);let _=document.createElement("input");_.type="range",_.min="-1",_.max="1",_.step="0.01",_.value=String(b().params.zernike[j.key]);let O=(H)=>{F.textContent=H.toFixed(2)};O(b().params.zernike[j.key]),_.addEventListener("input",()=>{let H=parseFloat(_.value);O(H),V1(j.key,H)}),K.append(V,_),Y.appendChild(K),q.push({def:j,input:_,updateDisplay:O})}Q.addEventListener("click",()=>{$=!$,Y.style.display=$?"block":"none";let j=Q.querySelector(".aberration-arrow");j.textContent=$?"▼":"▶"}),J.append(Q,Y),U.appendChild(J);let X=document.createElement("button");X.className="reset-params-btn",X.textContent="Reset Defaults",X.addEventListener("click",()=>{H1();for(let{def:j,input:K,updateDisplay:V}of G){let Z=o[j.key];K.value=String(Z),V(Z)}for(let{def:j,input:K,updateDisplay:V}of q){let Z=f[j.key];K.value=String(Z),V(Z)}}),U.appendChild(X)}var W1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,D1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var p1=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function L1(){let U=new Uint8Array(1024);for(let G=0;G<256;G++){let J=p1[G];U[G*4+0]=J[0],U[G*4+1]=J[1],U[G*4+2]=J[2],U[G*4+3]=255}return U}var g=256;class U1{gl;program;intensityTex;colormapTex;vao;constructor(U){U.width=g,U.height=g;let G=U.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!G)throw Error("WebGL2 not supported");this.gl=G;let J=G.getExtension("EXT_color_buffer_float");this.program=this.createProgram(W1,D1),this.vao=G.createVertexArray(),this.intensityTex=G.createTexture(),G.bindTexture(G.TEXTURE_2D,this.intensityTex),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.NEAREST),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.NEAREST),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texImage2D(G.TEXTURE_2D,0,G.R32F,g,g,0,G.RED,G.FLOAT,null),this.colormapTex=G.createTexture(),G.bindTexture(G.TEXTURE_2D,this.colormapTex),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE);let Q=L1();G.texImage2D(G.TEXTURE_2D,0,G.RGBA,256,1,0,G.RGBA,G.UNSIGNED_BYTE,Q),G.useProgram(this.program),G.uniform1i(G.getUniformLocation(this.program,"uIntensity"),0),G.uniform1i(G.getUniformLocation(this.program,"uColormap"),1)}draw(U){let G=this.gl;G.activeTexture(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,this.intensityTex),G.texSubImage2D(G.TEXTURE_2D,0,0,0,g,g,G.RED,G.FLOAT,U),G.activeTexture(G.TEXTURE1),G.bindTexture(G.TEXTURE_2D,this.colormapTex),G.useProgram(this.program),G.bindVertexArray(this.vao),G.viewport(0,0,g,g),G.drawArrays(G.TRIANGLES,0,3)}resize(U,G){}createProgram(U,G){let J=this.gl,Q=this.compileShader(J.VERTEX_SHADER,U),$=this.compileShader(J.FRAGMENT_SHADER,G),Y=J.createProgram();if(J.attachShader(Y,Q),J.attachShader(Y,$),J.linkProgram(Y),!J.getProgramParameter(Y,J.LINK_STATUS)){let q=J.getProgramInfoLog(Y);throw J.deleteProgram(Y),Error("Shader link error: "+q)}return J.deleteShader(Q),J.deleteShader($),Y}compileShader(U,G){let J=this.gl,Q=J.createShader(U);if(J.shaderSource(Q,G),J.compileShader(Q),!J.getShaderParameter(Q,J.COMPILE_STATUS)){let $=J.getShaderInfoLog(Q);throw J.deleteShader(Q),Error("Shader compile error: "+$)}return Q}}function d1(U,G){let J=0;for(let Q=0;Q<G;Q++)J=J<<1|U&1,U>>=1;return J}function l1(U){let G=Math.log2(U)|0,J=new Uint32Array(U);for(let Q=0;Q<U;Q++)J[Q]=d1(Q,G);return J}var O1=new Map,M1=new Map;function o1(U){let G=O1.get(U);if(!G)G=l1(U),O1.set(U,G);return G}function n1(U,G){let J=`${U}_${G?1:0}`,Q=M1.get(J);if(!Q){let $=U*2;Q=new Float64Array(U*2);let q=(G?1:-1)*Math.PI/U;for(let X=0;X<U;X++){let j=q*X;Q[X*2]=Math.cos(j),Q[X*2+1]=Math.sin(j)}M1.set(J,Q)}return Q}function T1(U,G,J,Q=0,$=1){let Y=Math.log2(G)|0,q=o1(G);if($===1&&Q===0)for(let X=0;X<G;X++){let j=q[X];if(j>X){let K=X*2,V=j*2,Z=U[K];U[K]=U[V],U[V]=Z,Z=U[K+1],U[K+1]=U[V+1],U[V+1]=Z}}else{let X=new Float64Array(G*2);for(let j=0;j<G;j++){let K=(Q+j*$)*2,V=q[j]*2;X[V]=U[K],X[V+1]=U[K+1]}for(let j=0;j<G;j++){let K=(Q+j*$)*2;U[K]=X[j*2],U[K+1]=X[j*2+1]}}for(let X=1;X<=Y;X++){let j=1<<X,K=j>>1,V=n1(K,J);for(let Z=0;Z<G;Z+=j)for(let T=0;T<K;T++){let F=(Q+(Z+T)*$)*2,L=(Q+(Z+T+K)*$)*2,_=V[T*2],O=V[T*2+1],H=U[L],I=U[L+1],R=_*H-O*I,W=_*I+O*H,M=U[F],w=U[F+1];U[F]=M+R,U[F+1]=w+W,U[L]=M-R,U[L+1]=w-W}}if(J){let X=1/G;for(let j=0;j<G;j++){let K=(Q+j*$)*2;U[K]*=X,U[K+1]*=X}}}function J1(U,G,J){let Q=new Float64Array(G*2);for(let Y=0;Y<G;Y++){let q=Y*G*2;Q.set(U.subarray(q,q+G*2)),T1(Q,G,J),U.set(Q,q)}let $=new Float64Array(G*2);for(let Y=0;Y<G;Y++){for(let q=0;q<G;q++)$[q*2]=U[(q*G+Y)*2],$[q*2+1]=U[(q*G+Y)*2+1];T1($,G,J);for(let q=0;q<G;q++)U[(q*G+Y)*2]=$[q*2],U[(q*G+Y)*2+1]=$[q*2+1]}}function Q1(U,G){let J=G>>1;for(let Q=0;Q<J;Q++)for(let $=0;$<G;$++){let Y=Q+J,q=($+J)%G,X=(Q*G+$)*2,j=(Y*G+q)*2,K=U[X];U[X]=U[j],U[j]=K,K=U[X+1],U[X+1]=U[j+1],U[j+1]=K}}function I1(U,G,J){let{wavelength:Q,na:$,sigma:Y,defocus:q,zernike:X}=J,j=19.53125,K=1/(G*19.53125),Z=$*(1+Y)/Q,T=Z*Z,F=q*1000,L=Math.PI*Q*F,_=X.z4!==0||X.z5!==0||X.z6!==0||X.z7!==0||X.z8!==0||X.z9!==0||X.z10!==0||X.z11!==0,O=2*Math.PI,H=G>>1;for(let I=0;I<G;I++){let R=(I-H)*K,W=R*R;for(let M=0;M<G;M++){let w=(M-H)*K,x=w*w+W,k=(I*G+M)*2;if(x>T)U[k]=0,U[k+1]=0;else{let S=F!==0?L*x:0;if(_){let B=Math.sqrt(x)/Z,N=Math.atan2(R,w);S+=O*X1(B,N,X)}if(S!==0){let z=Math.cos(S),B=Math.sin(S),N=U[k],v=U[k+1];U[k]=N*z-v*B,U[k+1]=N*B+v*z}}}}}var m=256,p=m*m,r=null;function r1(){if(!r||r.length!==p*2)r=new Float64Array(p*2);return r}function P1(U,G){let J=performance.now(),Q=r1();for(let X=0;X<p;X++)Q[X*2]=U[X],Q[X*2+1]=0;J1(Q,m,!1),Q1(Q,m),I1(Q,m,G),Q1(Q,m),J1(Q,m,!0);let $=new Float32Array(p),Y=0;for(let X=0;X<p;X++){let j=Q[X*2],K=Q[X*2+1],V=j*j+K*K;if($[X]=V,V>Y)Y=V}if(Y>0){let X=1/Y;for(let j=0;j<p;j++)$[j]*=X}let q=performance.now()-J;return{intensity:$,timeMs:q}}function E1(){let U=document.getElementById("app"),{maskPanel:G,heatmapCanvas:J,paramsPanel:Q,timingReadout:$,zoomSlider:Y,zoomInBtn:q,zoomOutBtn:X,zoomLabel:j,heatmapContainer:K,downloadBtn:V}=$1(U),Z=_1(G),T=document.createElement("div");Q.insertBefore(T,Q.firstChild),A1(T,(W)=>{J.style.width=W+"px",J.style.height=W+"px"});let F=document.createElement("div");F.style.padding="10px 0",Q.insertBefore(F,$),F1(F);let L=new U1(J),_=document.getElementById("timing-sim"),O=document.getElementById("timing-render");j1((W)=>{let M=P1(W.mask,W.params);_.textContent=M.timeMs.toFixed(1);let w=performance.now();L.draw(M.intensity);let x=performance.now()-w;O.textContent=x.toFixed(1)});let H=0;function I(W){if(H===0)H=J.offsetWidth;if(W===1)J.style.width="",J.style.height="",J.style.maxWidth="",J.style.maxHeight="",J.style.minWidth="",J.style.minHeight="";else{let M=H*W;J.style.width=`${M}px`,J.style.height=`${M}px`,J.style.maxWidth="none",J.style.maxHeight="none",J.style.minWidth=`${M}px`,J.style.minHeight=`${M}px`}j.textContent=`${Math.round(W*100)}%`,Y.value=String(W)}Y.addEventListener("input",()=>{I(parseFloat(Y.value))}),X.addEventListener("click",()=>{let W=Math.max(0.5,parseFloat(Y.value)-0.1);I(Math.round(W*10)/10)}),q.addEventListener("click",()=>{let W=Math.min(4,parseFloat(Y.value)+0.1);I(Math.round(W*10)/10)}),V.addEventListener("click",()=>{let W=document.createElement("a"),M=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);W.download=`lithography-simulation-${M}.png`,W.href=J.toDataURL("image/png"),W.click()});let R=G.querySelector(".preset-btn");if(R)R.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",E1);else E1();
