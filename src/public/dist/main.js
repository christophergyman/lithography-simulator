function L1(F){F.innerHTML="";let _=document.createElement("div");_.className="header";let D=document.createElement("h1");D.textContent="Lithography Simulator";let A=document.createElement("span");A.className="subtitle",A.textContent="Fourier Optics / Aerial Image";let E=document.createElement("button");E.className="download-btn",E.textContent="Export PNG",_.append(D,A,E);let J=document.createElement("div");J.className="panel",J.dataset.panel="mask";let U=document.createElement("div");U.className="panel panel-heatmap",U.dataset.panel="view";let P=document.createElement("div");P.className="view-toggle";let Q=document.createElement("button");Q.textContent="Heatmap",Q.classList.add("active");let K=document.createElement("button");K.textContent="Bossung",P.append(Q,K),U.appendChild(P);let $=document.createElement("div");$.className="heatmap-container";let G=document.createElement("div");G.className="viz-toggle-bar";let q=[{key:"aerial",label:"Aerial"},{key:"resist",label:"Resist"},{key:"split",label:"Split"}],H=[];for(let b of q){let v=document.createElement("button");v.className="viz-toggle-btn",v.textContent=b.label,v.dataset.mode=b.key,H.push(v),G.appendChild(v)}let X=document.createElement("div");X.className="viz-toggle-sep",G.appendChild(X);let j=document.createElement("button");j.className="viz-toggle-btn",j.textContent="Cross-Section",j.dataset.mode="cs",G.appendChild(j);let R=document.createElement("div");R.className="viz-grid",R.appendChild(G);let Y=document.createElement("div");Y.className="viz-image-row";let V=document.createElement("div");V.className="viz-image-wrap";let I=document.createElement("div");I.className="viz-label",I.textContent="Aerial Image";let k=document.createElement("canvas"),O=document.createElement("div");O.className="cross-section-line",V.append(I,k,O);let L=document.createElement("div");L.className="viz-image-wrap";let h=document.createElement("div");h.className="viz-label",h.textContent="Resist Image";let y=document.createElement("canvas");L.append(h,y),Y.append(V,L);let S=document.createElement("div");S.className="cross-section-wrap";let f=document.createElement("canvas");f.className="cross-section-canvas",S.appendChild(f),R.append(Y,S),$.appendChild(R),U.appendChild($);let M=document.createElement("div");M.className="bossung-chart-container",M.style.display="none";let d=document.createElement("canvas");M.appendChild(d),U.appendChild(M);function z(b){let v=b==="heatmap";$.style.display=v?"":"none",M.style.display=v?"none":"flex",Q.classList.toggle("active",v),K.classList.toggle("active",!v)}Q.addEventListener("click",()=>z("heatmap")),K.addEventListener("click",()=>z("bossung")),M._showBossung=()=>z("bossung");let u="aerial",N=!1;function p(){for(let b of H)b.classList.toggle("active",b.dataset.mode===u);j.classList.toggle("active",N),V.style.display=u==="resist"?"none":"",L.style.display=u==="aerial"?"none":"",S.style.display=N?"":"none",O.style.display=N?"":"none"}function T(b){u=b,p()}function Z(){return N=!N,p(),N}for(let b of H)b.addEventListener("click",()=>{T(b.dataset.mode)});j.addEventListener("click",()=>{Z()}),p();let W=document.createElement("div");W.className="panel panel-params",W.dataset.panel="params";let w=document.createElement("div");w.className="panel-title",w.textContent="Parameters",W.appendChild(w);let B=document.createElement("div");B.className="timing-readout",B.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,W.appendChild(B);let g=document.createElement("div");g.className="zoom-bar";let m=document.createElement("button");m.className="zoom-btn",m.textContent="−";let c=document.createElement("input");c.type="range",c.className="zoom-slider",c.min="0.5",c.max="4",c.step="0.1",c.value="1";let a=document.createElement("button");a.className="zoom-btn",a.textContent="+";let D1=document.createElement("span");D1.className="zoom-label",D1.textContent="100%",g.append(m,c,a,D1),$.appendChild(g);let A1=document.createElement("div");A1.className="mobile-tab-bar";let g1=[{key:"mask",label:"Mask"},{key:"view",label:"View"},{key:"params",label:"Params"}],J1=[];for(let b of g1){let v=document.createElement("button");v.className="mobile-tab-btn",v.textContent=b.label,v.dataset.tab=b.key,v.addEventListener("click",()=>{F.dataset.activeTab=b.key;for(let O1 of J1)O1.classList.toggle("active",O1.dataset.tab===b.key)}),J1.push(v),A1.appendChild(v)}return F.dataset.activeTab="view",J1[1].classList.add("active"),F.append(_,J,U,W,A1),{maskPanel:J,heatmapCanvas:k,resistCanvas:y,crossSectionCanvas:f,crossSectionLine:O,heatmapWrap:V,resistWrap:L,crossSectionWrap:S,paramsPanel:W,timingReadout:B,zoomSlider:c,zoomInBtn:a,zoomOutBtn:m,zoomLabel:D1,heatmapContainer:$,mobileTabBar:A1,downloadBtn:E,setVizMode:T,toggleCrossSection:Z,bossungCanvas:d,bossungChartContainer:M}}var Y1={threshold:0.3,crossSectionRow:128},X1=[],Q1=!1,_1={wavelength:248,na:0.75,sigma:0.5,defocus:0},o={mask:new Float32Array(65536),params:{..._1},viewParams:{...Y1}};function F1(){if(Q1)return;Q1=!0,requestAnimationFrame(()=>{Q1=!1;for(let F of X1)F(o)})}function x(){return o}function j1(F){X1.push(F)}function t(F){o.mask=F,F1()}function V1(F,_){o.params[F]=_,F1()}function W1(F,_){o.viewParams[F]=_,F1()}function I1(){Object.assign(o.params,_1),Object.assign(o.viewParams,Y1),F1()}function e(){return new Float32Array(65536)}function p1(){let F=e(),_=10,D=5;for(let A=0;A<256;A++)for(let E=0;E<256;E++)if(E%10<5)F[A*256+E]=1;return F}function d1(){let F=e(),_=20,D=6,A=Math.floor(7);for(let E=0;E<256;E++)for(let J=0;J<256;J++){let U=E%20,P=J%20;if(U>=A&&U<A+6&&P>=A&&P<A+6)F[E*256+J]=1}return F}function l1(){let F=e(),_=6,D=125,A=131;for(let E=0;E<256;E++)for(let J=125;J<131;J++)F[E*256+J]=1;return F}function o1(){let F=e(),_=5,D=2;for(let A=0;A<256;A++)for(let E=0;E<256;E++)if(E%5<2)F[A*256+E]=1;return F}function r1(){let F=e(),_=128,D=128,A=60,E=10;for(let J=0;J<256;J++)for(let U=0;U<256;U++){let P=J-128,Q=U-128,K=Q>=0&&Q<60&&P>=-5&&P<5,$=P>=0&&P<60&&Q>=-5&&Q<5;if(K||$)F[J*256+U]=1}return F}var R1=[{name:"line_space",label:"Line/Space (10px)",generate:p1},{name:"contacts",label:"Contact Holes",generate:d1},{name:"isolated_line",label:"Isolated Line",generate:l1},{name:"dense_lines",label:"Dense Lines (5px)",generate:o1},{name:"l_shape",label:"L-Shape Corner",generate:r1}];var C=256;function n1(F,_){let D=_/2,A=[],E=Math.floor(_/2);switch(F){case"square":for(let J=-E;J<=E;J++)for(let U=-E;U<=E;U++)A.push([U,J]);break;case"circle":for(let J=-E;J<=E;J++)for(let U=-E;U<=E;U++)if(U*U+J*J<=D*D)A.push([U,J]);break;case"ring":{let J=D*0.6;for(let U=-E;U<=E;U++)for(let P=-E;P<=E;P++){let Q=P*P+U*U;if(Q<=D*D&&Q>=J*J)A.push([P,U])}break}case"cross":{let J=Math.max(1,Math.floor(_/6));for(let U=-E;U<=E;U++)for(let P=-E;P<=E;P++)if(Math.abs(P)<=J||Math.abs(U)<=J)A.push([P,U]);break}case"lineH":{let J=Math.max(1,Math.floor(_/6));for(let U=-J;U<=J;U++)for(let P=-E;P<=E;P++)A.push([P,U]);break}case"lineV":{let J=Math.max(1,Math.floor(_/6));for(let U=-E;U<=E;U++)for(let P=-J;P<=J;P++)A.push([P,U]);break}}return A}var i1=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function k1(F){let _=document.createElement("div");_.className="panel-title",_.textContent="Mask Editor",F.appendChild(_);let D=document.createElement("div");D.className="panel-mask",F.appendChild(D);let A=document.createElement("div");A.className="mask-canvas-wrap";let E=document.createElement("canvas");E.width=C,E.height=C,A.appendChild(E),D.appendChild(A);let J=E.getContext("2d"),U="brush",P="square",Q=20,K=!1,$=1;function G(){let T=x().mask,Z=J.createImageData(C,C),W=Z.data;for(let w=0;w<C*C;w++){let B=T[w]>0?255:0;W[w*4]=B,W[w*4+1]=B,W[w*4+2]=B,W[w*4+3]=255}J.putImageData(Z,0,0)}function q(T){let Z=E.getBoundingClientRect(),W=C/Z.width,w=C/Z.height,B=Math.floor((T.clientX-Z.left)*W),g=Math.floor((T.clientY-Z.top)*w);return[Math.max(0,Math.min(C-1,B)),Math.max(0,Math.min(C-1,g))]}function H(T,Z,W){for(let w=-1;w<=1;w++)for(let B=-1;B<=1;B++){let g=T+B,m=Z+w;if(g>=0&&g<C&&m>=0&&m<C)W[m*C+g]=$}}function X(T,Z,W){let w=n1(P,Q);for(let[B,g]of w){let m=T+B,c=Z+g;if(m>=0&&m<C&&c>=0&&c<C)W[c*C+m]=$}}function j(T){let[Z,W]=q(T),w=x().mask;if(U==="stamp")X(Z,W,w);else H(Z,W,w);G(),t(w)}E.style.touchAction="none",E.addEventListener("pointerdown",(T)=>{K=!0,$=T.button===2?0:1,E.setPointerCapture(T.pointerId),j(T)}),E.addEventListener("pointermove",(T)=>{if(K)j(T)}),E.addEventListener("pointerup",(T)=>{K=!1,E.releasePointerCapture(T.pointerId)}),E.addEventListener("pointerleave",()=>{K=!1}),E.addEventListener("contextmenu",(T)=>T.preventDefault());let R=document.createElement("div");R.className="tool-toggle";let Y=document.createElement("button");Y.textContent="BRUSH",Y.classList.add("active");let V=document.createElement("button");V.textContent="STAMP";function I(T){U=T,Y.classList.toggle("active",T==="brush"),V.classList.toggle("active",T==="stamp"),k.style.display=T==="stamp"?"":"none"}Y.addEventListener("click",()=>I("brush")),V.addEventListener("click",()=>I("stamp")),R.append(Y,V),D.appendChild(R);let k=document.createElement("div");k.className="stamp-options",k.style.display="none";let O=document.createElement("div");O.className="stamp-shape-row";let L=[];for(let T of i1){let Z=document.createElement("button");if(Z.className="stamp-btn",Z.textContent=T.label,T.key===P)Z.classList.add("active");Z.addEventListener("click",()=>{P=T.key,L.forEach((W)=>W.classList.remove("active")),Z.classList.add("active")}),L.push(Z),O.appendChild(Z)}k.appendChild(O);let h=document.createElement("div");h.className="param-group";let y=document.createElement("div");y.className="param-label";let S=document.createElement("span");S.className="param-name",S.textContent="Stamp Size";let f=document.createElement("span");f.className="param-value",f.textContent=String(Q),y.append(S,f);let M=document.createElement("input");M.type="range",M.min="4",M.max="60",M.value=String(Q),M.addEventListener("input",()=>{Q=Number(M.value),f.textContent=String(Q)}),h.append(y,M),k.appendChild(h),D.appendChild(k);let d=document.createElement("div");d.className="preset-buttons";let z=null;for(let T of R1){let Z=document.createElement("button");Z.className="preset-btn",Z.textContent=T.label,Z.addEventListener("click",()=>{let W=T.generate();if(t(W),G(),z)z.classList.remove("active");Z.classList.add("active"),z=Z}),d.appendChild(Z)}D.appendChild(d);let u=document.createElement("div");u.className="mask-tools";let N=document.createElement("button");N.textContent="CLEAR",N.addEventListener("click",()=>{if(t(new Float32Array(C*C)),G(),z)z.classList.remove("active");z=null});let p=document.createElement("button");return p.textContent="INVERT",p.addEventListener("click",()=>{let T=x().mask;for(let Z=0;Z<C*C;Z++)T[Z]=T[Z]>0?0:1;t(T),G()}),u.append(N,p),D.appendChild(u),G(),{setDisplaySize(T){E.style.width=T+"px",E.style.height=T+"px"}}}var $1=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function s1(F){if(!Number.isFinite(F))return 128;return Math.round(Math.max(128,Math.min(768,F)))}function w1(F,_){let D=document.createElement("div");D.className="canvas-size-controls";let A=document.createElement("div");A.className="param-group";let E=document.createElement("div");E.className="param-label";let J=document.createElement("span");J.className="param-name",J.textContent="Canvas Size";let U=document.createElement("span");U.className="param-value";let P=document.createElement("span");P.className="param-unit",P.textContent="px";let Q=document.createElement("span");Q.append(U,P),E.append(J,Q);let K=document.createElement("input");K.type="range",K.min=String(128),K.max=String(768),K.step="1",K.value=String(384),A.append(E,K),D.appendChild(A);let $=document.createElement("div");$.className="size-preset-row";let G=[];for(let R of $1){let Y=document.createElement("button");Y.className="stamp-btn",Y.textContent=R.label,Y.addEventListener("click",()=>j(R.size)),G.push(Y),$.appendChild(Y)}D.appendChild($);let q=document.createElement("div");q.className="size-input-row";let H=document.createElement("input");H.type="number",H.className="size-text-input",H.min=String(128),H.max=String(768),H.value=String(384);let X=document.createElement("span");X.className="param-unit",X.textContent="px",H.addEventListener("change",()=>{j(Number(H.value))}),q.append(H,X),D.appendChild(q),F.appendChild(D);function j(R){let Y=s1(R);K.value=String(Y),U.textContent=String(Y),H.value=String(Y);for(let V=0;V<$1.length;V++)G[V].classList.toggle("active",$1[V].size===Y);_(Y)}K.addEventListener("input",()=>{j(Number(K.value))}),j(384)}var t1=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}];function y1(F){let _=[];for(let A of t1){let E=document.createElement("div");E.className="param-group";let J=document.createElement("div");J.className="param-label";let U=document.createElement("span");U.className="param-name",U.textContent=A.label;let P=document.createElement("span"),Q=document.createElement("span");Q.className="param-value";let K=document.createElement("span");K.className="param-unit",K.textContent=A.unit,P.append(Q,K),J.append(U,P);let $=document.createElement("input");$.type="range",$.min=String(A.min),$.max=String(A.max),$.step=String(A.step),$.value=String(x().params[A.key]);let G=(q)=>{Q.textContent=q.toFixed(A.decimals)};G(x().params[A.key]),$.addEventListener("input",()=>{let q=parseFloat($.value);G(q),V1(A.key,q)}),E.append(J,$),F.appendChild(E),_.push({def:A,input:$,updateDisplay:G})}let D=document.createElement("button");D.className="reset-params-btn",D.textContent="Reset Defaults",D.addEventListener("click",()=>{I1();for(let{def:A,input:E,updateDisplay:J}of _){let U=_1[A.key];E.value=String(U),J(U)}}),F.appendChild(D)}var e1=[{key:"threshold",label:"Resist Threshold",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"crossSectionRow",label:"Cross-Section Row",unit:"px",min:0,max:255,step:1,decimals:0}];function M1(F){let _=[],D=document.createElement("div");D.className="panel-title",D.style.padding="8px 0 4px",D.style.border="none",D.textContent="Resist / Cross-Section",F.appendChild(D);for(let A of e1){let E=document.createElement("div");E.className="param-group";let J=document.createElement("div");J.className="param-label";let U=document.createElement("span");U.className="param-name",U.textContent=A.label;let P=document.createElement("span"),Q=document.createElement("span");Q.className="param-value";let K=document.createElement("span");K.className="param-unit",K.textContent=A.unit,P.append(Q,K),J.append(U,P);let $=document.createElement("input");$.type="range",$.min=String(A.min),$.max=String(A.max),$.step=String(A.step),$.value=String(x().viewParams[A.key]);let G=(q)=>{Q.textContent=q.toFixed(A.decimals)};G(x().viewParams[A.key]),$.addEventListener("input",()=>{let q=parseFloat($.value);G(q),W1(A.key,q)}),E.append(J,$),F.appendChild(E),_.push({def:A,input:$,updateDisplay:G})}return{syncFromState(){for(let{def:A,input:E,updateDisplay:J}of _){let U=x().viewParams[A.key];E.value=String(U),J(U)}}}}var C1=[{key:"focusSteps",label:"Focus Steps",unit:"",min:5,max:21,step:2,decimals:0,defaultValue:11},{key:"doseMin",label:"Dose Min",unit:"",min:0.5,max:1.5,step:0.05,decimals:2,defaultValue:0.7},{key:"doseMax",label:"Dose Max",unit:"",min:0.5,max:1.5,step:0.05,decimals:2,defaultValue:1.3},{key:"doseSteps",label:"Dose Steps",unit:"",min:3,max:9,step:1,decimals:0,defaultValue:7}];function B1(F,_){let D=document.createElement("div");D.className="bossung-section";let A=document.createElement("div");A.className="panel-title",A.style.padding="0 0 8px",A.style.border="none",A.textContent="Process Window",D.appendChild(A);let E=document.createElement("div");E.className="param-label",E.style.marginBottom="8px";let J=document.createElement("span");J.className="param-name",J.textContent="Focus Range";let U=document.createElement("span");U.innerHTML='<span class="param-value">-2.0</span> to <span class="param-value">+2.0</span> <span class="param-unit">μm</span>',E.append(J,U),D.appendChild(E);let P={};for(let q of C1)P[q.key]=q.defaultValue;for(let q of C1){let H=document.createElement("div");H.className="param-group";let X=document.createElement("div");X.className="param-label";let j=document.createElement("span");j.className="param-name",j.textContent=q.label;let R=document.createElement("span"),Y=document.createElement("span");Y.className="param-value",Y.textContent=q.defaultValue.toFixed(q.decimals);let V=document.createElement("span");V.className="param-unit",V.textContent=q.unit,R.append(Y,V),X.append(j,R);let I=document.createElement("input");I.type="range",I.min=String(q.min),I.max=String(q.max),I.step=String(q.step),I.value=String(q.defaultValue),I.addEventListener("input",()=>{let k=parseFloat(I.value);P[q.key]=k,Y.textContent=k.toFixed(q.decimals)}),H.append(X,I),D.appendChild(H)}let Q=document.createElement("button");Q.className="bossung-run-btn",Q.textContent="Run Bossung Analysis",Q.addEventListener("click",()=>{let q={focusRange:[-2,2],focusSteps:P.focusSteps,doseRange:[P.doseMin,P.doseMax],doseSteps:P.doseSteps};_(q)}),D.appendChild(Q);let K=document.createElement("div");K.className="bossung-timing",K.innerHTML='Sweep: <span class="value">--</span> ms (<span class="value bossung-runs">--</span> runs)',D.appendChild(K),F.appendChild(D);let $=K.querySelector(".value"),G=K.querySelector(".bossung-runs");return{setTiming(q,H){$.textContent=q.toFixed(1),G.textContent=String(H)},setRunning(q){Q.disabled=q,Q.textContent=q?"Running…":"Run Bossung Analysis"}}}var h1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,S1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var a1=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function b1(){let F=new Uint8Array(1024);for(let _=0;_<256;_++){let D=a1[_];F[_*4+0]=D[0],F[_*4+1]=D[1],F[_*4+2]=D[2],F[_*4+3]=255}return F}var l=256;class K1{gl;program;intensityTex;colormapTex;vao;constructor(F){F.width=l,F.height=l;let _=F.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!_)throw Error("WebGL2 not supported");this.gl=_;let D=_.getExtension("EXT_color_buffer_float");this.program=this.createProgram(h1,S1),this.vao=_.createVertexArray(),this.intensityTex=_.createTexture(),_.bindTexture(_.TEXTURE_2D,this.intensityTex),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texImage2D(_.TEXTURE_2D,0,_.R32F,l,l,0,_.RED,_.FLOAT,null),this.colormapTex=_.createTexture(),_.bindTexture(_.TEXTURE_2D,this.colormapTex),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE);let A=b1();_.texImage2D(_.TEXTURE_2D,0,_.RGBA,256,1,0,_.RGBA,_.UNSIGNED_BYTE,A),_.useProgram(this.program),_.uniform1i(_.getUniformLocation(this.program,"uIntensity"),0),_.uniform1i(_.getUniformLocation(this.program,"uColormap"),1)}draw(F){let _=this.gl;_.activeTexture(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,this.intensityTex),_.texSubImage2D(_.TEXTURE_2D,0,0,0,l,l,_.RED,_.FLOAT,F),_.activeTexture(_.TEXTURE1),_.bindTexture(_.TEXTURE_2D,this.colormapTex),_.useProgram(this.program),_.bindVertexArray(this.vao),_.viewport(0,0,l,l),_.drawArrays(_.TRIANGLES,0,3)}resize(F,_){}createProgram(F,_){let D=this.gl,A=this.compileShader(D.VERTEX_SHADER,F),E=this.compileShader(D.FRAGMENT_SHADER,_),J=D.createProgram();if(D.attachShader(J,A),D.attachShader(J,E),D.linkProgram(J),!D.getProgramParameter(J,D.LINK_STATUS)){let U=D.getProgramInfoLog(J);throw D.deleteProgram(J),Error("Shader link error: "+U)}return D.deleteShader(A),D.deleteShader(E),J}compileShader(F,_){let D=this.gl,A=D.createShader(F);if(D.shaderSource(A,_),D.compileShader(A),!D.getShaderParameter(A,D.COMPILE_STATUS)){let E=D.getShaderInfoLog(A);throw D.deleteShader(A),Error("Shader compile error: "+E)}return A}}class T1{ctx;imageData;constructor(F){F.width=256,F.height=256,this.ctx=F.getContext("2d"),this.imageData=this.ctx.createImageData(256,256)}draw(F,_){let D=this.imageData.data;for(let A=0;A<65536;A++){let E=A*4;if(F[A]>=_)D[E]=88,D[E+1]=166,D[E+2]=255;else D[E]=13,D[E+1]=17,D[E+2]=23;D[E+3]=255}this.ctx.putImageData(this.imageData,0,0)}}class q1{ctx;w;h;constructor(F,_,D){this.w=_,this.h=D;let A=window.devicePixelRatio||1;F.width=_*A,F.height=D*A,F.style.width=_+"px",F.style.height=D+"px",this.ctx=F.getContext("2d"),this.ctx.scale(A,A)}draw(F,_,D){let A=this.ctx,E=this.w,J=this.h,U=E-40-12,P=J-12-28;A.fillStyle="#0d1117",A.fillRect(0,0,E,J),A.strokeStyle="#30363d",A.lineWidth=1,A.beginPath(),A.moveTo(40,12),A.lineTo(40,12+P),A.lineTo(40+U,12+P),A.stroke(),A.fillStyle="#8b949e",A.font="9px monospace",A.textAlign="right",A.textBaseline="middle";for(let $ of[0,0.5,1]){let G=12+P*(1-$);A.fillText($.toFixed(1),36,G),A.strokeStyle="#21262d",A.lineWidth=0.5,A.beginPath(),A.moveTo(40,G),A.lineTo(40+U,G),A.stroke()}A.fillStyle="#8b949e",A.textAlign="center",A.textBaseline="top";for(let $ of[0,128,255]){let G=40+$/255*U;A.fillText(String($),G,12+P+4)}A.fillStyle="#8b949e",A.textAlign="right",A.textBaseline="top",A.fillText("Row "+_,40+U,12+P+4);let Q=12+P*(1-D);A.strokeStyle="#f85149",A.lineWidth=1,A.setLineDash([4,3]),A.beginPath(),A.moveTo(40,Q),A.lineTo(40+U,Q),A.stroke(),A.setLineDash([]),A.fillStyle="#f85149",A.font="9px monospace",A.textAlign="left",A.textBaseline="bottom",A.fillText("T="+D.toFixed(2),43,Q-2);let K=_*256;A.strokeStyle="#58a6ff",A.lineWidth=1.5,A.beginPath();for(let $=0;$<256;$++){let G=40+$/255*U,q=Math.max(0,Math.min(1,F[K+$])),H=12+P*(1-q);if($===0)A.moveTo(G,H);else A.lineTo(G,H)}A.stroke()}}var E1=["#58a6ff","#3fb950","#f0883e","#bc8cff","#f778ba","#ffd33d","#a5d6ff","#ff7b72","#7ee787"];var n={top:40,right:130,bottom:55,left:70};class Z1{canvas;ctx;constructor(F){this.canvas=F,this.ctx=F.getContext("2d")}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}draw(F){let _=this.canvas,D=this.ctx,A=window.devicePixelRatio||1,E=_.getBoundingClientRect(),J=E.width,U=E.height;_.width=J*A,_.height=U*A,D.setTransform(A,0,0,A,0,0);let{left:P,top:Q}=n,K=J-n.left-n.right,$=U-n.top-n.bottom;if(K<40||$<40)return;let G=F.focusValues[0],q=F.focusValues[F.focusValues.length-1],H=1/0,X=-1/0;for(let O of F.curves)for(let L of O.points){if(L.cd<H)H=L.cd;if(L.cd>X)X=L.cd}if(!isFinite(H)||!isFinite(X)||H===X)H=0,X=200;else{let O=(X-H)*0.1||20;H=Math.max(0,H-O),X=X+O}let j=(O)=>P+(O-G)/(q-G)*K,R=(O)=>Q+$-(O-H)/(X-H)*$;D.fillStyle="#161b22",D.fillRect(0,0,J,U),D.font='10px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="center",D.textBaseline="top";let Y=v1(G,q,8),V=v1(H,X,6);D.strokeStyle="rgba(48, 54, 61, 0.6)",D.lineWidth=1,D.setLineDash([4,4]);for(let O of Y){let L=j(O);D.beginPath(),D.moveTo(L,Q),D.lineTo(L,Q+$),D.stroke(),D.fillStyle="#8b949e",D.fillText(O.toFixed(1),L,Q+$+8)}D.textAlign="right",D.textBaseline="middle";for(let O of V){let L=R(O);D.beginPath(),D.moveTo(P,L),D.lineTo(P+K,L),D.stroke(),D.fillStyle="#8b949e",D.fillText(O.toFixed(0),P-8,L)}D.setLineDash([]),D.strokeStyle="rgba(48, 54, 61, 0.6)",D.lineWidth=1,D.strokeRect(P,Q,K,$);for(let O=0;O<F.curves.length;O++){let L=F.curves[O],h=E1[O%E1.length];D.strokeStyle=h,D.lineWidth=2,D.lineJoin="round",D.lineCap="round",D.beginPath();for(let y=0;y<L.points.length;y++){let S=L.points[y],f=j(S.focus),M=R(S.cd);if(y===0)D.moveTo(f,M);else D.lineTo(f,M)}D.stroke(),D.fillStyle=h;for(let y of L.points)D.beginPath(),D.arc(j(y.focus),R(y.cd),3,0,Math.PI*2),D.fill()}D.fillStyle="#8b949e",D.font='11px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="center",D.textBaseline="top",D.fillText("Defocus (μm)",P+K/2,Q+$+30),D.save(),D.translate(16,Q+$/2),D.rotate(-Math.PI/2),D.textAlign="center",D.textBaseline="middle",D.fillText("CD (nm)",0,0),D.restore(),D.fillStyle="#e6edf3",D.font='12px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="center",D.textBaseline="top",D.fillText("Bossung Curves",P+K/2,12);let I=P+K+16,k=Q+4;D.font='10px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="left",D.textBaseline="middle";for(let O=0;O<F.curves.length;O++){let L=E1[O%E1.length],h=F.doseValues[O];D.strokeStyle=L,D.lineWidth=2,D.beginPath(),D.moveTo(I,k),D.lineTo(I+18,k),D.stroke(),D.fillStyle="#8b949e",D.fillText(`D=${h.toFixed(2)}`,I+24,k),k+=18}}}function v1(F,_,D){let A=_-F;if(A<=0)return[F];let E=A/D,J=Math.pow(10,Math.floor(Math.log10(E))),U,P=E/J;if(P<=1.5)U=J;else if(P<=3.5)U=2*J;else if(P<=7.5)U=5*J;else U=10*J;let Q=[],K=Math.ceil(F/U)*U;for(let $=K;$<=_+U*0.01;$+=U)Q.push(Math.round($/U)*U);return Q}function D2(F,_){let D=0;for(let A=0;A<_;A++)D=D<<1|F&1,F>>=1;return D}function A2(F){let _=Math.log2(F)|0,D=new Uint32Array(F);for(let A=0;A<F;A++)D[A]=D2(A,_);return D}var f1=new Map,N1=new Map;function _2(F){let _=f1.get(F);if(!_)_=A2(F),f1.set(F,_);return _}function F2(F,_){let D=`${F}_${_?1:0}`,A=N1.get(D);if(!A){let E=F*2;A=new Float64Array(F*2);let U=(_?1:-1)*Math.PI/F;for(let P=0;P<F;P++){let Q=U*P;A[P*2]=Math.cos(Q),A[P*2+1]=Math.sin(Q)}N1.set(D,A)}return A}function x1(F,_,D,A=0,E=1){let J=Math.log2(_)|0,U=_2(_);if(E===1&&A===0)for(let P=0;P<_;P++){let Q=U[P];if(Q>P){let K=P*2,$=Q*2,G=F[K];F[K]=F[$],F[$]=G,G=F[K+1],F[K+1]=F[$+1],F[$+1]=G}}else{let P=new Float64Array(_*2);for(let Q=0;Q<_;Q++){let K=(A+Q*E)*2,$=U[Q]*2;P[$]=F[K],P[$+1]=F[K+1]}for(let Q=0;Q<_;Q++){let K=(A+Q*E)*2;F[K]=P[Q*2],F[K+1]=P[Q*2+1]}}for(let P=1;P<=J;P++){let Q=1<<P,K=Q>>1,$=F2(K,D);for(let G=0;G<_;G+=Q)for(let q=0;q<K;q++){let H=(A+(G+q)*E)*2,X=(A+(G+q+K)*E)*2,j=$[q*2],R=$[q*2+1],Y=F[X],V=F[X+1],I=j*Y-R*V,k=j*V+R*Y,O=F[H],L=F[H+1];F[H]=O+I,F[H+1]=L+k,F[X]=O-I,F[X+1]=L-k}}if(D){let P=1/_;for(let Q=0;Q<_;Q++){let K=(A+Q*E)*2;F[K]*=P,F[K+1]*=P}}}function G1(F,_,D){let A=new Float64Array(_*2);for(let J=0;J<_;J++){let U=J*_*2;A.set(F.subarray(U,U+_*2)),x1(A,_,D),F.set(A,U)}let E=new Float64Array(_*2);for(let J=0;J<_;J++){for(let U=0;U<_;U++)E[U*2]=F[(U*_+J)*2],E[U*2+1]=F[(U*_+J)*2+1];x1(E,_,D);for(let U=0;U<_;U++)F[(U*_+J)*2]=E[U*2],F[(U*_+J)*2+1]=E[U*2+1]}}function H1(F,_){let D=_>>1;for(let A=0;A<D;A++)for(let E=0;E<_;E++){let J=A+D,U=(E+D)%_,P=(A*_+E)*2,Q=(J*_+U)*2,K=F[P];F[P]=F[Q],F[Q]=K,K=F[P+1],F[P+1]=F[Q+1],F[Q+1]=K}}function z1(F,_,D){let{wavelength:A,na:E,sigma:J,defocus:U}=D,P=19.53125,Q=1/(_*19.53125),$=E*(1+J)/A,G=$*$,q=U*1000,H=Math.PI*A*q,X=_>>1;for(let j=0;j<_;j++){let R=(j-X)*Q,Y=R*R;for(let V=0;V<_;V++){let I=(V-X)*Q,k=I*I+Y,O=(j*_+V)*2;if(k>G)F[O]=0,F[O+1]=0;else if(q!==0){let L=H*k,h=Math.cos(L),y=Math.sin(L),S=F[O],f=F[O+1];F[O]=S*h-f*y,F[O+1]=S*y+f*h}}}}var r=256,i=r*r,U1=null;function E2(){if(!U1||U1.length!==i*2)U1=new Float64Array(i*2);return U1}function P1(F,_){let D=performance.now(),A=E2();for(let P=0;P<i;P++)A[P*2]=F[P],A[P*2+1]=0;G1(A,r,!1),H1(A,r),z1(A,r,_),H1(A,r),G1(A,r,!0);let E=new Float32Array(i),J=0;for(let P=0;P<i;P++){let Q=A[P*2],K=A[P*2+1],$=Q*Q+K*K;if(E[P]=$,$>J)J=$}if(J>0){let P=1/J;for(let Q=0;Q<i;Q++)E[Q]*=P}let U=performance.now()-D;return{intensity:E,timeMs:U}}var s=256,U2=19.53125;function u1(F,_,D){if(D===1)return[(F+_)/2];let A=[];for(let E=0;E<D;E++)A.push(F+(_-F)*E/(D-1));return A}function P2(F,_){let A=(s>>1)*s,E=0,J=-1,U=-1;for(let P=0;P<=s;P++){let Q=P<s&&F[A+P]*_>=1;if(Q&&U<0)U=P;else if(!Q&&U>=0){let K=P-U,$=U+K/2;if(K>E||K===E&&Math.abs($-s/2)<Math.abs(J-s/2))E=K,J=$;U=-1}}return E*U2}function m1(F,_,D){let A=performance.now(),E=u1(D.focusRange[0],D.focusRange[1],D.focusSteps),J=u1(D.doseRange[0],D.doseRange[1],D.doseSteps),U=J.map((Q)=>({dose:Q,points:[]}));for(let Q of E){let K={..._,defocus:Q},$=P1(F,K);for(let G=0;G<J.length;G++){let q=P2($.intensity,J[G]);U[G].points.push({focus:Q,cd:q})}}let P=performance.now()-A;return{curves:U,focusValues:E,doseValues:J,timeMs:P,pipelineRuns:E.length}}function c1(){let F=document.getElementById("app"),{maskPanel:_,heatmapCanvas:D,resistCanvas:A,crossSectionCanvas:E,crossSectionLine:J,heatmapWrap:U,paramsPanel:P,timingReadout:Q,zoomSlider:K,zoomInBtn:$,zoomOutBtn:G,zoomLabel:q,heatmapContainer:H,downloadBtn:X,bossungCanvas:j,bossungChartContainer:R}=L1(F),Y=k1(_),V=document.createElement("div");P.insertBefore(V,P.firstChild),w1(V,(T)=>{D.style.width=T+"px",D.style.height=T+"px",A.style.width=T+"px",A.style.height=T+"px"});let I=document.createElement("div");I.style.padding="10px 0",P.insertBefore(I,Q),y1(I);let k=document.createElement("div");k.style.padding="10px 0",k.style.borderTop="1px solid var(--border)",P.insertBefore(k,Q);let O=M1(k),L=document.createElement("div");P.insertBefore(L,Q);let h=new Z1(j),y=B1(L,(T)=>{y.setRunning(!0),setTimeout(()=>{let Z=x(),W=m1(Z.mask,Z.params,T);h.draw(W),y.setTiming(W.timeMs,W.pipelineRuns),y.setRunning(!1);let w=R._showBossung;if(w)w()},0)}),S=new K1(D),f=new T1(A),M=new q1(E,540,140),d=document.getElementById("timing-sim"),z=document.getElementById("timing-render");j1((T)=>{let Z=P1(T.mask,T.params);d.textContent=Z.timeMs.toFixed(1);let W=performance.now();S.draw(Z.intensity),f.draw(Z.intensity,T.viewParams.threshold),M.draw(Z.intensity,T.viewParams.crossSectionRow,T.viewParams.threshold);let w=performance.now()-W;z.textContent=w.toFixed(1);let B=T.viewParams.crossSectionRow/255;J.style.top=B*100+"%"});let u=0;function N(T){if(u===0)u=D.offsetWidth;if(T===1)D.style.width="",D.style.height="",D.style.maxWidth="",D.style.maxHeight="",D.style.minWidth="",D.style.minHeight="",A.style.width="",A.style.height="",A.style.maxWidth="",A.style.maxHeight="",A.style.minWidth="",A.style.minHeight="";else{let Z=u*T;D.style.width=`${Z}px`,D.style.height=`${Z}px`,D.style.maxWidth="none",D.style.maxHeight="none",D.style.minWidth=`${Z}px`,D.style.minHeight=`${Z}px`,A.style.width=`${Z}px`,A.style.height=`${Z}px`,A.style.maxWidth="none",A.style.maxHeight="none",A.style.minWidth=`${Z}px`,A.style.minHeight=`${Z}px`}q.textContent=`${Math.round(T*100)}%`,K.value=String(T)}K.addEventListener("input",()=>{N(parseFloat(K.value))}),G.addEventListener("click",()=>{let T=Math.max(0.5,parseFloat(K.value)-0.1);N(Math.round(T*10)/10)}),$.addEventListener("click",()=>{let T=Math.min(4,parseFloat(K.value)+0.1);N(Math.round(T*10)/10)}),X.addEventListener("click",()=>{let T=document.createElement("a"),Z=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);T.download=`lithography-simulation-${Z}.png`,T.href=D.toDataURL("image/png"),T.click()});let p=_.querySelector(".preset-btn");if(p)p.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",c1);else c1();
