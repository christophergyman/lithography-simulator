function F1(D){D.innerHTML="";let U=document.createElement("div");U.className="header";let $=document.createElement("h1");$.textContent="Lithography Simulator";let F=document.createElement("span");F.className="subtitle",F.textContent="Fourier Optics / Aerial Image",U.append($,F);let G=document.createElement("div");G.className="panel";let E=document.createElement("div");E.className="panel panel-heatmap";let J=document.createElement("div");J.className="heatmap-container";let Q=document.createElement("canvas");J.appendChild(Q),E.appendChild(J);let H=document.createElement("div");H.className="panel panel-params";let K=document.createElement("div");K.className="panel-title",K.textContent="Parameters",H.appendChild(K);let L=document.createElement("div");return L.className="timing-readout",L.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,H.appendChild(L),D.append(U,G,E,H),{maskPanel:G,heatmapCanvas:Q,paramsPanel:H,timingReadout:L}}var G1=[],e=!1,N={wavelength:248,na:0.75,sigma:0.5,defocus:0},n={mask:new Float32Array(65536),params:{...N}};function t(){if(e)return;e=!0,requestAnimationFrame(()=>{e=!1;for(let D of G1)D(n)})}function z(){return n}function E1(D){G1.push(D)}function o(D){n.mask=D,t()}function J1(D,U){n.params[D]=U,t()}function Q1(){Object.assign(n.params,N),t()}function g(){return new Float32Array(65536)}function u1(){let D=g(),U=10,$=5;for(let F=0;F<256;F++)for(let G=0;G<256;G++)if(G%10<5)D[F*256+G]=1;return D}function C1(){let D=g(),U=20,$=6,F=Math.floor(7);for(let G=0;G<256;G++)for(let E=0;E<256;E++){let J=G%20,Q=E%20;if(J>=F&&J<F+6&&Q>=F&&Q<F+6)D[G*256+E]=1}return D}function O1(){let D=g(),U=6,$=125,F=131;for(let G=0;G<256;G++)for(let E=125;E<131;E++)D[G*256+E]=1;return D}function I1(){let D=g(),U=5,$=2;for(let F=0;F<256;F++)for(let G=0;G<256;G++)if(G%5<2)D[F*256+G]=1;return D}function P1(){let D=g(),U=128,$=128,F=60,G=10;for(let E=0;E<256;E++)for(let J=0;J<256;J++){let Q=E-128,H=J-128,K=H>=0&&H<60&&Q>=-5&&Q<5,L=Q>=0&&Q<60&&H>=-5&&H<5;if(K||L)D[E*256+J]=1}return D}var $1=[{name:"line_space",label:"Line/Space (10px)",generate:u1},{name:"contacts",label:"Contact Holes",generate:C1},{name:"isolated_line",label:"Isolated Line",generate:O1},{name:"dense_lines",label:"Dense Lines (5px)",generate:I1},{name:"l_shape",label:"L-Shape Corner",generate:P1}];var W=256,H1=256;function R1(D,U){let $=U/2,F=[],G=Math.floor(U/2);switch(D){case"square":for(let E=-G;E<=G;E++)for(let J=-G;J<=G;J++)F.push([J,E]);break;case"circle":for(let E=-G;E<=G;E++)for(let J=-G;J<=G;J++)if(J*J+E*E<=$*$)F.push([J,E]);break;case"ring":{let E=$*0.6;for(let J=-G;J<=G;J++)for(let Q=-G;Q<=G;Q++){let H=Q*Q+J*J;if(H<=$*$&&H>=E*E)F.push([Q,J])}break}case"cross":{let E=Math.max(1,Math.floor(U/6));for(let J=-G;J<=G;J++)for(let Q=-G;Q<=G;Q++)if(Math.abs(Q)<=E||Math.abs(J)<=E)F.push([Q,J]);break}case"lineH":{let E=Math.max(1,Math.floor(U/6));for(let J=-E;J<=E;J++)for(let Q=-G;Q<=G;Q++)F.push([Q,J]);break}case"lineV":{let E=Math.max(1,Math.floor(U/6));for(let J=-G;J<=G;J++)for(let Q=-E;Q<=E;Q++)F.push([Q,J]);break}}return F}var T1=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function K1(D){let U=document.createElement("div");U.className="panel-title",U.textContent="Mask Editor",D.appendChild(U);let $=document.createElement("div");$.className="panel-mask",D.appendChild($);let F=document.createElement("div");F.className="mask-canvas-wrap";let G=document.createElement("canvas");G.width=W,G.height=W,G.style.width=H1+"px",G.style.height=H1+"px",F.appendChild(G),$.appendChild(F);let E=G.getContext("2d"),J="brush",Q="square",H=20,K=!1,L=1;function _(){let Y=z().mask,X=E.createImageData(W,W),A=X.data;for(let Z=0;Z<W*W;Z++){let C=Y[Z]>0?255:0;A[Z*4]=C,A[Z*4+1]=C,A[Z*4+2]=C,A[Z*4+3]=255}E.putImageData(X,0,0)}function q(Y){let X=G.getBoundingClientRect(),A=W/X.width,Z=W/X.height,C=Math.floor((Y.clientX-X.left)*A),S=Math.floor((Y.clientY-X.top)*Z);return[Math.max(0,Math.min(W-1,C)),Math.max(0,Math.min(W-1,S))]}function O(Y,X,A){for(let Z=-1;Z<=1;Z++)for(let C=-1;C<=1;C++){let S=Y+C,y=X+Z;if(S>=0&&S<W&&y>=0&&y<W)A[y*W+S]=L}}function R(Y,X,A){let Z=R1(Q,H);for(let[C,S]of Z){let y=Y+C,d=X+S;if(y>=0&&y<W&&d>=0&&d<W)A[d*W+y]=L}}function I(Y){let[X,A]=q(Y),Z=z().mask;if(J==="stamp")R(X,A,Z);else O(X,A,Z);_(),o(Z)}G.addEventListener("mousedown",(Y)=>{K=!0,L=Y.button===2?0:1,I(Y)}),G.addEventListener("mousemove",(Y)=>{if(K)I(Y)}),G.addEventListener("mouseup",()=>{K=!1}),G.addEventListener("mouseleave",()=>{K=!1}),G.addEventListener("contextmenu",(Y)=>Y.preventDefault());let T=document.createElement("div");T.className="tool-toggle";let P=document.createElement("button");P.textContent="BRUSH",P.classList.add("active");let V=document.createElement("button");V.textContent="STAMP";function M(Y){J=Y,P.classList.toggle("active",Y==="brush"),V.classList.toggle("active",Y==="stamp"),u.style.display=Y==="stamp"?"":"none"}P.addEventListener("click",()=>M("brush")),V.addEventListener("click",()=>M("stamp")),T.append(P,V),$.appendChild(T);let u=document.createElement("div");u.className="stamp-options",u.style.display="none";let j=document.createElement("div");j.className="stamp-shape-row";let b=[];for(let Y of T1){let X=document.createElement("button");if(X.className="stamp-btn",X.textContent=Y.label,Y.key===Q)X.classList.add("active");X.addEventListener("click",()=>{Q=Y.key,b.forEach((A)=>A.classList.remove("active")),X.classList.add("active")}),b.push(X),j.appendChild(X)}u.appendChild(j);let c=document.createElement("div");c.className="param-group";let x=document.createElement("div");x.className="param-label";let p=document.createElement("span");p.className="param-name",p.textContent="Stamp Size";let w=document.createElement("span");w.className="param-value",w.textContent=String(H),x.append(p,w);let B=document.createElement("input");B.type="range",B.min="4",B.max="60",B.value=String(H),B.addEventListener("input",()=>{H=Number(B.value),w.textContent=String(H)}),c.append(x,B),u.appendChild(c),$.appendChild(u);let r=document.createElement("div");r.className="preset-buttons";let h=null;for(let Y of $1){let X=document.createElement("button");X.className="preset-btn",X.textContent=Y.label,X.addEventListener("click",()=>{let A=Y.generate();if(o(A),_(),h)h.classList.remove("active");X.classList.add("active"),h=X}),r.appendChild(X)}$.appendChild(r);let l=document.createElement("div");l.className="mask-tools";let i=document.createElement("button");i.textContent="CLEAR",i.addEventListener("click",()=>{if(o(new Float32Array(W*W)),_(),h)h.classList.remove("active");h=null});let s=document.createElement("button");s.textContent="INVERT",s.addEventListener("click",()=>{let Y=z().mask;for(let X=0;X<W*W;X++)Y[X]=Y[X]>0?0:1;o(Y),_()}),l.append(i,s),$.appendChild(l),_()}var M1=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}];function L1(D){let U=[];for(let F of M1){let G=document.createElement("div");G.className="param-group";let E=document.createElement("div");E.className="param-label";let J=document.createElement("span");J.className="param-name",J.textContent=F.label;let Q=document.createElement("span"),H=document.createElement("span");H.className="param-value";let K=document.createElement("span");K.className="param-unit",K.textContent=F.unit,Q.append(H,K),E.append(J,Q);let L=document.createElement("input");L.type="range",L.min=String(F.min),L.max=String(F.max),L.step=String(F.step),L.value=String(z().params[F.key]);let _=(q)=>{H.textContent=q.toFixed(F.decimals)};_(z().params[F.key]),L.addEventListener("input",()=>{let q=parseFloat(L.value);_(q),J1(F.key,q)}),G.append(E,L),D.appendChild(G),U.push({def:F,input:L,updateDisplay:_})}let $=document.createElement("button");$.className="reset-params-btn",$.textContent="Reset Defaults",$.addEventListener("click",()=>{Q1();for(let{def:F,input:G,updateDisplay:E}of U){let J=N[F.key];G.value=String(J),E(J)}}),D.appendChild($)}var X1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,Y1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var b1=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function _1(){let D=new Uint8Array(1024);for(let U=0;U<256;U++){let $=b1[U];D[U*4+0]=$[0],D[U*4+1]=$[1],D[U*4+2]=$[2],D[U*4+3]=255}return D}var v=256;class a{gl;program;intensityTex;colormapTex;vao;constructor(D){D.width=v,D.height=v;let U=D.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1});if(!U)throw Error("WebGL2 not supported");this.gl=U;let $=U.getExtension("EXT_color_buffer_float");this.program=this.createProgram(X1,Y1),this.vao=U.createVertexArray(),this.intensityTex=U.createTexture(),U.bindTexture(U.TEXTURE_2D,this.intensityTex),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texImage2D(U.TEXTURE_2D,0,U.R32F,v,v,0,U.RED,U.FLOAT,null),this.colormapTex=U.createTexture(),U.bindTexture(U.TEXTURE_2D,this.colormapTex),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE);let F=_1();U.texImage2D(U.TEXTURE_2D,0,U.RGBA,256,1,0,U.RGBA,U.UNSIGNED_BYTE,F),U.useProgram(this.program),U.uniform1i(U.getUniformLocation(this.program,"uIntensity"),0),U.uniform1i(U.getUniformLocation(this.program,"uColormap"),1)}draw(D){let U=this.gl;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,this.intensityTex),U.texSubImage2D(U.TEXTURE_2D,0,0,0,v,v,U.RED,U.FLOAT,D),U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,this.colormapTex),U.useProgram(this.program),U.bindVertexArray(this.vao),U.viewport(0,0,v,v),U.drawArrays(U.TRIANGLES,0,3)}resize(D,U){}createProgram(D,U){let $=this.gl,F=this.compileShader($.VERTEX_SHADER,D),G=this.compileShader($.FRAGMENT_SHADER,U),E=$.createProgram();if($.attachShader(E,F),$.attachShader(E,G),$.linkProgram(E),!$.getProgramParameter(E,$.LINK_STATUS)){let J=$.getProgramInfoLog(E);throw $.deleteProgram(E),Error("Shader link error: "+J)}return $.deleteShader(F),$.deleteShader(G),E}compileShader(D,U){let $=this.gl,F=$.createShader(D);if($.shaderSource(F,U),$.compileShader(F),!$.getShaderParameter(F,$.COMPILE_STATUS)){let G=$.getShaderInfoLog(F);throw $.deleteShader(F),Error("Shader compile error: "+G)}return F}}function v1(D,U){let $=0;for(let F=0;F<U;F++)$=$<<1|D&1,D>>=1;return $}function w1(D){let U=Math.log2(D)|0,$=new Uint32Array(D);for(let F=0;F<D;F++)$[F]=v1(F,U);return $}var W1=new Map,Z1=new Map;function B1(D){let U=W1.get(D);if(!U)U=w1(D),W1.set(D,U);return U}function S1(D,U){let $=`${D}_${U?1:0}`,F=Z1.get($);if(!F){let G=D*2;F=new Float64Array(D*2);let J=(U?1:-1)*Math.PI/D;for(let Q=0;Q<D;Q++){let H=J*Q;F[Q*2]=Math.cos(H),F[Q*2+1]=Math.sin(H)}Z1.set($,F)}return F}function q1(D,U,$,F=0,G=1){let E=Math.log2(U)|0,J=B1(U);if(G===1&&F===0)for(let Q=0;Q<U;Q++){let H=J[Q];if(H>Q){let K=Q*2,L=H*2,_=D[K];D[K]=D[L],D[L]=_,_=D[K+1],D[K+1]=D[L+1],D[L+1]=_}}else{let Q=new Float64Array(U*2);for(let H=0;H<U;H++){let K=(F+H*G)*2,L=J[H]*2;Q[L]=D[K],Q[L+1]=D[K+1]}for(let H=0;H<U;H++){let K=(F+H*G)*2;D[K]=Q[H*2],D[K+1]=Q[H*2+1]}}for(let Q=1;Q<=E;Q++){let H=1<<Q,K=H>>1,L=S1(K,$);for(let _=0;_<U;_+=H)for(let q=0;q<K;q++){let O=(F+(_+q)*G)*2,R=(F+(_+q+K)*G)*2,I=L[q*2],T=L[q*2+1],P=D[R],V=D[R+1],M=I*P-T*V,u=I*V+T*P,j=D[O],b=D[O+1];D[O]=j+M,D[O+1]=b+u,D[R]=j-M,D[R+1]=b-u}}if($){let Q=1/U;for(let H=0;H<U;H++){let K=(F+H*G)*2;D[K]*=Q,D[K+1]*=Q}}}function U1(D,U,$){let F=new Float64Array(U*2);for(let E=0;E<U;E++){let J=E*U*2;F.set(D.subarray(J,J+U*2)),q1(F,U,$),D.set(F,J)}let G=new Float64Array(U*2);for(let E=0;E<U;E++){for(let J=0;J<U;J++)G[J*2]=D[(J*U+E)*2],G[J*2+1]=D[(J*U+E)*2+1];q1(G,U,$);for(let J=0;J<U;J++)D[(J*U+E)*2]=G[J*2],D[(J*U+E)*2+1]=G[J*2+1]}}function D1(D,U){let $=U>>1;for(let F=0;F<$;F++)for(let G=0;G<U;G++){let E=F+$,J=(G+$)%U,Q=(F*U+G)*2,H=(E*U+J)*2,K=D[Q];D[Q]=D[H],D[H]=K,K=D[Q+1],D[Q+1]=D[H+1],D[H+1]=K}}function A1(D,U,$){let{wavelength:F,na:G,sigma:E,defocus:J}=$,Q=19.53125,H=1/(U*19.53125),L=G*(1+E)/F,_=L*L,q=J*1000,O=Math.PI*F*q,R=U>>1;for(let I=0;I<U;I++){let T=(I-R)*H,P=T*T;for(let V=0;V<U;V++){let M=(V-R)*H,u=M*M+P,j=(I*U+V)*2;if(u>_)D[j]=0,D[j+1]=0;else if(q!==0){let b=O*u,c=Math.cos(b),x=Math.sin(b),p=D[j],w=D[j+1];D[j]=p*c-w*x,D[j+1]=p*x+w*c}}}}var k=256,m=k*k,f=null;function y1(){if(!f||f.length!==m*2)f=new Float64Array(m*2);return f}function j1(D,U){let $=performance.now(),F=y1();for(let Q=0;Q<m;Q++)F[Q*2]=D[Q],F[Q*2+1]=0;U1(F,k,!1),D1(F,k),A1(F,k,U),D1(F,k),U1(F,k,!0);let G=new Float32Array(m),E=0;for(let Q=0;Q<m;Q++){let H=F[Q*2],K=F[Q*2+1],L=H*H+K*K;if(G[Q]=L,L>E)E=L}if(E>0){let Q=1/E;for(let H=0;H<m;H++)G[H]*=Q}let J=performance.now()-$;return{intensity:G,timeMs:J}}function V1(){let D=document.getElementById("app"),{maskPanel:U,heatmapCanvas:$,paramsPanel:F,timingReadout:G}=F1(D);K1(U);let E=document.createElement("div");E.style.padding="10px 0",F.insertBefore(E,G),L1(E);let J=new a($),Q=document.getElementById("timing-sim"),H=document.getElementById("timing-render");E1((L)=>{let _=j1(L.mask,L.params);Q.textContent=_.timeMs.toFixed(1);let q=performance.now();J.draw(_.intensity);let O=performance.now()-q;H.textContent=O.toFixed(1)});let K=U.querySelector(".preset-btn");if(K)K.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",V1);else V1();
