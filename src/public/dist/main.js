function O1(F){F.innerHTML="";let A=document.createElement("div");A.className="header";let D=document.createElement("h1");D.textContent="Lithography Simulator";let _=document.createElement("span");_.className="subtitle",_.textContent="Fourier Optics / Aerial Image";let J=document.createElement("button");J.className="download-btn",J.textContent="Export PNG",A.append(D,_,J);let q=document.createElement("div");q.className="panel",q.dataset.panel="mask";let $=document.createElement("div");$.className="panel panel-heatmap",$.dataset.panel="view";let Q=document.createElement("div");Q.className="view-toggle";let U=document.createElement("button");U.textContent="Heatmap",U.classList.add("active");let G=document.createElement("button");G.textContent="Bossung",Q.append(U,G),$.appendChild(Q);let K=document.createElement("div");K.className="heatmap-container";let T=document.createElement("div");T.className="viz-toggle-bar";let Z=[{key:"aerial",label:"Aerial"},{key:"resist",label:"Resist"},{key:"split",label:"Split"}],Y=[];for(let z of Z){let S=document.createElement("button");S.className="viz-toggle-btn",S.textContent=z.label,S.dataset.mode=z.key,Y.push(S),T.appendChild(S)}let E=document.createElement("div");E.className="viz-toggle-sep",T.appendChild(E);let X=document.createElement("button");X.className="viz-toggle-btn",X.textContent="Cross-Section",X.dataset.mode="cs",T.appendChild(X);let V=document.createElement("div");V.className="viz-grid",V.appendChild(T);let j=document.createElement("div");j.className="viz-image-row";let W=document.createElement("div");W.className="viz-image-wrap";let I=document.createElement("div");I.className="viz-label",I.textContent="Aerial Image";let w=document.createElement("canvas"),O=document.createElement("div");O.className="cross-section-line",W.append(I,w,O);let L=document.createElement("div");L.className="viz-image-wrap";let x=document.createElement("div");x.className="viz-label",x.textContent="Resist Image";let k=document.createElement("canvas");L.append(x,k),j.append(W,L);let B=document.createElement("div");B.className="cross-section-wrap";let b=document.createElement("canvas");b.className="cross-section-canvas",B.appendChild(b),V.append(j,B),K.appendChild(V),$.appendChild(K);let y=document.createElement("div");y.className="bossung-chart-container",y.style.display="none";let f=document.createElement("canvas");y.appendChild(f),$.appendChild(y);function v(z){let S=z==="heatmap";K.style.display=S?"":"none",y.style.display=S?"none":"flex",U.classList.toggle("active",S),G.classList.toggle("active",!S)}U.addEventListener("click",()=>v("heatmap")),G.addEventListener("click",()=>v("bossung")),y._showBossung=()=>v("bossung");let m="aerial",g=!1;function p(){for(let z of Y)z.classList.toggle("active",z.dataset.mode===m);X.classList.toggle("active",g),W.style.display=m==="resist"?"none":"",L.style.display=m==="aerial"?"none":"",B.style.display=g?"":"none",O.style.display=g?"":"none"}function P(z){m=z,p()}function H(){return g=!g,p(),g}for(let z of Y)z.addEventListener("click",()=>{P(z.dataset.mode)});X.addEventListener("click",()=>{H()}),p();let M=document.createElement("div");M.className="panel panel-params",M.dataset.panel="params";let R=document.createElement("div");R.className="panel-title",R.textContent="Parameters",M.appendChild(R);let N=document.createElement("div");N.className="timing-readout",N.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,M.appendChild(N);let d=document.createElement("div");d.className="zoom-bar";let u=document.createElement("button");u.className="zoom-btn",u.textContent="−";let c=document.createElement("input");c.type="range",c.className="zoom-slider",c.min="0.5",c.max="4",c.step="0.1",c.value="1";let A1=document.createElement("button");A1.className="zoom-btn",A1.textContent="+";let _1=document.createElement("span");_1.className="zoom-label",_1.textContent="100%",d.append(u,c,A1,_1),K.appendChild(d);let F1=document.createElement("div");F1.className="mobile-tab-bar";let o1=[{key:"mask",label:"Mask"},{key:"view",label:"View"},{key:"params",label:"Params"}],q1=[];for(let z of o1){let S=document.createElement("button");S.className="mobile-tab-btn",S.textContent=z.label,S.dataset.tab=z.key,S.addEventListener("click",()=>{F.dataset.activeTab=z.key;for(let j1 of q1)j1.classList.toggle("active",j1.dataset.tab===z.key)}),q1.push(S),F1.appendChild(S)}return F.dataset.activeTab="view",q1[1].classList.add("active"),F.append(A,q,$,M,F1),{maskPanel:q,heatmapCanvas:w,resistCanvas:k,crossSectionCanvas:b,crossSectionLine:O,heatmapWrap:W,resistWrap:L,crossSectionWrap:B,paramsPanel:M,timingReadout:N,zoomSlider:c,zoomInBtn:A1,zoomOutBtn:u,zoomLabel:_1,heatmapContainer:K,mobileTabBar:F1,downloadBtn:J,setVizMode:P,toggleCrossSection:H,bossungCanvas:f,bossungChartContainer:y}}var i={z4:0,z5:0,z6:0,z7:0,z8:0,z9:0,z10:0,z11:0};function r1(F){return 1.7320508075688772*(2*F*F-1)}function i1(F,A){return 2.449489742783178*F*F*Math.sin(2*A)}function n1(F,A){return 2.449489742783178*F*F*Math.cos(2*A)}function s1(F,A){return 2.8284271247461903*(3*F*F*F-2*F)*Math.sin(A)}function t1(F,A){return 2.8284271247461903*(3*F*F*F-2*F)*Math.cos(A)}function e1(F){let A=F*F;return 2.23606797749979*(6*A*A-6*A+1)}function a1(F,A){return 2.8284271247461903*F*F*F*Math.sin(3*A)}function D2(F,A){return 2.8284271247461903*F*F*F*Math.cos(3*A)}function E1(F,A,D){let _=0;if(D.z4!==0)_+=D.z4*r1(F);if(D.z5!==0)_+=D.z5*i1(F,A);if(D.z6!==0)_+=D.z6*n1(F,A);if(D.z7!==0)_+=D.z7*s1(F,A);if(D.z8!==0)_+=D.z8*t1(F,A);if(D.z9!==0)_+=D.z9*e1(F);if(D.z10!==0)_+=D.z10*a1(F,A);if(D.z11!==0)_+=D.z11*D2(F,A);return _}var L1=256,V1={threshold:0.3,crossSectionRow:128},W1=[],G1=!1,J1={wavelength:248,na:0.75,sigma:0.5,defocus:0,zernike:{...i}},l={mask:new Float32Array(L1*L1),params:{...J1,zernike:{...i}},viewParams:{...V1}};function e(){if(G1)return;G1=!0,requestAnimationFrame(()=>{G1=!1;for(let F of W1)F(l)})}function h(){return l}function I1(F){W1.push(F)}function a(F){l.mask=F,e()}function M1(F,A){l.params[F]=A,e()}function R1(F,A){l.params.zernike[F]=A,e()}function w1(F,A){l.viewParams[F]=A,e()}function k1(){Object.assign(l.params,J1),l.params.zernike={...i},Object.assign(l.viewParams,V1),e()}function D1(){return new Float32Array(65536)}function A2(){let F=D1(),A=10,D=5;for(let _=0;_<256;_++)for(let J=0;J<256;J++)if(J%10<5)F[_*256+J]=1;return F}function _2(){let F=D1(),A=20,D=6,_=Math.floor(7);for(let J=0;J<256;J++)for(let q=0;q<256;q++){let $=J%20,Q=q%20;if($>=_&&$<_+6&&Q>=_&&Q<_+6)F[J*256+q]=1}return F}function F2(){let F=D1(),A=6,D=125,_=131;for(let J=0;J<256;J++)for(let q=125;q<131;q++)F[J*256+q]=1;return F}function J2(){let F=D1(),A=5,D=2;for(let _=0;_<256;_++)for(let J=0;J<256;J++)if(J%5<2)F[_*256+J]=1;return F}function Q2(){let F=D1(),A=128,D=128,_=60,J=10;for(let q=0;q<256;q++)for(let $=0;$<256;$++){let Q=q-128,U=$-128,G=U>=0&&U<60&&Q>=-5&&Q<5,K=Q>=0&&Q<60&&U>=-5&&U<5;if(G||K)F[q*256+$]=1}return F}var y1=[{name:"line_space",label:"Line/Space (10px)",generate:A2},{name:"contacts",label:"Contact Holes",generate:_2},{name:"isolated_line",label:"Isolated Line",generate:F2},{name:"dense_lines",label:"Dense Lines (5px)",generate:J2},{name:"l_shape",label:"L-Shape Corner",generate:Q2}];var C=256;function $2(F,A){let D=A/2,_=[],J=Math.floor(A/2);switch(F){case"square":for(let q=-J;q<=J;q++)for(let $=-J;$<=J;$++)_.push([$,q]);break;case"circle":for(let q=-J;q<=J;q++)for(let $=-J;$<=J;$++)if($*$+q*q<=D*D)_.push([$,q]);break;case"ring":{let q=D*0.6;for(let $=-J;$<=J;$++)for(let Q=-J;Q<=J;Q++){let U=Q*Q+$*$;if(U<=D*D&&U>=q*q)_.push([Q,$])}break}case"cross":{let q=Math.max(1,Math.floor(A/6));for(let $=-J;$<=J;$++)for(let Q=-J;Q<=J;Q++)if(Math.abs(Q)<=q||Math.abs($)<=q)_.push([Q,$]);break}case"lineH":{let q=Math.max(1,Math.floor(A/6));for(let $=-q;$<=q;$++)for(let Q=-J;Q<=J;Q++)_.push([Q,$]);break}case"lineV":{let q=Math.max(1,Math.floor(A/6));for(let $=-J;$<=J;$++)for(let Q=-q;Q<=q;Q++)_.push([Q,$]);break}}return _}var U2=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function C1(F){let A=document.createElement("div");A.className="panel-title",A.textContent="Mask Editor",F.appendChild(A);let D=document.createElement("div");D.className="panel-mask",F.appendChild(D);let _=document.createElement("div");_.className="mask-canvas-wrap";let J=document.createElement("canvas");J.width=C,J.height=C,_.appendChild(J),D.appendChild(_);let q=J.getContext("2d"),$="brush",Q="square",U=20,G=!1,K=1;function T(){let P=h().mask,H=q.createImageData(C,C),M=H.data;for(let R=0;R<C*C;R++){let N=P[R]>0?255:0;M[R*4]=N,M[R*4+1]=N,M[R*4+2]=N,M[R*4+3]=255}q.putImageData(H,0,0)}function Z(P){let H=J.getBoundingClientRect(),M=C/H.width,R=C/H.height,N=Math.floor((P.clientX-H.left)*M),d=Math.floor((P.clientY-H.top)*R);return[Math.max(0,Math.min(C-1,N)),Math.max(0,Math.min(C-1,d))]}function Y(P,H,M){for(let R=-1;R<=1;R++)for(let N=-1;N<=1;N++){let d=P+N,u=H+R;if(d>=0&&d<C&&u>=0&&u<C)M[u*C+d]=K}}function E(P,H,M){let R=$2(Q,U);for(let[N,d]of R){let u=P+N,c=H+d;if(u>=0&&u<C&&c>=0&&c<C)M[c*C+u]=K}}function X(P){let[H,M]=Z(P),R=h().mask;if($==="stamp")E(H,M,R);else Y(H,M,R);T(),a(R)}J.style.touchAction="none",J.addEventListener("pointerdown",(P)=>{G=!0,K=P.button===2?0:1,J.setPointerCapture(P.pointerId),X(P)}),J.addEventListener("pointermove",(P)=>{if(G)X(P)}),J.addEventListener("pointerup",(P)=>{G=!1,J.releasePointerCapture(P.pointerId)}),J.addEventListener("pointerleave",()=>{G=!1}),J.addEventListener("contextmenu",(P)=>P.preventDefault());let V=document.createElement("div");V.className="tool-toggle";let j=document.createElement("button");j.textContent="BRUSH",j.classList.add("active");let W=document.createElement("button");W.textContent="STAMP";function I(P){$=P,j.classList.toggle("active",P==="brush"),W.classList.toggle("active",P==="stamp"),w.style.display=P==="stamp"?"":"none"}j.addEventListener("click",()=>I("brush")),W.addEventListener("click",()=>I("stamp")),V.append(j,W),D.appendChild(V);let w=document.createElement("div");w.className="stamp-options",w.style.display="none";let O=document.createElement("div");O.className="stamp-shape-row";let L=[];for(let P of U2){let H=document.createElement("button");if(H.className="stamp-btn",H.textContent=P.label,P.key===Q)H.classList.add("active");H.addEventListener("click",()=>{Q=P.key,L.forEach((M)=>M.classList.remove("active")),H.classList.add("active")}),L.push(H),O.appendChild(H)}w.appendChild(O);let x=document.createElement("div");x.className="param-group";let k=document.createElement("div");k.className="param-label";let B=document.createElement("span");B.className="param-name",B.textContent="Stamp Size";let b=document.createElement("span");b.className="param-value",b.textContent=String(U),k.append(B,b);let y=document.createElement("input");y.type="range",y.min="4",y.max="60",y.value=String(U),y.addEventListener("input",()=>{U=Number(y.value),b.textContent=String(U)}),x.append(k,y),w.appendChild(x),D.appendChild(w);let f=document.createElement("div");f.className="preset-buttons";let v=null;for(let P of y1){let H=document.createElement("button");H.className="preset-btn",H.textContent=P.label,H.addEventListener("click",()=>{let M=P.generate();if(a(M),T(),v)v.classList.remove("active");H.classList.add("active"),v=H}),f.appendChild(H)}D.appendChild(f);let m=document.createElement("div");m.className="mask-tools";let g=document.createElement("button");g.textContent="CLEAR",g.addEventListener("click",()=>{if(a(new Float32Array(C*C)),T(),v)v.classList.remove("active");v=null});let p=document.createElement("button");return p.textContent="INVERT",p.addEventListener("click",()=>{let P=h().mask;for(let H=0;H<C*C;H++)P[H]=P[H]>0?0:1;a(P),T()}),m.append(g,p),D.appendChild(m),T(),{setDisplaySize(P){J.style.width=P+"px",J.style.height=P+"px"}}}var K1=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function q2(F){if(!Number.isFinite(F))return 128;return Math.round(Math.max(128,Math.min(768,F)))}function B1(F,A){let D=document.createElement("div");D.className="canvas-size-controls";let _=document.createElement("div");_.className="param-group";let J=document.createElement("div");J.className="param-label";let q=document.createElement("span");q.className="param-name",q.textContent="Canvas Size";let $=document.createElement("span");$.className="param-value";let Q=document.createElement("span");Q.className="param-unit",Q.textContent="px";let U=document.createElement("span");U.append($,Q),J.append(q,U);let G=document.createElement("input");G.type="range",G.min=String(128),G.max=String(768),G.step="1",G.value=String(384),_.append(J,G),D.appendChild(_);let K=document.createElement("div");K.className="size-preset-row";let T=[];for(let V of K1){let j=document.createElement("button");j.className="stamp-btn",j.textContent=V.label,j.addEventListener("click",()=>X(V.size)),T.push(j),K.appendChild(j)}D.appendChild(K);let Z=document.createElement("div");Z.className="size-input-row";let Y=document.createElement("input");Y.type="number",Y.className="size-text-input",Y.min=String(128),Y.max=String(768),Y.value=String(384);let E=document.createElement("span");E.className="param-unit",E.textContent="px",Y.addEventListener("change",()=>{X(Number(Y.value))}),Z.append(Y,E),D.appendChild(Z),F.appendChild(D);function X(V){let j=q2(V);G.value=String(j),$.textContent=String(j),Y.value=String(j);for(let W=0;W<K1.length;W++)T[W].classList.toggle("active",K1[W].size===j);A(j)}G.addEventListener("input",()=>{X(Number(G.value))}),X(384)}var G2=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}],K2=[{key:"z4",label:"Defocus",noll:4},{key:"z5",label:"Oblq Astig",noll:5},{key:"z6",label:"Vert Astig",noll:6},{key:"z7",label:"Vert Coma",noll:7},{key:"z8",label:"Horz Coma",noll:8},{key:"z9",label:"Spherical",noll:9},{key:"z10",label:"Oblq Trefoil",noll:10},{key:"z11",label:"Vert Trefoil",noll:11}];function x1(F){let A=[];for(let U of G2){let G=document.createElement("div");G.className="param-group";let K=document.createElement("div");K.className="param-label";let T=document.createElement("span");T.className="param-name",T.textContent=U.label;let Z=document.createElement("span"),Y=document.createElement("span");Y.className="param-value";let E=document.createElement("span");E.className="param-unit",E.textContent=U.unit,Z.append(Y,E),K.append(T,Z);let X=document.createElement("input");X.type="range",X.min=String(U.min),X.max=String(U.max),X.step=String(U.step),X.value=String(h().params[U.key]);let V=(j)=>{Y.textContent=j.toFixed(U.decimals)};V(h().params[U.key]),X.addEventListener("input",()=>{let j=parseFloat(X.value);V(j),M1(U.key,j)}),G.append(K,X),F.appendChild(G),A.push({def:U,input:X,updateDisplay:V})}let D=document.createElement("div");D.className="aberration-section";let _=document.createElement("button");_.className="aberration-toggle",_.innerHTML='<span class="aberration-arrow">▶</span> Aberrations (Zernike)';let J=!1,q=document.createElement("div");q.className="aberration-body",q.style.display="none";let $=[];for(let U of K2){let G=document.createElement("div");G.className="param-group zernike-group";let K=document.createElement("div");K.className="param-label";let T=document.createElement("span");T.className="param-name",T.textContent=`Z${U.noll} ${U.label}`;let Z=document.createElement("span"),Y=document.createElement("span");Y.className="param-value";let E=document.createElement("span");E.className="param-unit",E.textContent="λ",Z.append(Y,E),K.append(T,Z);let X=document.createElement("input");X.type="range",X.min="-1",X.max="1",X.step="0.01",X.value=String(h().params.zernike[U.key]);let V=(j)=>{Y.textContent=j.toFixed(2)};V(h().params.zernike[U.key]),X.addEventListener("input",()=>{let j=parseFloat(X.value);V(j),R1(U.key,j)}),G.append(K,X),q.appendChild(G),$.push({def:U,input:X,updateDisplay:V})}_.addEventListener("click",()=>{J=!J,q.style.display=J?"block":"none";let U=_.querySelector(".aberration-arrow");U.textContent=J?"▼":"▶"}),D.append(_,q),F.appendChild(D);let Q=document.createElement("button");Q.className="reset-params-btn",Q.textContent="Reset Defaults",Q.addEventListener("click",()=>{k1();for(let{def:U,input:G,updateDisplay:K}of A){let T=J1[U.key];G.value=String(T),K(T)}for(let{def:U,input:G,updateDisplay:K}of $){let T=i[U.key];G.value=String(T),K(T)}}),F.appendChild(Q)}var P2=[{key:"threshold",label:"Resist Threshold",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"crossSectionRow",label:"Cross-Section Row",unit:"px",min:0,max:255,step:1,decimals:0}];function N1(F){let A=[],D=document.createElement("div");D.className="panel-title",D.style.padding="8px 0 4px",D.style.border="none",D.textContent="Resist / Cross-Section",F.appendChild(D);for(let _ of P2){let J=document.createElement("div");J.className="param-group";let q=document.createElement("div");q.className="param-label";let $=document.createElement("span");$.className="param-name",$.textContent=_.label;let Q=document.createElement("span"),U=document.createElement("span");U.className="param-value";let G=document.createElement("span");G.className="param-unit",G.textContent=_.unit,Q.append(U,G),q.append($,Q);let K=document.createElement("input");K.type="range",K.min=String(_.min),K.max=String(_.max),K.step=String(_.step),K.value=String(h().viewParams[_.key]);let T=(Z)=>{U.textContent=Z.toFixed(_.decimals)};T(h().viewParams[_.key]),K.addEventListener("input",()=>{let Z=parseFloat(K.value);T(Z),w1(_.key,Z)}),J.append(q,K),F.appendChild(J),A.push({def:_,input:K,updateDisplay:T})}return{syncFromState(){for(let{def:_,input:J,updateDisplay:q}of A){let $=h().viewParams[_.key];J.value=String($),q($)}}}}var b1=[{key:"focusSteps",label:"Focus Steps",unit:"",min:5,max:21,step:2,decimals:0,defaultValue:11},{key:"doseMin",label:"Dose Min",unit:"",min:0.5,max:1.5,step:0.05,decimals:2,defaultValue:0.7},{key:"doseMax",label:"Dose Max",unit:"",min:0.5,max:1.5,step:0.05,decimals:2,defaultValue:1.3},{key:"doseSteps",label:"Dose Steps",unit:"",min:3,max:9,step:1,decimals:0,defaultValue:7}];function z1(F,A){let D=document.createElement("div");D.className="bossung-section";let _=document.createElement("div");_.className="panel-title",_.style.padding="0 0 8px",_.style.border="none",_.textContent="Process Window",D.appendChild(_);let J=document.createElement("div");J.className="param-label",J.style.marginBottom="8px";let q=document.createElement("span");q.className="param-name",q.textContent="Focus Range";let $=document.createElement("span");$.innerHTML='<span class="param-value">-2.0</span> to <span class="param-value">+2.0</span> <span class="param-unit">μm</span>',J.append(q,$),D.appendChild(J);let Q={};for(let Z of b1)Q[Z.key]=Z.defaultValue;for(let Z of b1){let Y=document.createElement("div");Y.className="param-group";let E=document.createElement("div");E.className="param-label";let X=document.createElement("span");X.className="param-name",X.textContent=Z.label;let V=document.createElement("span"),j=document.createElement("span");j.className="param-value",j.textContent=Z.defaultValue.toFixed(Z.decimals);let W=document.createElement("span");W.className="param-unit",W.textContent=Z.unit,V.append(j,W),E.append(X,V);let I=document.createElement("input");I.type="range",I.min=String(Z.min),I.max=String(Z.max),I.step=String(Z.step),I.value=String(Z.defaultValue),I.addEventListener("input",()=>{let w=parseFloat(I.value);Q[Z.key]=w,j.textContent=w.toFixed(Z.decimals)}),Y.append(E,I),D.appendChild(Y)}let U=document.createElement("button");U.className="bossung-run-btn",U.textContent="Run Bossung Analysis",U.addEventListener("click",()=>{let Z={focusRange:[-2,2],focusSteps:Q.focusSteps,doseRange:[Q.doseMin,Q.doseMax],doseSteps:Q.doseSteps};A(Z)}),D.appendChild(U);let G=document.createElement("div");G.className="bossung-timing",G.innerHTML='Sweep: <span class="value">--</span> ms (<span class="value bossung-runs">--</span> runs)',D.appendChild(G),F.appendChild(D);let K=G.querySelector(".value"),T=G.querySelector(".bossung-runs");return{setTiming(Z,Y){K.textContent=Z.toFixed(1),T.textContent=String(Y)},setRunning(Z){U.disabled=Z,U.textContent=Z?"Running…":"Run Bossung Analysis"}}}var S1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,v1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var T2=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function h1(){let F=new Uint8Array(1024);for(let A=0;A<256;A++){let D=T2[A];F[A*4+0]=D[0],F[A*4+1]=D[1],F[A*4+2]=D[2],F[A*4+3]=255}return F}var o=256;class P1{gl;program;intensityTex;colormapTex;vao;constructor(F){F.width=o,F.height=o;let A=F.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!A)throw Error("WebGL2 not supported");this.gl=A;let D=A.getExtension("EXT_color_buffer_float");this.program=this.createProgram(S1,v1),this.vao=A.createVertexArray(),this.intensityTex=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.intensityTex),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texImage2D(A.TEXTURE_2D,0,A.R32F,o,o,0,A.RED,A.FLOAT,null),this.colormapTex=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.colormapTex),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);let _=h1();A.texImage2D(A.TEXTURE_2D,0,A.RGBA,256,1,0,A.RGBA,A.UNSIGNED_BYTE,_),A.useProgram(this.program),A.uniform1i(A.getUniformLocation(this.program,"uIntensity"),0),A.uniform1i(A.getUniformLocation(this.program,"uColormap"),1)}draw(F){let A=this.gl;A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,this.intensityTex),A.texSubImage2D(A.TEXTURE_2D,0,0,0,o,o,A.RED,A.FLOAT,F),A.activeTexture(A.TEXTURE1),A.bindTexture(A.TEXTURE_2D,this.colormapTex),A.useProgram(this.program),A.bindVertexArray(this.vao),A.viewport(0,0,o,o),A.drawArrays(A.TRIANGLES,0,3)}resize(F,A){}createProgram(F,A){let D=this.gl,_=this.compileShader(D.VERTEX_SHADER,F),J=this.compileShader(D.FRAGMENT_SHADER,A),q=D.createProgram();if(D.attachShader(q,_),D.attachShader(q,J),D.linkProgram(q),!D.getProgramParameter(q,D.LINK_STATUS)){let $=D.getProgramInfoLog(q);throw D.deleteProgram(q),Error("Shader link error: "+$)}return D.deleteShader(_),D.deleteShader(J),q}compileShader(F,A){let D=this.gl,_=D.createShader(F);if(D.shaderSource(_,A),D.compileShader(_),!D.getShaderParameter(_,D.COMPILE_STATUS)){let J=D.getShaderInfoLog(_);throw D.deleteShader(_),Error("Shader compile error: "+J)}return _}}class T1{ctx;imageData;constructor(F){F.width=256,F.height=256,this.ctx=F.getContext("2d"),this.imageData=this.ctx.createImageData(256,256)}draw(F,A){let D=this.imageData.data;for(let _=0;_<65536;_++){let J=_*4;if(F[_]>=A)D[J]=88,D[J+1]=166,D[J+2]=255;else D[J]=13,D[J+1]=17,D[J+2]=23;D[J+3]=255}this.ctx.putImageData(this.imageData,0,0)}}class Z1{ctx;w;h;constructor(F,A,D){this.w=A,this.h=D;let _=window.devicePixelRatio||1;F.width=A*_,F.height=D*_,F.style.width=A+"px",F.style.height=D+"px",this.ctx=F.getContext("2d"),this.ctx.scale(_,_)}draw(F,A,D){let _=this.ctx,J=this.w,q=this.h,$=J-40-12,Q=q-12-28;_.fillStyle="#0d1117",_.fillRect(0,0,J,q),_.strokeStyle="#30363d",_.lineWidth=1,_.beginPath(),_.moveTo(40,12),_.lineTo(40,12+Q),_.lineTo(40+$,12+Q),_.stroke(),_.fillStyle="#8b949e",_.font="9px monospace",_.textAlign="right",_.textBaseline="middle";for(let K of[0,0.5,1]){let T=12+Q*(1-K);_.fillText(K.toFixed(1),36,T),_.strokeStyle="#21262d",_.lineWidth=0.5,_.beginPath(),_.moveTo(40,T),_.lineTo(40+$,T),_.stroke()}_.fillStyle="#8b949e",_.textAlign="center",_.textBaseline="top";for(let K of[0,128,255]){let T=40+K/255*$;_.fillText(String(K),T,12+Q+4)}_.fillStyle="#8b949e",_.textAlign="right",_.textBaseline="top",_.fillText("Row "+A,40+$,12+Q+4);let U=12+Q*(1-D);_.strokeStyle="#f85149",_.lineWidth=1,_.setLineDash([4,3]),_.beginPath(),_.moveTo(40,U),_.lineTo(40+$,U),_.stroke(),_.setLineDash([]),_.fillStyle="#f85149",_.font="9px monospace",_.textAlign="left",_.textBaseline="bottom",_.fillText("T="+D.toFixed(2),43,U-2);let G=A*256;_.strokeStyle="#58a6ff",_.lineWidth=1.5,_.beginPath();for(let K=0;K<256;K++){let T=40+K/255*$,Z=Math.max(0,Math.min(1,F[G+K])),Y=12+Q*(1-Z);if(K===0)_.moveTo(T,Y);else _.lineTo(T,Y)}_.stroke()}}var Q1=["#58a6ff","#3fb950","#f0883e","#bc8cff","#f778ba","#ffd33d","#a5d6ff","#ff7b72","#7ee787"];var n={top:40,right:130,bottom:55,left:70};class H1{canvas;ctx;constructor(F){this.canvas=F,this.ctx=F.getContext("2d")}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}draw(F){let A=this.canvas,D=this.ctx,_=window.devicePixelRatio||1,J=A.getBoundingClientRect(),q=J.width,$=J.height;A.width=q*_,A.height=$*_,D.setTransform(_,0,0,_,0,0);let{left:Q,top:U}=n,G=q-n.left-n.right,K=$-n.top-n.bottom;if(G<40||K<40)return;let T=F.focusValues[0],Z=F.focusValues[F.focusValues.length-1],Y=1/0,E=-1/0;for(let O of F.curves)for(let L of O.points){if(L.cd<Y)Y=L.cd;if(L.cd>E)E=L.cd}if(!isFinite(Y)||!isFinite(E)||Y===E)Y=0,E=200;else{let O=(E-Y)*0.1||20;Y=Math.max(0,Y-O),E=E+O}let X=(O)=>Q+(O-T)/(Z-T)*G,V=(O)=>U+K-(O-Y)/(E-Y)*K;D.fillStyle="#161b22",D.fillRect(0,0,q,$),D.font='10px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="center",D.textBaseline="top";let j=g1(T,Z,8),W=g1(Y,E,6);D.strokeStyle="rgba(48, 54, 61, 0.6)",D.lineWidth=1,D.setLineDash([4,4]);for(let O of j){let L=X(O);D.beginPath(),D.moveTo(L,U),D.lineTo(L,U+K),D.stroke(),D.fillStyle="#8b949e",D.fillText(O.toFixed(1),L,U+K+8)}D.textAlign="right",D.textBaseline="middle";for(let O of W){let L=V(O);D.beginPath(),D.moveTo(Q,L),D.lineTo(Q+G,L),D.stroke(),D.fillStyle="#8b949e",D.fillText(O.toFixed(0),Q-8,L)}D.setLineDash([]),D.strokeStyle="rgba(48, 54, 61, 0.6)",D.lineWidth=1,D.strokeRect(Q,U,G,K);for(let O=0;O<F.curves.length;O++){let L=F.curves[O],x=Q1[O%Q1.length];D.strokeStyle=x,D.lineWidth=2,D.lineJoin="round",D.lineCap="round",D.beginPath();for(let k=0;k<L.points.length;k++){let B=L.points[k],b=X(B.focus),y=V(B.cd);if(k===0)D.moveTo(b,y);else D.lineTo(b,y)}D.stroke(),D.fillStyle=x;for(let k of L.points)D.beginPath(),D.arc(X(k.focus),V(k.cd),3,0,Math.PI*2),D.fill()}D.fillStyle="#8b949e",D.font='11px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="center",D.textBaseline="top",D.fillText("Defocus (μm)",Q+G/2,U+K+30),D.save(),D.translate(16,U+K/2),D.rotate(-Math.PI/2),D.textAlign="center",D.textBaseline="middle",D.fillText("CD (nm)",0,0),D.restore(),D.fillStyle="#e6edf3",D.font='12px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="center",D.textBaseline="top",D.fillText("Bossung Curves",Q+G/2,12);let I=Q+G+16,w=U+4;D.font='10px "SF Mono", "Cascadia Code", "Fira Code", monospace',D.textAlign="left",D.textBaseline="middle";for(let O=0;O<F.curves.length;O++){let L=Q1[O%Q1.length],x=F.doseValues[O];D.strokeStyle=L,D.lineWidth=2,D.beginPath(),D.moveTo(I,w),D.lineTo(I+18,w),D.stroke(),D.fillStyle="#8b949e",D.fillText(`D=${x.toFixed(2)}`,I+24,w),w+=18}}}function g1(F,A,D){let _=A-F;if(_<=0)return[F];let J=_/D,q=Math.pow(10,Math.floor(Math.log10(J))),$,Q=J/q;if(Q<=1.5)$=q;else if(Q<=3.5)$=2*q;else if(Q<=7.5)$=5*q;else $=10*q;let U=[],G=Math.ceil(F/$)*$;for(let K=G;K<=A+$*0.01;K+=$)U.push(Math.round(K/$)*$);return U}function Z2(F,A){let D=0;for(let _=0;_<A;_++)D=D<<1|F&1,F>>=1;return D}function H2(F){let A=Math.log2(F)|0,D=new Uint32Array(F);for(let _=0;_<F;_++)D[_]=Z2(_,A);return D}var f1=new Map,m1=new Map;function Y2(F){let A=f1.get(F);if(!A)A=H2(F),f1.set(F,A);return A}function X2(F,A){let D=`${F}_${A?1:0}`,_=m1.get(D);if(!_){let J=F*2;_=new Float64Array(F*2);let $=(A?1:-1)*Math.PI/F;for(let Q=0;Q<F;Q++){let U=$*Q;_[Q*2]=Math.cos(U),_[Q*2+1]=Math.sin(U)}m1.set(D,_)}return _}function u1(F,A,D,_=0,J=1){let q=Math.log2(A)|0,$=Y2(A);if(J===1&&_===0)for(let Q=0;Q<A;Q++){let U=$[Q];if(U>Q){let G=Q*2,K=U*2,T=F[G];F[G]=F[K],F[K]=T,T=F[G+1],F[G+1]=F[K+1],F[K+1]=T}}else{let Q=new Float64Array(A*2);for(let U=0;U<A;U++){let G=(_+U*J)*2,K=$[U]*2;Q[K]=F[G],Q[K+1]=F[G+1]}for(let U=0;U<A;U++){let G=(_+U*J)*2;F[G]=Q[U*2],F[G+1]=Q[U*2+1]}}for(let Q=1;Q<=q;Q++){let U=1<<Q,G=U>>1,K=X2(G,D);for(let T=0;T<A;T+=U)for(let Z=0;Z<G;Z++){let Y=(_+(T+Z)*J)*2,E=(_+(T+Z+G)*J)*2,X=K[Z*2],V=K[Z*2+1],j=F[E],W=F[E+1],I=X*j-V*W,w=X*W+V*j,O=F[Y],L=F[Y+1];F[Y]=O+I,F[Y+1]=L+w,F[E]=O-I,F[E+1]=L-w}}if(D){let Q=1/A;for(let U=0;U<A;U++){let G=(_+U*J)*2;F[G]*=Q,F[G+1]*=Q}}}function Y1(F,A,D){let _=new Float64Array(A*2);for(let q=0;q<A;q++){let $=q*A*2;_.set(F.subarray($,$+A*2)),u1(_,A,D),F.set(_,$)}let J=new Float64Array(A*2);for(let q=0;q<A;q++){for(let $=0;$<A;$++)J[$*2]=F[($*A+q)*2],J[$*2+1]=F[($*A+q)*2+1];u1(J,A,D);for(let $=0;$<A;$++)F[($*A+q)*2]=J[$*2],F[($*A+q)*2+1]=J[$*2+1]}}function X1(F,A){let D=A>>1;for(let _=0;_<D;_++)for(let J=0;J<A;J++){let q=_+D,$=(J+D)%A,Q=(_*A+J)*2,U=(q*A+$)*2,G=F[Q];F[Q]=F[U],F[U]=G,G=F[Q+1],F[Q+1]=F[U+1],F[U+1]=G}}function c1(F,A,D){let{wavelength:_,na:J,sigma:q,defocus:$,zernike:Q}=D,U=19.53125,G=1/(A*19.53125),T=J*(1+q)/_,Z=T*T,Y=$*1000,E=Math.PI*_*Y,X=Q.z4!==0||Q.z5!==0||Q.z6!==0||Q.z7!==0||Q.z8!==0||Q.z9!==0||Q.z10!==0||Q.z11!==0,V=2*Math.PI,j=A>>1;for(let W=0;W<A;W++){let I=(W-j)*G,w=I*I;for(let O=0;O<A;O++){let L=(O-j)*G,x=L*L+w,k=(W*A+O)*2;if(x>Z)F[k]=0,F[k+1]=0;else{let B=Y!==0?E*x:0;if(X){let y=Math.sqrt(x)/T,f=Math.atan2(I,L);B+=V*E1(y,f,Q)}if(B!==0){let b=Math.cos(B),y=Math.sin(B),f=F[k],v=F[k+1];F[k]=f*b-v*y,F[k+1]=f*y+v*b}}}}}var r=256,s=r*r,$1=null;function j2(){if(!$1||$1.length!==s*2)$1=new Float64Array(s*2);return $1}function U1(F,A){let D=performance.now(),_=j2();for(let Q=0;Q<s;Q++)_[Q*2]=F[Q],_[Q*2+1]=0;Y1(_,r,!1),X1(_,r),c1(_,r,A),X1(_,r),Y1(_,r,!0);let J=new Float32Array(s),q=0;for(let Q=0;Q<s;Q++){let U=_[Q*2],G=_[Q*2+1],K=U*U+G*G;if(J[Q]=K,K>q)q=K}if(q>0){let Q=1/q;for(let U=0;U<s;U++)J[U]*=Q}let $=performance.now()-D;return{intensity:J,timeMs:$}}var t=256,O2=19.53125;function d1(F,A,D){if(D===1)return[(F+A)/2];let _=[];for(let J=0;J<D;J++)_.push(F+(A-F)*J/(D-1));return _}function E2(F,A){let _=(t>>1)*t,J=0,q=-1,$=-1;for(let Q=0;Q<=t;Q++){let U=Q<t&&F[_+Q]*A>=1;if(U&&$<0)$=Q;else if(!U&&$>=0){let G=Q-$,K=$+G/2;if(G>J||G===J&&Math.abs(K-t/2)<Math.abs(q-t/2))J=G,q=K;$=-1}}return J*O2}function p1(F,A,D){let _=performance.now(),J=d1(D.focusRange[0],D.focusRange[1],D.focusSteps),q=d1(D.doseRange[0],D.doseRange[1],D.doseSteps),$=q.map((U)=>({dose:U,points:[]}));for(let U of J){let G={...A,defocus:U},K=U1(F,G);for(let T=0;T<q.length;T++){let Z=E2(K.intensity,q[T]);$[T].points.push({focus:U,cd:Z})}}let Q=performance.now()-_;return{curves:$,focusValues:J,doseValues:q,timeMs:Q,pipelineRuns:J.length}}function l1(){let F=document.getElementById("app"),{maskPanel:A,heatmapCanvas:D,resistCanvas:_,crossSectionCanvas:J,crossSectionLine:q,heatmapWrap:$,paramsPanel:Q,timingReadout:U,zoomSlider:G,zoomInBtn:K,zoomOutBtn:T,zoomLabel:Z,heatmapContainer:Y,downloadBtn:E,bossungCanvas:X,bossungChartContainer:V}=O1(F),j=C1(A),W=document.createElement("div");Q.insertBefore(W,Q.firstChild),B1(W,(P)=>{D.style.width=P+"px",D.style.height=P+"px",_.style.width=P+"px",_.style.height=P+"px"});let I=document.createElement("div");I.style.padding="10px 0",Q.insertBefore(I,U),x1(I);let w=document.createElement("div");w.style.padding="10px 0",w.style.borderTop="1px solid var(--border)",Q.insertBefore(w,U);let O=N1(w),L=document.createElement("div");Q.insertBefore(L,U);let x=new H1(X),k=z1(L,(P)=>{k.setRunning(!0),setTimeout(()=>{let H=h(),M=p1(H.mask,H.params,P);x.draw(M),k.setTiming(M.timeMs,M.pipelineRuns),k.setRunning(!1);let R=V._showBossung;if(R)R()},0)}),B=new P1(D),b=new T1(_),y=new Z1(J,540,140),f=document.getElementById("timing-sim"),v=document.getElementById("timing-render");I1((P)=>{let H=U1(P.mask,P.params);f.textContent=H.timeMs.toFixed(1);let M=performance.now();B.draw(H.intensity),b.draw(H.intensity,P.viewParams.threshold),y.draw(H.intensity,P.viewParams.crossSectionRow,P.viewParams.threshold);let R=performance.now()-M;v.textContent=R.toFixed(1);let N=P.viewParams.crossSectionRow/255;q.style.top=N*100+"%"});let m=0;function g(P){if(m===0)m=D.offsetWidth;if(P===1)D.style.width="",D.style.height="",D.style.maxWidth="",D.style.maxHeight="",D.style.minWidth="",D.style.minHeight="",_.style.width="",_.style.height="",_.style.maxWidth="",_.style.maxHeight="",_.style.minWidth="",_.style.minHeight="";else{let H=m*P;D.style.width=`${H}px`,D.style.height=`${H}px`,D.style.maxWidth="none",D.style.maxHeight="none",D.style.minWidth=`${H}px`,D.style.minHeight=`${H}px`,_.style.width=`${H}px`,_.style.height=`${H}px`,_.style.maxWidth="none",_.style.maxHeight="none",_.style.minWidth=`${H}px`,_.style.minHeight=`${H}px`}Z.textContent=`${Math.round(P*100)}%`,G.value=String(P)}G.addEventListener("input",()=>{g(parseFloat(G.value))}),T.addEventListener("click",()=>{let P=Math.max(0.5,parseFloat(G.value)-0.1);g(Math.round(P*10)/10)}),K.addEventListener("click",()=>{let P=Math.min(4,parseFloat(G.value)+0.1);g(Math.round(P*10)/10)}),E.addEventListener("click",()=>{let P=document.createElement("a"),H=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);P.download=`lithography-simulation-${H}.png`,P.href=D.toDataURL("image/png"),P.click()});let p=A.querySelector(".preset-btn");if(p)p.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",l1);else l1();
