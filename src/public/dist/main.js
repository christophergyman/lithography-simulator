function U1(_){_.innerHTML="";let A=document.createElement("div");A.className="header";let E=document.createElement("h1");E.textContent="Lithography Simulator";let D=document.createElement("span");D.className="subtitle",D.textContent="Fourier Optics / Aerial Image";let P=document.createElement("button");P.className="download-btn",P.textContent="Export PNG",A.append(E,D,P);let U=document.createElement("div");U.className="panel",U.dataset.panel="mask";let T=document.createElement("div");T.className="panel panel-heatmap",T.dataset.panel="view";let F=document.createElement("div");F.className="heatmap-container";let H=document.createElement("div");H.className="viz-toggle-bar";let J=[{key:"aerial",label:"Aerial"},{key:"resist",label:"Resist"},{key:"split",label:"Split"}],G=[];for(let M of J){let v=document.createElement("button");v.className="viz-toggle-btn",v.textContent=M.label,v.dataset.mode=M.key,G.push(v),H.appendChild(v)}let Q=document.createElement("div");Q.className="viz-toggle-sep",H.appendChild(Q);let Y=document.createElement("button");Y.className="viz-toggle-btn",Y.textContent="Cross-Section",Y.dataset.mode="cs",H.appendChild(Y);let q=document.createElement("div");q.className="viz-grid",q.appendChild(H);let R=document.createElement("div");R.className="viz-image-row";let j=document.createElement("div");j.className="viz-image-wrap";let I=document.createElement("div");I.className="viz-label",I.textContent="Aerial Image";let K=document.createElement("canvas"),Z=document.createElement("div");Z.className="cross-section-line",j.append(I,K,Z);let c=document.createElement("div");c.className="viz-image-wrap";let w=document.createElement("div");w.className="viz-label",w.textContent="Resist Image";let y=document.createElement("canvas");c.append(w,y),R.append(j,c);let C=document.createElement("div");C.className="cross-section-wrap";let h=document.createElement("canvas");h.className="cross-section-canvas",C.appendChild(h),q.append(R,C),F.appendChild(q),T.appendChild(F);let b="aerial",x=!1;function B(){for(let M of G)M.classList.toggle("active",M.dataset.mode===b);Y.classList.toggle("active",x),j.style.display=b==="resist"?"none":"",c.style.display=b==="aerial"?"none":"",C.style.display=x?"":"none",Z.style.display=x?"":"none"}function S(M){b=M,B()}function $(){return x=!x,B(),x}for(let M of G)M.addEventListener("click",()=>{S(M.dataset.mode)});Y.addEventListener("click",()=>{$()}),B();let X=document.createElement("div");X.className="panel panel-params",X.dataset.panel="params";let N=document.createElement("div");N.className="panel-title",N.textContent="Parameters",X.appendChild(N);let p=document.createElement("div");p.className="timing-readout",p.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,X.appendChild(p);let g=document.createElement("div");g.className="zoom-bar";let L=document.createElement("button");L.className="zoom-btn",L.textContent="−";let O=document.createElement("input");O.type="range",O.className="zoom-slider",O.min="0.5",O.max="4",O.step="0.1",O.value="1";let u=document.createElement("button");u.className="zoom-btn",u.textContent="+";let V=document.createElement("span");V.className="zoom-label",V.textContent="100%",g.append(L,O,u,V),F.appendChild(g);let k=document.createElement("div");k.className="mobile-tab-bar";let z=[{key:"mask",label:"Mask"},{key:"view",label:"View"},{key:"params",label:"Params"}],m=[];for(let M of z){let v=document.createElement("button");v.className="mobile-tab-btn",v.textContent=M.label,v.dataset.tab=M.key,v.addEventListener("click",()=>{_.dataset.activeTab=M.key;for(let T1 of m)T1.classList.toggle("active",T1.dataset.tab===M.key)}),m.push(v),k.appendChild(v)}return _.dataset.activeTab="view",m[1].classList.add("active"),_.append(A,U,T,X,k),{maskPanel:U,heatmapCanvas:K,resistCanvas:y,crossSectionCanvas:h,crossSectionLine:Z,heatmapWrap:j,resistWrap:c,crossSectionWrap:C,paramsPanel:X,timingReadout:p,zoomSlider:O,zoomInBtn:u,zoomOutBtn:L,zoomLabel:V,heatmapContainer:F,mobileTabBar:k,downloadBtn:P,setVizMode:S,toggleCrossSection:$}}var H1={threshold:0.3,crossSectionRow:128},G1=[],a=!1,t={wavelength:248,na:0.75,sigma:0.5,defocus:0},o={mask:new Float32Array(65536),params:{...t},viewParams:{...H1}};function e(){if(a)return;a=!0,requestAnimationFrame(()=>{a=!1;for(let _ of G1)_(o)})}function f(){return o}function J1(_){G1.push(_)}function d(_){o.mask=_,e()}function L1(_,A){o.params[_]=A,e()}function O1(_,A){o.viewParams[_]=A,e()}function Q1(){Object.assign(o.params,t),Object.assign(o.viewParams,H1),e()}function i(){return new Float32Array(65536)}function y1(){let _=i(),A=10,E=5;for(let D=0;D<256;D++)for(let P=0;P<256;P++)if(P%10<5)_[D*256+P]=1;return _}function x1(){let _=i(),A=20,E=6,D=Math.floor(7);for(let P=0;P<256;P++)for(let U=0;U<256;U++){let T=P%20,F=U%20;if(T>=D&&T<D+6&&F>=D&&F<D+6)_[P*256+U]=1}return _}function C1(){let _=i(),A=6,E=125,D=131;for(let P=0;P<256;P++)for(let U=125;U<131;U++)_[P*256+U]=1;return _}function k1(){let _=i(),A=5,E=2;for(let D=0;D<256;D++)for(let P=0;P<256;P++)if(P%5<2)_[D*256+P]=1;return _}function c1(){let _=i(),A=128,E=128,D=60,P=10;for(let U=0;U<256;U++)for(let T=0;T<256;T++){let F=U-128,H=T-128,J=H>=0&&H<60&&F>=-5&&F<5,G=F>=0&&F<60&&H>=-5&&H<5;if(J||G)_[U*256+T]=1}return _}var Y1=[{name:"line_space",label:"Line/Space (10px)",generate:y1},{name:"contacts",label:"Contact Holes",generate:x1},{name:"isolated_line",label:"Isolated Line",generate:C1},{name:"dense_lines",label:"Dense Lines (5px)",generate:k1},{name:"l_shape",label:"L-Shape Corner",generate:c1}];var W=256;function B1(_,A){let E=A/2,D=[],P=Math.floor(A/2);switch(_){case"square":for(let U=-P;U<=P;U++)for(let T=-P;T<=P;T++)D.push([T,U]);break;case"circle":for(let U=-P;U<=P;U++)for(let T=-P;T<=P;T++)if(T*T+U*U<=E*E)D.push([T,U]);break;case"ring":{let U=E*0.6;for(let T=-P;T<=P;T++)for(let F=-P;F<=P;F++){let H=F*F+T*T;if(H<=E*E&&H>=U*U)D.push([F,T])}break}case"cross":{let U=Math.max(1,Math.floor(A/6));for(let T=-P;T<=P;T++)for(let F=-P;F<=P;F++)if(Math.abs(F)<=U||Math.abs(T)<=U)D.push([F,T]);break}case"lineH":{let U=Math.max(1,Math.floor(A/6));for(let T=-U;T<=U;T++)for(let F=-P;F<=P;F++)D.push([F,T]);break}case"lineV":{let U=Math.max(1,Math.floor(A/6));for(let T=-P;T<=P;T++)for(let F=-U;F<=U;F++)D.push([F,T]);break}}return D}var b1=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function $1(_){let A=document.createElement("div");A.className="panel-title",A.textContent="Mask Editor",_.appendChild(A);let E=document.createElement("div");E.className="panel-mask",_.appendChild(E);let D=document.createElement("div");D.className="mask-canvas-wrap";let P=document.createElement("canvas");P.width=W,P.height=W,D.appendChild(P),E.appendChild(D);let U=P.getContext("2d"),T="brush",F="square",H=20,J=!1,G=1;function Q(){let L=f().mask,O=U.createImageData(W,W),u=O.data;for(let V=0;V<W*W;V++){let k=L[V]>0?255:0;u[V*4]=k,u[V*4+1]=k,u[V*4+2]=k,u[V*4+3]=255}U.putImageData(O,0,0)}function Y(L){let O=P.getBoundingClientRect(),u=W/O.width,V=W/O.height,k=Math.floor((L.clientX-O.left)*u),z=Math.floor((L.clientY-O.top)*V);return[Math.max(0,Math.min(W-1,k)),Math.max(0,Math.min(W-1,z))]}function q(L,O,u){for(let V=-1;V<=1;V++)for(let k=-1;k<=1;k++){let z=L+k,m=O+V;if(z>=0&&z<W&&m>=0&&m<W)u[m*W+z]=G}}function R(L,O,u){let V=B1(F,H);for(let[k,z]of V){let m=L+k,M=O+z;if(m>=0&&m<W&&M>=0&&M<W)u[M*W+m]=G}}function j(L){let[O,u]=Y(L),V=f().mask;if(T==="stamp")R(O,u,V);else q(O,u,V);Q(),d(V)}P.style.touchAction="none",P.addEventListener("pointerdown",(L)=>{J=!0,G=L.button===2?0:1,P.setPointerCapture(L.pointerId),j(L)}),P.addEventListener("pointermove",(L)=>{if(J)j(L)}),P.addEventListener("pointerup",(L)=>{J=!1,P.releasePointerCapture(L.pointerId)}),P.addEventListener("pointerleave",()=>{J=!1}),P.addEventListener("contextmenu",(L)=>L.preventDefault());let I=document.createElement("div");I.className="tool-toggle";let K=document.createElement("button");K.textContent="BRUSH",K.classList.add("active");let Z=document.createElement("button");Z.textContent="STAMP";function c(L){T=L,K.classList.toggle("active",L==="brush"),Z.classList.toggle("active",L==="stamp"),w.style.display=L==="stamp"?"":"none"}K.addEventListener("click",()=>c("brush")),Z.addEventListener("click",()=>c("stamp")),I.append(K,Z),E.appendChild(I);let w=document.createElement("div");w.className="stamp-options",w.style.display="none";let y=document.createElement("div");y.className="stamp-shape-row";let C=[];for(let L of b1){let O=document.createElement("button");if(O.className="stamp-btn",O.textContent=L.label,L.key===F)O.classList.add("active");O.addEventListener("click",()=>{F=L.key,C.forEach((u)=>u.classList.remove("active")),O.classList.add("active")}),C.push(O),y.appendChild(O)}w.appendChild(y);let h=document.createElement("div");h.className="param-group";let b=document.createElement("div");b.className="param-label";let x=document.createElement("span");x.className="param-name",x.textContent="Stamp Size";let B=document.createElement("span");B.className="param-value",B.textContent=String(H),b.append(x,B);let S=document.createElement("input");S.type="range",S.min="4",S.max="60",S.value=String(H),S.addEventListener("input",()=>{H=Number(S.value),B.textContent=String(H)}),h.append(b,S),w.appendChild(h),E.appendChild(w);let $=document.createElement("div");$.className="preset-buttons";let X=null;for(let L of Y1){let O=document.createElement("button");O.className="preset-btn",O.textContent=L.label,O.addEventListener("click",()=>{let u=L.generate();if(d(u),Q(),X)X.classList.remove("active");O.classList.add("active"),X=O}),$.appendChild(O)}E.appendChild($);let N=document.createElement("div");N.className="mask-tools";let p=document.createElement("button");p.textContent="CLEAR",p.addEventListener("click",()=>{if(d(new Float32Array(W*W)),Q(),X)X.classList.remove("active");X=null});let g=document.createElement("button");return g.textContent="INVERT",g.addEventListener("click",()=>{let L=f().mask;for(let O=0;O<W*W;O++)L[O]=L[O]>0?0:1;d(L),Q()}),N.append(p,g),E.appendChild(N),Q(),{setDisplaySize(L){P.style.width=L+"px",P.style.height=L+"px"}}}var D1=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function S1(_){if(!Number.isFinite(_))return 128;return Math.round(Math.max(128,Math.min(768,_)))}function K1(_,A){let E=document.createElement("div");E.className="canvas-size-controls";let D=document.createElement("div");D.className="param-group";let P=document.createElement("div");P.className="param-label";let U=document.createElement("span");U.className="param-name",U.textContent="Canvas Size";let T=document.createElement("span");T.className="param-value";let F=document.createElement("span");F.className="param-unit",F.textContent="px";let H=document.createElement("span");H.append(T,F),P.append(U,H);let J=document.createElement("input");J.type="range",J.min=String(128),J.max=String(768),J.step="1",J.value=String(384),D.append(P,J),E.appendChild(D);let G=document.createElement("div");G.className="size-preset-row";let Q=[];for(let I of D1){let K=document.createElement("button");K.className="stamp-btn",K.textContent=I.label,K.addEventListener("click",()=>j(I.size)),Q.push(K),G.appendChild(K)}E.appendChild(G);let Y=document.createElement("div");Y.className="size-input-row";let q=document.createElement("input");q.type="number",q.className="size-text-input",q.min=String(128),q.max=String(768),q.value=String(384);let R=document.createElement("span");R.className="param-unit",R.textContent="px",q.addEventListener("change",()=>{j(Number(q.value))}),Y.append(q,R),E.appendChild(Y),_.appendChild(E);function j(I){let K=S1(I);J.value=String(K),T.textContent=String(K),q.value=String(K);for(let Z=0;Z<D1.length;Z++)Q[Z].classList.toggle("active",D1[Z].size===K);A(K)}J.addEventListener("input",()=>{j(Number(J.value))}),j(384)}var h1=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}];function X1(_){let A=[];for(let D of h1){let P=document.createElement("div");P.className="param-group";let U=document.createElement("div");U.className="param-label";let T=document.createElement("span");T.className="param-name",T.textContent=D.label;let F=document.createElement("span"),H=document.createElement("span");H.className="param-value";let J=document.createElement("span");J.className="param-unit",J.textContent=D.unit,F.append(H,J),U.append(T,F);let G=document.createElement("input");G.type="range",G.min=String(D.min),G.max=String(D.max),G.step=String(D.step),G.value=String(f().params[D.key]);let Q=(Y)=>{H.textContent=Y.toFixed(D.decimals)};Q(f().params[D.key]),G.addEventListener("input",()=>{let Y=parseFloat(G.value);Q(Y),L1(D.key,Y)}),P.append(U,G),_.appendChild(P),A.push({def:D,input:G,updateDisplay:Q})}let E=document.createElement("button");E.className="reset-params-btn",E.textContent="Reset Defaults",E.addEventListener("click",()=>{Q1();for(let{def:D,input:P,updateDisplay:U}of A){let T=t[D.key];P.value=String(T),U(T)}}),_.appendChild(E)}var v1=[{key:"threshold",label:"Resist Threshold",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"crossSectionRow",label:"Cross-Section Row",unit:"px",min:0,max:255,step:1,decimals:0}];function q1(_){let A=[],E=document.createElement("div");E.className="panel-title",E.style.padding="8px 0 4px",E.style.border="none",E.textContent="Resist / Cross-Section",_.appendChild(E);for(let D of v1){let P=document.createElement("div");P.className="param-group";let U=document.createElement("div");U.className="param-label";let T=document.createElement("span");T.className="param-name",T.textContent=D.label;let F=document.createElement("span"),H=document.createElement("span");H.className="param-value";let J=document.createElement("span");J.className="param-unit",J.textContent=D.unit,F.append(H,J),U.append(T,F);let G=document.createElement("input");G.type="range",G.min=String(D.min),G.max=String(D.max),G.step=String(D.step),G.value=String(f().viewParams[D.key]);let Q=(Y)=>{H.textContent=Y.toFixed(D.decimals)};Q(f().viewParams[D.key]),G.addEventListener("input",()=>{let Y=parseFloat(G.value);Q(Y),O1(D.key,Y)}),P.append(U,G),_.appendChild(P),A.push({def:D,input:G,updateDisplay:Q})}return{syncFromState(){for(let{def:D,input:P,updateDisplay:U}of A){let T=f().viewParams[D.key];P.value=String(T),U(T)}}}}var Z1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,V1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var m1=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function j1(){let _=new Uint8Array(1024);for(let A=0;A<256;A++){let E=m1[A];_[A*4+0]=E[0],_[A*4+1]=E[1],_[A*4+2]=E[2],_[A*4+3]=255}return _}var n=256;class A1{gl;program;intensityTex;colormapTex;vao;constructor(_){_.width=n,_.height=n;let A=_.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!A)throw Error("WebGL2 not supported");this.gl=A;let E=A.getExtension("EXT_color_buffer_float");this.program=this.createProgram(Z1,V1),this.vao=A.createVertexArray(),this.intensityTex=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.intensityTex),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texImage2D(A.TEXTURE_2D,0,A.R32F,n,n,0,A.RED,A.FLOAT,null),this.colormapTex=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.colormapTex),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);let D=j1();A.texImage2D(A.TEXTURE_2D,0,A.RGBA,256,1,0,A.RGBA,A.UNSIGNED_BYTE,D),A.useProgram(this.program),A.uniform1i(A.getUniformLocation(this.program,"uIntensity"),0),A.uniform1i(A.getUniformLocation(this.program,"uColormap"),1)}draw(_){let A=this.gl;A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,this.intensityTex),A.texSubImage2D(A.TEXTURE_2D,0,0,0,n,n,A.RED,A.FLOAT,_),A.activeTexture(A.TEXTURE1),A.bindTexture(A.TEXTURE_2D,this.colormapTex),A.useProgram(this.program),A.bindVertexArray(this.vao),A.viewport(0,0,n,n),A.drawArrays(A.TRIANGLES,0,3)}resize(_,A){}createProgram(_,A){let E=this.gl,D=this.compileShader(E.VERTEX_SHADER,_),P=this.compileShader(E.FRAGMENT_SHADER,A),U=E.createProgram();if(E.attachShader(U,D),E.attachShader(U,P),E.linkProgram(U),!E.getProgramParameter(U,E.LINK_STATUS)){let T=E.getProgramInfoLog(U);throw E.deleteProgram(U),Error("Shader link error: "+T)}return E.deleteShader(D),E.deleteShader(P),U}compileShader(_,A){let E=this.gl,D=E.createShader(_);if(E.shaderSource(D,A),E.compileShader(D),!E.getShaderParameter(D,E.COMPILE_STATUS)){let P=E.getShaderInfoLog(D);throw E.deleteShader(D),Error("Shader compile error: "+P)}return D}}class _1{ctx;imageData;constructor(_){_.width=256,_.height=256,this.ctx=_.getContext("2d"),this.imageData=this.ctx.createImageData(256,256)}draw(_,A){let E=this.imageData.data;for(let D=0;D<65536;D++){let P=D*4;if(_[D]>=A)E[P]=88,E[P+1]=166,E[P+2]=255;else E[P]=13,E[P+1]=17,E[P+2]=23;E[P+3]=255}this.ctx.putImageData(this.imageData,0,0)}}class E1{ctx;w;h;constructor(_,A,E){this.w=A,this.h=E;let D=window.devicePixelRatio||1;_.width=A*D,_.height=E*D,_.style.width=A+"px",_.style.height=E+"px",this.ctx=_.getContext("2d"),this.ctx.scale(D,D)}draw(_,A,E){let D=this.ctx,P=this.w,U=this.h,T=P-40-12,F=U-12-28;D.fillStyle="#0d1117",D.fillRect(0,0,P,U),D.strokeStyle="#30363d",D.lineWidth=1,D.beginPath(),D.moveTo(40,12),D.lineTo(40,12+F),D.lineTo(40+T,12+F),D.stroke(),D.fillStyle="#8b949e",D.font="9px monospace",D.textAlign="right",D.textBaseline="middle";for(let G of[0,0.5,1]){let Q=12+F*(1-G);D.fillText(G.toFixed(1),36,Q),D.strokeStyle="#21262d",D.lineWidth=0.5,D.beginPath(),D.moveTo(40,Q),D.lineTo(40+T,Q),D.stroke()}D.fillStyle="#8b949e",D.textAlign="center",D.textBaseline="top";for(let G of[0,128,255]){let Q=40+G/255*T;D.fillText(String(G),Q,12+F+4)}D.fillStyle="#8b949e",D.textAlign="right",D.textBaseline="top",D.fillText("Row "+A,40+T,12+F+4);let H=12+F*(1-E);D.strokeStyle="#f85149",D.lineWidth=1,D.setLineDash([4,3]),D.beginPath(),D.moveTo(40,H),D.lineTo(40+T,H),D.stroke(),D.setLineDash([]),D.fillStyle="#f85149",D.font="9px monospace",D.textAlign="left",D.textBaseline="bottom",D.fillText("T="+E.toFixed(2),43,H-2);let J=A*256;D.strokeStyle="#58a6ff",D.lineWidth=1.5,D.beginPath();for(let G=0;G<256;G++){let Q=40+G/255*T,Y=Math.max(0,Math.min(1,_[J+G])),q=12+F*(1-Y);if(G===0)D.moveTo(Q,q);else D.lineTo(Q,q)}D.stroke()}}function f1(_,A){let E=0;for(let D=0;D<A;D++)E=E<<1|_&1,_>>=1;return E}function p1(_){let A=Math.log2(_)|0,E=new Uint32Array(_);for(let D=0;D<_;D++)E[D]=f1(D,A);return E}var u1=new Map,I1=new Map;function N1(_){let A=u1.get(_);if(!A)A=p1(_),u1.set(_,A);return A}function g1(_,A){let E=`${_}_${A?1:0}`,D=I1.get(E);if(!D){let P=_*2;D=new Float64Array(_*2);let T=(A?1:-1)*Math.PI/_;for(let F=0;F<_;F++){let H=T*F;D[F*2]=Math.cos(H),D[F*2+1]=Math.sin(H)}I1.set(E,D)}return D}function W1(_,A,E,D=0,P=1){let U=Math.log2(A)|0,T=N1(A);if(P===1&&D===0)for(let F=0;F<A;F++){let H=T[F];if(H>F){let J=F*2,G=H*2,Q=_[J];_[J]=_[G],_[G]=Q,Q=_[J+1],_[J+1]=_[G+1],_[G+1]=Q}}else{let F=new Float64Array(A*2);for(let H=0;H<A;H++){let J=(D+H*P)*2,G=T[H]*2;F[G]=_[J],F[G+1]=_[J+1]}for(let H=0;H<A;H++){let J=(D+H*P)*2;_[J]=F[H*2],_[J+1]=F[H*2+1]}}for(let F=1;F<=U;F++){let H=1<<F,J=H>>1,G=g1(J,E);for(let Q=0;Q<A;Q+=H)for(let Y=0;Y<J;Y++){let q=(D+(Q+Y)*P)*2,R=(D+(Q+Y+J)*P)*2,j=G[Y*2],I=G[Y*2+1],K=_[R],Z=_[R+1],c=j*K-I*Z,w=j*Z+I*K,y=_[q],C=_[q+1];_[q]=y+c,_[q+1]=C+w,_[R]=y-c,_[R+1]=C-w}}if(E){let F=1/A;for(let H=0;H<A;H++){let J=(D+H*P)*2;_[J]*=F,_[J+1]*=F}}}function P1(_,A,E){let D=new Float64Array(A*2);for(let U=0;U<A;U++){let T=U*A*2;D.set(_.subarray(T,T+A*2)),W1(D,A,E),_.set(D,T)}let P=new Float64Array(A*2);for(let U=0;U<A;U++){for(let T=0;T<A;T++)P[T*2]=_[(T*A+U)*2],P[T*2+1]=_[(T*A+U)*2+1];W1(P,A,E);for(let T=0;T<A;T++)_[(T*A+U)*2]=P[T*2],_[(T*A+U)*2+1]=P[T*2+1]}}function F1(_,A){let E=A>>1;for(let D=0;D<E;D++)for(let P=0;P<A;P++){let U=D+E,T=(P+E)%A,F=(D*A+P)*2,H=(U*A+T)*2,J=_[F];_[F]=_[H],_[H]=J,J=_[F+1],_[F+1]=_[H+1],_[H+1]=J}}function R1(_,A,E){let{wavelength:D,na:P,sigma:U,defocus:T}=E,F=19.53125,H=1/(A*19.53125),G=P*(1+U)/D,Q=G*G,Y=T*1000,q=Math.PI*D*Y,R=A>>1;for(let j=0;j<A;j++){let I=(j-R)*H,K=I*I;for(let Z=0;Z<A;Z++){let c=(Z-R)*H,w=c*c+K,y=(j*A+Z)*2;if(w>Q)_[y]=0,_[y+1]=0;else if(Y!==0){let C=q*w,h=Math.cos(C),b=Math.sin(C),x=_[y],B=_[y+1];_[y]=x*h-B*b,_[y+1]=x*b+B*h}}}}var l=256,r=l*l,s=null;function z1(){if(!s||s.length!==r*2)s=new Float64Array(r*2);return s}function M1(_,A){let E=performance.now(),D=z1();for(let F=0;F<r;F++)D[F*2]=_[F],D[F*2+1]=0;P1(D,l,!1),F1(D,l),R1(D,l,A),F1(D,l),P1(D,l,!0);let P=new Float32Array(r),U=0;for(let F=0;F<r;F++){let H=D[F*2],J=D[F*2+1],G=H*H+J*J;if(P[F]=G,G>U)U=G}if(U>0){let F=1/U;for(let H=0;H<r;H++)P[H]*=F}let T=performance.now()-E;return{intensity:P,timeMs:T}}function w1(){let _=document.getElementById("app"),{maskPanel:A,heatmapCanvas:E,resistCanvas:D,crossSectionCanvas:P,crossSectionLine:U,heatmapWrap:T,paramsPanel:F,timingReadout:H,zoomSlider:J,zoomInBtn:G,zoomOutBtn:Q,zoomLabel:Y,heatmapContainer:q,downloadBtn:R}=U1(_),j=$1(A),I=document.createElement("div");F.insertBefore(I,F.firstChild),K1(I,($)=>{E.style.width=$+"px",E.style.height=$+"px",D.style.width=$+"px",D.style.height=$+"px"});let K=document.createElement("div");K.style.padding="10px 0",F.insertBefore(K,H),X1(K);let Z=document.createElement("div");Z.style.padding="10px 0",Z.style.borderTop="1px solid var(--border)",F.insertBefore(Z,H);let c=q1(Z),w=new A1(E),y=new _1(D),C=new E1(P,540,140),h=document.getElementById("timing-sim"),b=document.getElementById("timing-render");J1(($)=>{let X=M1($.mask,$.params);h.textContent=X.timeMs.toFixed(1);let N=performance.now();w.draw(X.intensity),y.draw(X.intensity,$.viewParams.threshold),C.draw(X.intensity,$.viewParams.crossSectionRow,$.viewParams.threshold);let p=performance.now()-N;b.textContent=p.toFixed(1);let g=$.viewParams.crossSectionRow/255;U.style.top=g*100+"%"});let x=0;function B($){if(x===0)x=E.offsetWidth;if($===1)E.style.width="",E.style.height="",E.style.maxWidth="",E.style.maxHeight="",E.style.minWidth="",E.style.minHeight="",D.style.width="",D.style.height="",D.style.maxWidth="",D.style.maxHeight="",D.style.minWidth="",D.style.minHeight="";else{let X=x*$;E.style.width=`${X}px`,E.style.height=`${X}px`,E.style.maxWidth="none",E.style.maxHeight="none",E.style.minWidth=`${X}px`,E.style.minHeight=`${X}px`,D.style.width=`${X}px`,D.style.height=`${X}px`,D.style.maxWidth="none",D.style.maxHeight="none",D.style.minWidth=`${X}px`,D.style.minHeight=`${X}px`}Y.textContent=`${Math.round($*100)}%`,J.value=String($)}J.addEventListener("input",()=>{B(parseFloat(J.value))}),Q.addEventListener("click",()=>{let $=Math.max(0.5,parseFloat(J.value)-0.1);B(Math.round($*10)/10)}),G.addEventListener("click",()=>{let $=Math.min(4,parseFloat(J.value)+0.1);B(Math.round($*10)/10)}),R.addEventListener("click",()=>{let $=document.createElement("a"),X=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);$.download=`lithography-simulation-${X}.png`,$.href=E.toDataURL("image/png"),$.click()});let S=A.querySelector(".preset-btn");if(S)S.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",w1);else w1();
