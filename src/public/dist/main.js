function j1(_){_.innerHTML="";let D=document.createElement("div");D.className="header";let F=document.createElement("h1");F.textContent="Lithography Simulator";let A=document.createElement("span");A.className="subtitle",A.textContent="Fourier Optics / Aerial Image";let J=document.createElement("button");J.className="download-btn",J.textContent="Export PNG",D.append(F,A,J);let U=document.createElement("div");U.className="panel",U.dataset.panel="mask";let T=document.createElement("div");T.className="panel panel-heatmap",T.dataset.panel="view";let Q=document.createElement("div");Q.className="heatmap-container";let $=document.createElement("div");$.className="viz-toggle-bar";let q=[{key:"aerial",label:"Aerial"},{key:"resist",label:"Resist"},{key:"split",label:"Split"}],G=[];for(let y of q){let g=document.createElement("button");g.className="viz-toggle-btn",g.textContent=y.label,g.dataset.mode=y.key,G.push(g),$.appendChild(g)}let K=document.createElement("div");K.className="viz-toggle-sep",$.appendChild(K);let P=document.createElement("button");P.className="viz-toggle-btn",P.textContent="Cross-Section",P.dataset.mode="cs",$.appendChild(P);let H=document.createElement("div");H.className="viz-toggle-sep",$.appendChild(H);let L=document.createElement("button");L.className="viz-toggle-btn",L.textContent="Bossung",L.dataset.mode="bossung",$.appendChild(L);let X=document.createElement("div");X.className="viz-grid",X.appendChild($);let W=document.createElement("div");W.className="viz-image-row";let j=document.createElement("div");j.className="viz-image-wrap";let w=document.createElement("div");w.className="viz-label",w.textContent="Aerial Image";let k=document.createElement("canvas"),M=document.createElement("div");M.className="cross-section-line",j.append(w,k,M);let O=document.createElement("div");O.className="viz-image-wrap";let V=document.createElement("div");V.className="viz-label",V.textContent="Resist Image";let S=document.createElement("canvas");O.append(V,S),W.append(j,O);let R=document.createElement("div");R.className="cross-section-wrap";let b=document.createElement("canvas");b.className="cross-section-canvas",R.appendChild(b);let B=document.createElement("div");B.className="bossung-chart-container",B.style.display="none";let x=document.createElement("canvas");B.appendChild(x);let f=document.createElement("div");f.className="zoom-bar";let z=document.createElement("button");z.className="zoom-btn",z.textContent="−";let c=document.createElement("input");c.type="range",c.className="zoom-slider",c.min="0.5",c.max="4",c.step="0.1",c.value="1";let u=document.createElement("button");u.className="zoom-btn",u.textContent="+";let p=document.createElement("span");p.className="zoom-label",p.textContent="100%",f.append(z,c,u,p),X.append(W,R,B),Q.append(X,f),T.appendChild(Q);let Y="aerial",E=!1;function C(){let y=Y==="bossung";for(let g of G)g.classList.toggle("active",g.dataset.mode===Y);if(P.classList.toggle("active",E&&!y),P.classList.toggle("disabled",y),L.classList.toggle("active",y),W.style.display=y?"none":"",B.style.display=y?"flex":"none",R.style.display=!y&&E?"":"none",M.style.display=!y&&E?"":"none",f.style.display=y?"none":"",!y)j.style.display=Y==="resist"?"none":"",O.style.display=Y==="aerial"?"none":""}let Z=null;function I(y){if(Y=y,C(),Z)Z(y)}function v(){return E=!E,C(),E}for(let y of G)y.addEventListener("click",()=>{I(y.dataset.mode)});P.addEventListener("click",()=>{v()}),L.addEventListener("click",()=>{I("bossung")}),C();let h=document.createElement("div");h.className="panel panel-params",h.dataset.panel="params";let d=document.createElement("div");d.className="panel-title",d.textContent="Parameters",h.appendChild(d);let A1=document.createElement("div");A1.className="timing-readout",A1.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,h.appendChild(A1);let _1=document.createElement("div");_1.className="mobile-tab-bar";let l1=[{key:"mask",label:"Mask"},{key:"view",label:"View"},{key:"params",label:"Params"}],T1=[];for(let y of l1){let g=document.createElement("button");g.className="mobile-tab-btn",g.textContent=y.label,g.dataset.tab=y.key,g.addEventListener("click",()=>{_.dataset.activeTab=y.key;for(let X1 of T1)X1.classList.toggle("active",X1.dataset.tab===y.key)}),T1.push(g),_1.appendChild(g)}return _.dataset.activeTab="view",T1[1].classList.add("active"),_.append(D,U,T,h,_1),{maskPanel:U,heatmapCanvas:k,resistCanvas:S,crossSectionCanvas:b,crossSectionLine:M,heatmapWrap:j,resistWrap:O,crossSectionWrap:R,paramsPanel:h,timingReadout:A1,zoomSlider:c,zoomInBtn:u,zoomOutBtn:z,zoomLabel:p,heatmapContainer:Q,mobileTabBar:_1,downloadBtn:J,setVizMode:I,get onVizModeChange(){return Z},set onVizModeChange(y){Z=y},toggleCrossSection:v,bossungCanvas:x,bossungChartContainer:B}}var r={z4:0,z5:0,z6:0,z7:0,z8:0,z9:0,z10:0,z11:0};function o1(_){return 1.7320508075688772*(2*_*_-1)}function i1(_,D){return 2.449489742783178*_*_*Math.sin(2*D)}function r1(_,D){return 2.449489742783178*_*_*Math.cos(2*D)}function n1(_,D){return 2.8284271247461903*(3*_*_*_-2*_)*Math.sin(D)}function s1(_,D){return 2.8284271247461903*(3*_*_*_-2*_)*Math.cos(D)}function t1(_){let D=_*_;return 2.23606797749979*(6*D*D-6*D+1)}function e1(_,D){return 2.8284271247461903*_*_*_*Math.sin(3*D)}function a1(_,D){return 2.8284271247461903*_*_*_*Math.cos(3*D)}function O1(_,D,F){let A=0;if(F.z4!==0)A+=F.z4*o1(_);if(F.z5!==0)A+=F.z5*i1(_,D);if(F.z6!==0)A+=F.z6*r1(_,D);if(F.z7!==0)A+=F.z7*n1(_,D);if(F.z8!==0)A+=F.z8*s1(_,D);if(F.z9!==0)A+=F.z9*t1(_);if(F.z10!==0)A+=F.z10*e1(_,D);if(F.z11!==0)A+=F.z11*a1(_,D);return A}var E1=256,L1={threshold:0.3,crossSectionRow:128},V1=[],U1=!1,F1={wavelength:248,na:0.75,sigma:0.5,defocus:0,zernike:{...r}},l={mask:new Float32Array(E1*E1),params:{...F1,zernike:{...r}},viewParams:{...L1}};function e(){if(U1)return;U1=!0,requestAnimationFrame(()=>{U1=!1;for(let _ of V1)_(l)})}function m(){return l}function W1(_){V1.push(_)}function a(_){l.mask=_,e()}function I1(_,D){l.params[_]=D,e()}function w1(_,D){l.params.zernike[_]=D,e()}function M1(_,D){l.viewParams[_]=D,e()}function R1(){Object.assign(l.params,F1),l.params.zernike={...r},Object.assign(l.viewParams,L1),e()}function D1(){return new Float32Array(65536)}function D2(){let _=D1(),D=10,F=5;for(let A=0;A<256;A++)for(let J=0;J<256;J++)if(J%10<5)_[A*256+J]=1;return _}function A2(){let _=D1(),D=20,F=6,A=Math.floor(7);for(let J=0;J<256;J++)for(let U=0;U<256;U++){let T=J%20,Q=U%20;if(T>=A&&T<A+6&&Q>=A&&Q<A+6)_[J*256+U]=1}return _}function _2(){let _=D1(),D=6,F=125,A=131;for(let J=0;J<256;J++)for(let U=125;U<131;U++)_[J*256+U]=1;return _}function F2(){let _=D1(),D=5,F=2;for(let A=0;A<256;A++)for(let J=0;J<256;J++)if(J%5<2)_[A*256+J]=1;return _}function J2(){let _=D1(),D=128,F=128,A=60,J=10;for(let U=0;U<256;U++)for(let T=0;T<256;T++){let Q=U-128,$=T-128,q=$>=0&&$<60&&Q>=-5&&Q<5,G=Q>=0&&Q<60&&$>=-5&&$<5;if(q||G)_[U*256+T]=1}return _}var k1=[{name:"line_space",label:"Line/Space (10px)",generate:D2},{name:"contacts",label:"Contact Holes",generate:A2},{name:"isolated_line",label:"Isolated Line",generate:_2},{name:"dense_lines",label:"Dense Lines (5px)",generate:F2},{name:"l_shape",label:"L-Shape Corner",generate:J2}];var N=256;function Q2(_,D){let F=D/2,A=[],J=Math.floor(D/2);switch(_){case"square":for(let U=-J;U<=J;U++)for(let T=-J;T<=J;T++)A.push([T,U]);break;case"circle":for(let U=-J;U<=J;U++)for(let T=-J;T<=J;T++)if(T*T+U*U<=F*F)A.push([T,U]);break;case"ring":{let U=F*0.6;for(let T=-J;T<=J;T++)for(let Q=-J;Q<=J;Q++){let $=Q*Q+T*T;if($<=F*F&&$>=U*U)A.push([Q,T])}break}case"cross":{let U=Math.max(1,Math.floor(D/6));for(let T=-J;T<=J;T++)for(let Q=-J;Q<=J;Q++)if(Math.abs(Q)<=U||Math.abs(T)<=U)A.push([Q,T]);break}case"lineH":{let U=Math.max(1,Math.floor(D/6));for(let T=-U;T<=U;T++)for(let Q=-J;Q<=J;Q++)A.push([Q,T]);break}case"lineV":{let U=Math.max(1,Math.floor(D/6));for(let T=-J;T<=J;T++)for(let Q=-U;Q<=U;Q++)A.push([Q,T]);break}}return A}var $2=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function y1(_){let D=document.createElement("div");D.className="panel-title",D.textContent="Mask Editor",_.appendChild(D);let F=document.createElement("div");F.className="panel-mask",_.appendChild(F);let A=document.createElement("div");A.className="mask-canvas-wrap";let J=document.createElement("canvas");J.width=N,J.height=N,A.appendChild(J),F.appendChild(A);let U=J.getContext("2d"),T="brush",Q="square",$=20,q=!1,G=1;function K(){let Y=m().mask,E=U.createImageData(N,N),C=E.data;for(let Z=0;Z<N*N;Z++){let I=Y[Z]>0?255:0;C[Z*4]=I,C[Z*4+1]=I,C[Z*4+2]=I,C[Z*4+3]=255}U.putImageData(E,0,0)}function P(Y){let E=J.getBoundingClientRect(),C=N/E.width,Z=N/E.height,I=Math.floor((Y.clientX-E.left)*C),v=Math.floor((Y.clientY-E.top)*Z);return[Math.max(0,Math.min(N-1,I)),Math.max(0,Math.min(N-1,v))]}function H(Y,E,C){for(let Z=-1;Z<=1;Z++)for(let I=-1;I<=1;I++){let v=Y+I,h=E+Z;if(v>=0&&v<N&&h>=0&&h<N)C[h*N+v]=G}}function L(Y,E,C){let Z=Q2(Q,$);for(let[I,v]of Z){let h=Y+I,d=E+v;if(h>=0&&h<N&&d>=0&&d<N)C[d*N+h]=G}}function X(Y){let[E,C]=P(Y),Z=m().mask;if(T==="stamp")L(E,C,Z);else H(E,C,Z);K(),a(Z)}J.style.touchAction="none",J.addEventListener("pointerdown",(Y)=>{q=!0,G=Y.button===2?0:1,J.setPointerCapture(Y.pointerId),X(Y)}),J.addEventListener("pointermove",(Y)=>{if(q)X(Y)}),J.addEventListener("pointerup",(Y)=>{q=!1,J.releasePointerCapture(Y.pointerId)}),J.addEventListener("pointerleave",()=>{q=!1}),J.addEventListener("contextmenu",(Y)=>Y.preventDefault());let W=document.createElement("div");W.className="tool-toggle";let j=document.createElement("button");j.textContent="BRUSH",j.classList.add("active");let w=document.createElement("button");w.textContent="STAMP";function k(Y){T=Y,j.classList.toggle("active",Y==="brush"),w.classList.toggle("active",Y==="stamp"),M.style.display=Y==="stamp"?"":"none"}j.addEventListener("click",()=>k("brush")),w.addEventListener("click",()=>k("stamp")),W.append(j,w),F.appendChild(W);let M=document.createElement("div");M.className="stamp-options",M.style.display="none";let O=document.createElement("div");O.className="stamp-shape-row";let V=[];for(let Y of $2){let E=document.createElement("button");if(E.className="stamp-btn",E.textContent=Y.label,Y.key===Q)E.classList.add("active");E.addEventListener("click",()=>{Q=Y.key,V.forEach((C)=>C.classList.remove("active")),E.classList.add("active")}),V.push(E),O.appendChild(E)}M.appendChild(O);let S=document.createElement("div");S.className="param-group";let R=document.createElement("div");R.className="param-label";let b=document.createElement("span");b.className="param-name",b.textContent="Stamp Size";let B=document.createElement("span");B.className="param-value",B.textContent=String($),R.append(b,B);let x=document.createElement("input");x.type="range",x.min="4",x.max="60",x.value=String($),x.addEventListener("input",()=>{$=Number(x.value),B.textContent=String($)}),S.append(R,x),M.appendChild(S),F.appendChild(M);let f=document.createElement("div");f.className="preset-buttons";let z=null;for(let Y of k1){let E=document.createElement("button");E.className="preset-btn",E.textContent=Y.label,E.addEventListener("click",()=>{let C=Y.generate();if(a(C),K(),z)z.classList.remove("active");E.classList.add("active"),z=E}),f.appendChild(E)}F.appendChild(f);let c=document.createElement("div");c.className="mask-tools";let u=document.createElement("button");u.textContent="CLEAR",u.addEventListener("click",()=>{if(a(new Float32Array(N*N)),K(),z)z.classList.remove("active");z=null});let p=document.createElement("button");return p.textContent="INVERT",p.addEventListener("click",()=>{let Y=m().mask;for(let E=0;E<N*N;E++)Y[E]=Y[E]>0?0:1;a(Y),K()}),c.append(u,p),F.appendChild(c),K(),{setDisplaySize(Y){J.style.width=Y+"px",J.style.height=Y+"px"}}}var q1=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function T2(_){if(!Number.isFinite(_))return 128;return Math.round(Math.max(128,Math.min(768,_)))}function C1(_,D){let F=document.createElement("div");F.className="canvas-size-controls";let A=document.createElement("div");A.className="param-group",A.dataset.tooltip="The display size of the simulation on screen. Doesn’t change the physics — just how big the image looks.";let J=document.createElement("div");J.className="param-label";let U=document.createElement("span");U.className="param-name",U.textContent="Canvas Size";let T=document.createElement("span");T.className="param-value";let Q=document.createElement("span");Q.className="param-unit",Q.textContent="px";let $=document.createElement("span");$.append(T,Q),J.append(U,$);let q=document.createElement("input");q.type="range",q.min=String(128),q.max=String(768),q.step="1",q.value=String(384),A.append(J,q),F.appendChild(A);let G=document.createElement("div");G.className="size-preset-row";let K=[];for(let W of q1){let j=document.createElement("button");j.className="stamp-btn",j.textContent=W.label,j.addEventListener("click",()=>X(W.size)),K.push(j),G.appendChild(j)}F.appendChild(G);let P=document.createElement("div");P.className="size-input-row";let H=document.createElement("input");H.type="number",H.className="size-text-input",H.min=String(128),H.max=String(768),H.value=String(384);let L=document.createElement("span");L.className="param-unit",L.textContent="px",H.addEventListener("change",()=>{X(Number(H.value))}),P.append(H,L),F.appendChild(P),_.appendChild(F);function X(W){let j=T2(W);q.value=String(j),T.textContent=String(j),H.value=String(j);for(let w=0;w<q1.length;w++)K[w].classList.toggle("active",q1[w].size===j);D(j)}q.addEventListener("input",()=>{X(Number(q.value))}),X(384)}var U2=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0,tooltip:"The color of light used to print the pattern. Shorter wavelengths can print finer details — like using a sharper pencil."},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2,tooltip:"How wide the lens opening is. A bigger opening captures more detail, like opening your eyes wider to see fine print."},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2,tooltip:"How spread out the light source is. Low values give a tight beam like a laser pointer; high values spread light like a floodlight."},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2,tooltip:"How far from perfect focus. Like adjusting binoculars — at zero the image is sharpest."}],q2=[{key:"z4",label:"Defocus",noll:4,tooltip:"Extra focus shift from lens imperfections — like wearing slightly wrong prescription glasses."},{key:"z5",label:"Oblq Astig",noll:5,tooltip:"The lens focuses diagonal lines at different depths — like a funhouse mirror that stretches things on a tilt."},{key:"z6",label:"Vert Astig",noll:6,tooltip:"The lens focuses horizontal and vertical lines at different depths — like looking through a slightly bent lens."},{key:"z7",label:"Vert Coma",noll:7,tooltip:"Features smear to one side vertically — like looking through a raindrop on a window."},{key:"z8",label:"Horz Coma",noll:8,tooltip:"Same smearing effect but sideways — features get a comet-like tail in the horizontal direction."},{key:"z9",label:"Spherical",noll:9,tooltip:"Center and edges of the lens focus differently — like the blur you see at the edge of a magnifying glass."},{key:"z10",label:"Oblq Trefoil",noll:10,tooltip:"A three-pointed star-shaped distortion on a tilt — a subtle clover-leaf blur at an angle."},{key:"z11",label:"Vert Trefoil",noll:11,tooltip:"A three-pointed distortion aligned vertically — features pick up a subtle triangular blur."}];function B1(_){let D=[];for(let $ of U2){let q=document.createElement("div");q.className="param-group",q.dataset.tooltip=$.tooltip;let G=document.createElement("div");G.className="param-label";let K=document.createElement("span");K.className="param-name",K.textContent=$.label;let P=document.createElement("span"),H=document.createElement("span");H.className="param-value";let L=document.createElement("span");L.className="param-unit",L.textContent=$.unit,P.append(H,L),G.append(K,P);let X=document.createElement("input");X.type="range",X.min=String($.min),X.max=String($.max),X.step=String($.step),X.value=String(m().params[$.key]);let W=(j)=>{H.textContent=j.toFixed($.decimals)};W(m().params[$.key]),X.addEventListener("input",()=>{let j=parseFloat(X.value);W(j),I1($.key,j)}),q.append(G,X),_.appendChild(q),D.push({def:$,input:X,updateDisplay:W})}let F=document.createElement("div");F.className="aberration-section";let A=document.createElement("button");A.className="aberration-toggle",A.innerHTML='<span class="aberration-arrow">▶</span> Aberrations (Zernike)';let J=!1,U=document.createElement("div");U.className="aberration-body",U.style.display="none";let T=[];for(let $ of q2){let q=document.createElement("div");q.className="param-group zernike-group",q.dataset.tooltip=$.tooltip;let G=document.createElement("div");G.className="param-label";let K=document.createElement("span");K.className="param-name",K.textContent=`Z${$.noll} ${$.label}`;let P=document.createElement("span"),H=document.createElement("span");H.className="param-value";let L=document.createElement("span");L.className="param-unit",L.textContent="λ",P.append(H,L),G.append(K,P);let X=document.createElement("input");X.type="range",X.min="-1",X.max="1",X.step="0.01",X.value=String(m().params.zernike[$.key]);let W=(j)=>{H.textContent=j.toFixed(2)};W(m().params.zernike[$.key]),X.addEventListener("input",()=>{let j=parseFloat(X.value);W(j),w1($.key,j)}),q.append(G,X),U.appendChild(q),T.push({def:$,input:X,updateDisplay:W})}A.addEventListener("click",()=>{J=!J,U.style.display=J?"block":"none";let $=A.querySelector(".aberration-arrow");$.textContent=J?"▼":"▶"}),F.append(A,U),_.appendChild(F);let Q=document.createElement("button");Q.className="reset-params-btn",Q.textContent="Reset Defaults",Q.addEventListener("click",()=>{R1();for(let{def:$,input:q,updateDisplay:G}of D){let K=F1[$.key];q.value=String(K),G(K)}for(let{def:$,input:q,updateDisplay:G}of T){let K=r[$.key];q.value=String(K),G(K)}}),_.appendChild(Q)}var G2=[{key:"threshold",label:"Resist Threshold",unit:"",min:0,max:1,step:0.01,decimals:2,tooltip:"The cutoff that decides what prints and what doesn’t — like a pass/fail grade for light intensity."},{key:"crossSectionRow",label:"Cross-Section Row",unit:"px",min:0,max:255,step:1,decimals:0,tooltip:"Which horizontal slice to show in the graph below — like choosing where to cut through a cake to see inside."}];function x1(_){let D=[],F=document.createElement("div");F.className="panel-title",F.style.padding="8px 0 4px",F.style.border="none",F.textContent="Resist / Cross-Section",_.appendChild(F);for(let A of G2){let J=document.createElement("div");J.className="param-group",J.dataset.tooltip=A.tooltip;let U=document.createElement("div");U.className="param-label";let T=document.createElement("span");T.className="param-name",T.textContent=A.label;let Q=document.createElement("span"),$=document.createElement("span");$.className="param-value";let q=document.createElement("span");q.className="param-unit",q.textContent=A.unit,Q.append($,q),U.append(T,Q);let G=document.createElement("input");G.type="range",G.min=String(A.min),G.max=String(A.max),G.step=String(A.step),G.value=String(m().viewParams[A.key]);let K=(P)=>{$.textContent=P.toFixed(A.decimals)};K(m().viewParams[A.key]),G.addEventListener("input",()=>{let P=parseFloat(G.value);K(P),M1(A.key,P)}),J.append(U,G),_.appendChild(J),D.push({def:A,input:G,updateDisplay:K})}return{syncFromState(){for(let{def:A,input:J,updateDisplay:U}of D){let T=m().viewParams[A.key];J.value=String(T),U(T)}}}}var N1=[{key:"focusSteps",label:"Focus Steps",unit:"",min:5,max:21,step:2,decimals:0,defaultValue:11,tooltip:"How many focus positions to test. More steps gives finer detail but takes longer to compute."},{key:"doseMin",label:"Dose Min",unit:"",min:0.5,max:1.5,step:0.05,decimals:2,defaultValue:0.7,tooltip:"The lowest light exposure to test — like the dimmest brightness level in the sweep."},{key:"doseMax",label:"Dose Max",unit:"",min:0.5,max:1.5,step:0.05,decimals:2,defaultValue:1.3,tooltip:"The highest light exposure to test — like the brightest brightness level in the sweep."},{key:"doseSteps",label:"Dose Steps",unit:"",min:3,max:9,step:1,decimals:0,defaultValue:7,tooltip:"How many exposure levels to test between min and max. More steps gives smoother results."}];function b1(_,D){let F=document.createElement("div");F.className="bossung-section";let A=document.createElement("div");A.className="panel-title",A.style.padding="0 0 8px",A.style.border="none",A.textContent="Process Window",F.appendChild(A);let J=document.createElement("div");J.className="param-label",J.dataset.tooltip="The range of focus positions tested — simulates how the print looks as focus drifts up and down.",J.style.marginBottom="8px";let U=document.createElement("span");U.className="param-name",U.textContent="Focus Range";let T=document.createElement("span");T.innerHTML='<span class="param-value">-2.0</span> to <span class="param-value">+2.0</span> <span class="param-unit">μm</span>',J.append(U,T),F.appendChild(J);let Q={};for(let P of N1)Q[P.key]=P.defaultValue;for(let P of N1){let H=document.createElement("div");H.className="param-group",H.dataset.tooltip=P.tooltip;let L=document.createElement("div");L.className="param-label";let X=document.createElement("span");X.className="param-name",X.textContent=P.label;let W=document.createElement("span"),j=document.createElement("span");j.className="param-value",j.textContent=P.defaultValue.toFixed(P.decimals);let w=document.createElement("span");w.className="param-unit",w.textContent=P.unit,W.append(j,w),L.append(X,W);let k=document.createElement("input");k.type="range",k.min=String(P.min),k.max=String(P.max),k.step=String(P.step),k.value=String(P.defaultValue),k.addEventListener("input",()=>{let M=parseFloat(k.value);Q[P.key]=M,j.textContent=M.toFixed(P.decimals)}),H.append(L,k),F.appendChild(H)}let $=document.createElement("button");$.className="bossung-run-btn",$.textContent="Run Bossung Analysis",$.addEventListener("click",()=>{let P={focusRange:[-2,2],focusSteps:Q.focusSteps,doseRange:[Q.doseMin,Q.doseMax],doseSteps:Q.doseSteps};D(P)}),F.appendChild($);let q=document.createElement("div");q.className="bossung-timing",q.innerHTML='Sweep: <span class="value">--</span> ms (<span class="value bossung-runs">--</span> runs)',F.appendChild(q),_.appendChild(F);let G=q.querySelector(".value"),K=q.querySelector(".bossung-runs");return{setTiming(P,H){G.textContent=P.toFixed(1),K.textContent=String(H)},setRunning(P){$.disabled=P,$.textContent=P?"Running…":"Run Bossung Analysis"},run(){$.click()}}}var S1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,z1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var K2=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function v1(){let _=new Uint8Array(1024);for(let D=0;D<256;D++){let F=K2[D];_[D*4+0]=F[0],_[D*4+1]=F[1],_[D*4+2]=F[2],_[D*4+3]=255}return _}var o=256;class G1{gl;program;intensityTex;colormapTex;vao;constructor(_){_.width=o,_.height=o;let D=_.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0});if(!D)throw Error("WebGL2 not supported");this.gl=D;let F=D.getExtension("EXT_color_buffer_float");this.program=this.createProgram(S1,z1),this.vao=D.createVertexArray(),this.intensityTex=D.createTexture(),D.bindTexture(D.TEXTURE_2D,this.intensityTex),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texImage2D(D.TEXTURE_2D,0,D.R32F,o,o,0,D.RED,D.FLOAT,null),this.colormapTex=D.createTexture(),D.bindTexture(D.TEXTURE_2D,this.colormapTex),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE);let A=v1();D.texImage2D(D.TEXTURE_2D,0,D.RGBA,256,1,0,D.RGBA,D.UNSIGNED_BYTE,A),D.useProgram(this.program),D.uniform1i(D.getUniformLocation(this.program,"uIntensity"),0),D.uniform1i(D.getUniformLocation(this.program,"uColormap"),1)}draw(_){let D=this.gl;D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,this.intensityTex),D.texSubImage2D(D.TEXTURE_2D,0,0,0,o,o,D.RED,D.FLOAT,_),D.activeTexture(D.TEXTURE1),D.bindTexture(D.TEXTURE_2D,this.colormapTex),D.useProgram(this.program),D.bindVertexArray(this.vao),D.viewport(0,0,o,o),D.drawArrays(D.TRIANGLES,0,3)}resize(_,D){}createProgram(_,D){let F=this.gl,A=this.compileShader(F.VERTEX_SHADER,_),J=this.compileShader(F.FRAGMENT_SHADER,D),U=F.createProgram();if(F.attachShader(U,A),F.attachShader(U,J),F.linkProgram(U),!F.getProgramParameter(U,F.LINK_STATUS)){let T=F.getProgramInfoLog(U);throw F.deleteProgram(U),Error("Shader link error: "+T)}return F.deleteShader(A),F.deleteShader(J),U}compileShader(_,D){let F=this.gl,A=F.createShader(_);if(F.shaderSource(A,D),F.compileShader(A),!F.getShaderParameter(A,F.COMPILE_STATUS)){let J=F.getShaderInfoLog(A);throw F.deleteShader(A),Error("Shader compile error: "+J)}return A}}class K1{ctx;imageData;constructor(_){_.width=256,_.height=256,this.ctx=_.getContext("2d"),this.imageData=this.ctx.createImageData(256,256)}draw(_,D){let F=this.imageData.data;for(let A=0;A<65536;A++){let J=A*4;if(_[A]>=D)F[J]=88,F[J+1]=166,F[J+2]=255;else F[J]=13,F[J+1]=17,F[J+2]=23;F[J+3]=255}this.ctx.putImageData(this.imageData,0,0)}}class P1{ctx;w;h;constructor(_,D,F){this.w=D,this.h=F;let A=window.devicePixelRatio||1;_.width=D*A,_.height=F*A,_.style.width=D+"px",_.style.height=F+"px",this.ctx=_.getContext("2d"),this.ctx.scale(A,A)}draw(_,D,F){let A=this.ctx,J=this.w,U=this.h,T=J-40-12,Q=U-12-28;A.fillStyle="#0d1117",A.fillRect(0,0,J,U),A.strokeStyle="#30363d",A.lineWidth=1,A.beginPath(),A.moveTo(40,12),A.lineTo(40,12+Q),A.lineTo(40+T,12+Q),A.stroke(),A.fillStyle="#8b949e",A.font="9px monospace",A.textAlign="right",A.textBaseline="middle";for(let G of[0,0.5,1]){let K=12+Q*(1-G);A.fillText(G.toFixed(1),36,K),A.strokeStyle="#21262d",A.lineWidth=0.5,A.beginPath(),A.moveTo(40,K),A.lineTo(40+T,K),A.stroke()}A.fillStyle="#8b949e",A.textAlign="center",A.textBaseline="top";for(let G of[0,128,255]){let K=40+G/255*T;A.fillText(String(G),K,12+Q+4)}A.fillStyle="#8b949e",A.textAlign="right",A.textBaseline="top",A.fillText("Row "+D,40+T,12+Q+4);let $=12+Q*(1-F);A.strokeStyle="#f85149",A.lineWidth=1,A.setLineDash([4,3]),A.beginPath(),A.moveTo(40,$),A.lineTo(40+T,$),A.stroke(),A.setLineDash([]),A.fillStyle="#f85149",A.font="9px monospace",A.textAlign="left",A.textBaseline="bottom",A.fillText("T="+F.toFixed(2),43,$-2);let q=D*256;A.strokeStyle="#58a6ff",A.lineWidth=1.5,A.beginPath();for(let G=0;G<256;G++){let K=40+G/255*T,P=Math.max(0,Math.min(1,_[q+G])),H=12+Q*(1-P);if(G===0)A.moveTo(K,H);else A.lineTo(K,H)}A.stroke()}}var J1=["#58a6ff","#3fb950","#f0883e","#bc8cff","#f778ba","#ffd33d","#a5d6ff","#ff7b72","#7ee787"];var n={top:40,right:130,bottom:55,left:70};class H1{canvas;ctx;constructor(_){this.canvas=_,this.ctx=_.getContext("2d")}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}draw(_){let D=this.canvas,F=this.ctx,A=window.devicePixelRatio||1,J=D.getBoundingClientRect(),U=J.width,T=J.height;D.width=U*A,D.height=T*A,F.setTransform(A,0,0,A,0,0);let{left:Q,top:$}=n,q=U-n.left-n.right,G=T-n.top-n.bottom;if(q<40||G<40)return;let K=_.focusValues[0],P=_.focusValues[_.focusValues.length-1],H=1/0,L=-1/0;for(let O of _.curves)for(let V of O.points){if(V.cd<H)H=V.cd;if(V.cd>L)L=V.cd}if(!isFinite(H)||!isFinite(L)||H===L)H=0,L=200;else{let O=(L-H)*0.1||20;H=Math.max(0,H-O),L=L+O}let X=(O)=>Q+(O-K)/(P-K)*q,W=(O)=>$+G-(O-H)/(L-H)*G;F.fillStyle="#161b22",F.fillRect(0,0,U,T),F.font='10px "SF Mono", "Cascadia Code", "Fira Code", monospace',F.textAlign="center",F.textBaseline="top";let j=h1(K,P,8),w=h1(H,L,6);F.strokeStyle="rgba(48, 54, 61, 0.6)",F.lineWidth=1,F.setLineDash([4,4]);for(let O of j){let V=X(O);F.beginPath(),F.moveTo(V,$),F.lineTo(V,$+G),F.stroke(),F.fillStyle="#8b949e",F.fillText(O.toFixed(1),V,$+G+8)}F.textAlign="right",F.textBaseline="middle";for(let O of w){let V=W(O);F.beginPath(),F.moveTo(Q,V),F.lineTo(Q+q,V),F.stroke(),F.fillStyle="#8b949e",F.fillText(O.toFixed(0),Q-8,V)}F.setLineDash([]),F.strokeStyle="rgba(48, 54, 61, 0.6)",F.lineWidth=1,F.strokeRect(Q,$,q,G);for(let O=0;O<_.curves.length;O++){let V=_.curves[O],S=J1[O%J1.length];F.strokeStyle=S,F.lineWidth=2,F.lineJoin="round",F.lineCap="round",F.beginPath();for(let R=0;R<V.points.length;R++){let b=V.points[R],B=X(b.focus),x=W(b.cd);if(R===0)F.moveTo(B,x);else F.lineTo(B,x)}F.stroke(),F.fillStyle=S;for(let R of V.points)F.beginPath(),F.arc(X(R.focus),W(R.cd),3,0,Math.PI*2),F.fill()}F.fillStyle="#8b949e",F.font='11px "SF Mono", "Cascadia Code", "Fira Code", monospace',F.textAlign="center",F.textBaseline="top",F.fillText("Defocus (μm)",Q+q/2,$+G+30),F.save(),F.translate(16,$+G/2),F.rotate(-Math.PI/2),F.textAlign="center",F.textBaseline="middle",F.fillText("CD (nm)",0,0),F.restore(),F.fillStyle="#e6edf3",F.font='12px "SF Mono", "Cascadia Code", "Fira Code", monospace',F.textAlign="center",F.textBaseline="top",F.fillText("Bossung Curves",Q+q/2,12);let k=Q+q+16,M=$+4;F.font='10px "SF Mono", "Cascadia Code", "Fira Code", monospace',F.textAlign="left",F.textBaseline="middle";for(let O=0;O<_.curves.length;O++){let V=J1[O%J1.length],S=_.doseValues[O];F.strokeStyle=V,F.lineWidth=2,F.beginPath(),F.moveTo(k,M),F.lineTo(k+18,M),F.stroke(),F.fillStyle="#8b949e",F.fillText(`D=${S.toFixed(2)}`,k+24,M),M+=18}}}function h1(_,D,F){let A=D-_;if(A<=0)return[_];let J=A/F,U=Math.pow(10,Math.floor(Math.log10(J))),T,Q=J/U;if(Q<=1.5)T=U;else if(Q<=3.5)T=2*U;else if(Q<=7.5)T=5*U;else T=10*U;let $=[],q=Math.ceil(_/T)*T;for(let G=q;G<=D+T*0.01;G+=T)$.push(Math.round(G/T)*T);return $}function P2(_,D){let F=0;for(let A=0;A<D;A++)F=F<<1|_&1,_>>=1;return F}function H2(_){let D=Math.log2(_)|0,F=new Uint32Array(_);for(let A=0;A<_;A++)F[A]=P2(A,D);return F}var f1=new Map,g1=new Map;function Z2(_){let D=f1.get(_);if(!D)D=H2(_),f1.set(_,D);return D}function Y2(_,D){let F=`${_}_${D?1:0}`,A=g1.get(F);if(!A){let J=_*2;A=new Float64Array(_*2);let T=(D?1:-1)*Math.PI/_;for(let Q=0;Q<_;Q++){let $=T*Q;A[Q*2]=Math.cos($),A[Q*2+1]=Math.sin($)}g1.set(F,A)}return A}function m1(_,D,F,A=0,J=1){let U=Math.log2(D)|0,T=Z2(D);if(J===1&&A===0)for(let Q=0;Q<D;Q++){let $=T[Q];if($>Q){let q=Q*2,G=$*2,K=_[q];_[q]=_[G],_[G]=K,K=_[q+1],_[q+1]=_[G+1],_[G+1]=K}}else{let Q=new Float64Array(D*2);for(let $=0;$<D;$++){let q=(A+$*J)*2,G=T[$]*2;Q[G]=_[q],Q[G+1]=_[q+1]}for(let $=0;$<D;$++){let q=(A+$*J)*2;_[q]=Q[$*2],_[q+1]=Q[$*2+1]}}for(let Q=1;Q<=U;Q++){let $=1<<Q,q=$>>1,G=Y2(q,F);for(let K=0;K<D;K+=$)for(let P=0;P<q;P++){let H=(A+(K+P)*J)*2,L=(A+(K+P+q)*J)*2,X=G[P*2],W=G[P*2+1],j=_[L],w=_[L+1],k=X*j-W*w,M=X*w+W*j,O=_[H],V=_[H+1];_[H]=O+k,_[H+1]=V+M,_[L]=O-k,_[L+1]=V-M}}if(F){let Q=1/D;for(let $=0;$<D;$++){let q=(A+$*J)*2;_[q]*=Q,_[q+1]*=Q}}}function Z1(_,D,F){let A=new Float64Array(D*2);for(let U=0;U<D;U++){let T=U*D*2;A.set(_.subarray(T,T+D*2)),m1(A,D,F),_.set(A,T)}let J=new Float64Array(D*2);for(let U=0;U<D;U++){for(let T=0;T<D;T++)J[T*2]=_[(T*D+U)*2],J[T*2+1]=_[(T*D+U)*2+1];m1(J,D,F);for(let T=0;T<D;T++)_[(T*D+U)*2]=J[T*2],_[(T*D+U)*2+1]=J[T*2+1]}}function Y1(_,D){let F=D>>1;for(let A=0;A<F;A++)for(let J=0;J<D;J++){let U=A+F,T=(J+F)%D,Q=(A*D+J)*2,$=(U*D+T)*2,q=_[Q];_[Q]=_[$],_[$]=q,q=_[Q+1],_[Q+1]=_[$+1],_[$+1]=q}}function c1(_,D,F){let{wavelength:A,na:J,sigma:U,defocus:T,zernike:Q}=F,$=19.53125,q=1/(D*19.53125),K=J*(1+U)/A,P=K*K,H=T*1000,L=Math.PI*A*H,X=Q.z4!==0||Q.z5!==0||Q.z6!==0||Q.z7!==0||Q.z8!==0||Q.z9!==0||Q.z10!==0||Q.z11!==0,W=2*Math.PI,j=D>>1;for(let w=0;w<D;w++){let k=(w-j)*q,M=k*k;for(let O=0;O<D;O++){let V=(O-j)*q,S=V*V+M,R=(w*D+O)*2;if(S>P)_[R]=0,_[R+1]=0;else{let b=H!==0?L*S:0;if(X){let x=Math.sqrt(S)/K,f=Math.atan2(k,V);b+=W*O1(x,f,Q)}if(b!==0){let B=Math.cos(b),x=Math.sin(b),f=_[R],z=_[R+1];_[R]=f*B-z*x,_[R+1]=f*x+z*B}}}}}var i=256,s=i*i,Q1=null;function X2(){if(!Q1||Q1.length!==s*2)Q1=new Float64Array(s*2);return Q1}function $1(_,D){let F=performance.now(),A=X2();for(let Q=0;Q<s;Q++)A[Q*2]=_[Q],A[Q*2+1]=0;Z1(A,i,!1),Y1(A,i),c1(A,i,D),Y1(A,i),Z1(A,i,!0);let J=new Float32Array(s),U=0;for(let Q=0;Q<s;Q++){let $=A[Q*2],q=A[Q*2+1],G=$*$+q*q;if(J[Q]=G,G>U)U=G}if(U>0){let Q=1/U;for(let $=0;$<s;$++)J[$]*=Q}let T=performance.now()-F;return{intensity:J,timeMs:T}}var t=256,j2=19.53125;function u1(_,D,F){if(F===1)return[(_+D)/2];let A=[];for(let J=0;J<F;J++)A.push(_+(D-_)*J/(F-1));return A}function O2(_,D){let A=(t>>1)*t,J=0,U=-1,T=-1;for(let Q=0;Q<=t;Q++){let $=Q<t&&_[A+Q]*D>=1;if($&&T<0)T=Q;else if(!$&&T>=0){let q=Q-T,G=T+q/2;if(q>J||q===J&&Math.abs(G-t/2)<Math.abs(U-t/2))J=q,U=G;T=-1}}return J*j2}function p1(_,D,F){let A=performance.now(),J=u1(F.focusRange[0],F.focusRange[1],F.focusSteps),U=u1(F.doseRange[0],F.doseRange[1],F.doseSteps),T=U.map(($)=>({dose:$,points:[]}));for(let $ of J){let q={...D,defocus:$},G=$1(_,q);for(let K=0;K<U.length;K++){let P=O2(G.intensity,U[K]);T[K].points.push({focus:$,cd:P})}}let Q=performance.now()-A;return{curves:T,focusValues:J,doseValues:U,timeMs:Q,pipelineRuns:J.length}}function d1(){let _=document.getElementById("app"),D=j1(_),{maskPanel:F,heatmapCanvas:A,resistCanvas:J,crossSectionCanvas:U,crossSectionLine:T,heatmapWrap:Q,paramsPanel:$,timingReadout:q,zoomSlider:G,zoomInBtn:K,zoomOutBtn:P,zoomLabel:H,heatmapContainer:L,downloadBtn:X,bossungCanvas:W,bossungChartContainer:j,setVizMode:w}=D,k=y1(F),M=document.createElement("div");$.insertBefore(M,$.firstChild),C1(M,(Z)=>{A.style.width=Z+"px",A.style.height=Z+"px",J.style.width=Z+"px",J.style.height=Z+"px"});let O=document.createElement("div");O.style.padding="10px 0",$.insertBefore(O,q),B1(O);let V=document.createElement("div");V.style.padding="10px 0",V.style.borderTop="1px solid var(--border)",$.insertBefore(V,q);let S=x1(V),R=document.createElement("div");$.insertBefore(R,q);let b=new H1(W),B=b1(R,(Z)=>{B.setRunning(!0),setTimeout(()=>{let I=m(),v=p1(I.mask,I.params,Z);b.draw(v),B.setTiming(v.timeMs,v.pipelineRuns),B.setRunning(!1),w("bossung"),x=!1},0)}),x=!1;D.onVizModeChange=(Z)=>{if(Z==="bossung"&&!x)x=!0,B.run()};let f=new G1(A),z=new K1(J),c=new P1(U,540,140),u=document.getElementById("timing-sim"),p=document.getElementById("timing-render");W1((Z)=>{let I=$1(Z.mask,Z.params);u.textContent=I.timeMs.toFixed(1);let v=performance.now();f.draw(I.intensity),z.draw(I.intensity,Z.viewParams.threshold),c.draw(I.intensity,Z.viewParams.crossSectionRow,Z.viewParams.threshold);let h=performance.now()-v;p.textContent=h.toFixed(1);let d=Z.viewParams.crossSectionRow/255;T.style.top=d*100+"%"});let Y=0;function E(Z){if(Y===0)Y=A.offsetWidth;if(Z===1)A.style.width="",A.style.height="",A.style.maxWidth="",A.style.maxHeight="",A.style.minWidth="",A.style.minHeight="",J.style.width="",J.style.height="",J.style.maxWidth="",J.style.maxHeight="",J.style.minWidth="",J.style.minHeight="";else{let I=Y*Z;A.style.width=`${I}px`,A.style.height=`${I}px`,A.style.maxWidth="none",A.style.maxHeight="none",A.style.minWidth=`${I}px`,A.style.minHeight=`${I}px`,J.style.width=`${I}px`,J.style.height=`${I}px`,J.style.maxWidth="none",J.style.maxHeight="none",J.style.minWidth=`${I}px`,J.style.minHeight=`${I}px`}H.textContent=`${Math.round(Z*100)}%`,G.value=String(Z)}G.addEventListener("input",()=>{E(parseFloat(G.value))}),P.addEventListener("click",()=>{let Z=Math.max(0.5,parseFloat(G.value)-0.1);E(Math.round(Z*10)/10)}),K.addEventListener("click",()=>{let Z=Math.min(4,parseFloat(G.value)+0.1);E(Math.round(Z*10)/10)}),X.addEventListener("click",()=>{let Z=document.createElement("a"),I=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Z.download=`lithography-simulation-${I}.png`,Z.href=A.toDataURL("image/png"),Z.click()});let C=F.querySelector(".preset-btn");if(C)C.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",d1);else d1();
