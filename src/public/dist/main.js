function F1(F){F.innerHTML="";let U=document.createElement("div");U.className="header";let _=document.createElement("h1");_.textContent="Lithography Simulator";let G=document.createElement("span");G.className="subtitle",G.textContent="Fourier Optics / Aerial Image",U.append(_,G);let A=document.createElement("div");A.className="panel";let Q=document.createElement("div");Q.className="panel panel-heatmap";let J=document.createElement("div");J.className="heatmap-container";let D=document.createElement("canvas");J.appendChild(D),Q.appendChild(J);let Z=document.createElement("div");Z.className="panel panel-params";let $=document.createElement("div");$.className="panel-title",$.textContent="Parameters",Z.appendChild($);let K=document.createElement("div");return K.className="timing-readout",K.innerHTML=`
    FFT + Pupil: <span class="value" id="timing-sim">—</span> ms<br>
    Render: <span class="value" id="timing-render">—</span> ms
  `,Z.appendChild(K),F.append(U,A,Q,Z),{maskPanel:A,heatmapCanvas:D,paramsPanel:Z,timingReadout:K}}var G1=[],s=!1,f={mask:new Float32Array(65536),params:{wavelength:248,na:0.75,sigma:0.5,defocus:0}};function A1(){if(s)return;s=!0,requestAnimationFrame(()=>{s=!1;for(let F of G1)F(f)})}function S(){return f}function D1(F){G1.push(F)}function g(F){f.mask=F,A1()}function _1(F,U){f.params[F]=U,A1()}function o(){return new Float32Array(65536)}function W1(){let F=o(),U=10,_=5;for(let G=0;G<256;G++)for(let A=0;A<256;A++)if(A%10<5)F[G*256+A]=1;return F}function O1(){let F=o(),U=20,_=6,G=Math.floor(7);for(let A=0;A<256;A++)for(let Q=0;Q<256;Q++){let J=A%20,D=Q%20;if(J>=G&&J<G+6&&D>=G&&D<G+6)F[A*256+Q]=1}return F}function C1(){let F=o(),U=6,_=125,G=131;for(let A=0;A<256;A++)for(let Q=125;Q<131;Q++)F[A*256+Q]=1;return F}function T1(){let F=o(),U=5,_=2;for(let G=0;G<256;G++)for(let A=0;A<256;A++)if(A%5<2)F[G*256+A]=1;return F}function I1(){let F=o(),U=128,_=128,G=60,A=10;for(let Q=0;Q<256;Q++)for(let J=0;J<256;J++){let D=Q-128,Z=J-128,$=Z>=0&&Z<60&&D>=-5&&D<5,K=D>=0&&D<60&&Z>=-5&&Z<5;if($||K)F[Q*256+J]=1}return F}var J1=[{name:"line_space",label:"Line/Space (10px)",generate:W1},{name:"contacts",label:"Contact Holes",generate:O1},{name:"isolated_line",label:"Isolated Line",generate:C1},{name:"dense_lines",label:"Dense Lines (5px)",generate:T1},{name:"l_shape",label:"L-Shape Corner",generate:I1}];var V=256;function M1(F,U){let _=U/2,G=[],A=Math.floor(U/2);switch(F){case"square":for(let Q=-A;Q<=A;Q++)for(let J=-A;J<=A;J++)G.push([J,Q]);break;case"circle":for(let Q=-A;Q<=A;Q++)for(let J=-A;J<=A;J++)if(J*J+Q*Q<=_*_)G.push([J,Q]);break;case"ring":{let Q=_*0.6;for(let J=-A;J<=A;J++)for(let D=-A;D<=A;D++){let Z=D*D+J*J;if(Z<=_*_&&Z>=Q*Q)G.push([D,J])}break}case"cross":{let Q=Math.max(1,Math.floor(U/6));for(let J=-A;J<=A;J++)for(let D=-A;D<=A;D++)if(Math.abs(D)<=Q||Math.abs(J)<=Q)G.push([D,J]);break}case"lineH":{let Q=Math.max(1,Math.floor(U/6));for(let J=-Q;J<=Q;J++)for(let D=-A;D<=A;D++)G.push([D,J]);break}case"lineV":{let Q=Math.max(1,Math.floor(U/6));for(let J=-A;J<=A;J++)for(let D=-Q;D<=Q;D++)G.push([D,J]);break}}return G}var P1=[{key:"square",label:"Square"},{key:"circle",label:"Circle"},{key:"ring",label:"Ring"},{key:"cross",label:"Cross"},{key:"lineH",label:"Line H"},{key:"lineV",label:"Line V"}];function Q1(F){let U=document.createElement("div");U.className="panel-title",U.textContent="Mask Editor",F.appendChild(U);let _=document.createElement("div");_.className="panel-mask",F.appendChild(_);let G=document.createElement("div");G.className="mask-canvas-wrap";let A=document.createElement("canvas");A.width=V,A.height=V,G.appendChild(A),_.appendChild(G);let Q=A.getContext("2d"),J="brush",D="square",Z=20,$=!1,K=1;function H(){let X=S().mask,Y=Q.createImageData(V,V),C=Y.data;for(let j=0;j<V*V;j++){let R=X[j]>0?255:0;C[j*4]=R,C[j*4+1]=R,C[j*4+2]=R,C[j*4+3]=255}Q.putImageData(Y,0,0)}function E(X){let Y=A.getBoundingClientRect(),C=V/Y.width,j=V/Y.height,R=Math.floor((X.clientX-Y.left)*C),y=Math.floor((X.clientY-Y.top)*j);return[Math.max(0,Math.min(V-1,R)),Math.max(0,Math.min(V-1,y))]}function L(X,Y,C){for(let j=-1;j<=1;j++)for(let R=-1;R<=1;R++){let y=X+R,k=Y+j;if(y>=0&&y<V&&k>=0&&k<V)C[k*V+y]=K}}function T(X,Y,C){let j=M1(D,Z);for(let[R,y]of j){let k=X+R,i=Y+y;if(k>=0&&k<V&&i>=0&&i<V)C[i*V+k]=K}}function W(X){let[Y,C]=E(X),j=S().mask;if(J==="stamp")T(Y,C,j);else L(Y,C,j);H(),g(j)}A.addEventListener("mousedown",(X)=>{$=!0,K=X.button===2?0:1,W(X)}),A.addEventListener("mousemove",(X)=>{if($)W(X)}),A.addEventListener("mouseup",()=>{$=!1}),A.addEventListener("mouseleave",()=>{$=!1}),A.addEventListener("contextmenu",(X)=>X.preventDefault());let I=document.createElement("div");I.className="tool-toggle";let q=document.createElement("button");q.textContent="BRUSH",q.classList.add("active");let O=document.createElement("button");O.textContent="STAMP";function w(X){J=X,q.classList.toggle("active",X==="brush"),O.classList.toggle("active",X==="stamp"),P.style.display=X==="stamp"?"":"none"}q.addEventListener("click",()=>w("brush")),O.addEventListener("click",()=>w("stamp")),I.append(q,O),_.appendChild(I);let P=document.createElement("div");P.className="stamp-options",P.style.display="none";let M=document.createElement("div");M.className="stamp-shape-row";let B=[];for(let X of P1){let Y=document.createElement("button");if(Y.className="stamp-btn",Y.textContent=X.label,X.key===D)Y.classList.add("active");Y.addEventListener("click",()=>{D=X.key,B.forEach((C)=>C.classList.remove("active")),Y.classList.add("active")}),B.push(Y),M.appendChild(Y)}P.appendChild(M);let x=document.createElement("div");x.className="param-group";let c=document.createElement("div");c.className="param-label";let h=document.createElement("span");h.className="param-name",h.textContent="Stamp Size";let u=document.createElement("span");u.className="param-value",u.textContent=String(Z),c.append(h,u);let v=document.createElement("input");v.type="range",v.min="4",v.max="60",v.value=String(Z),v.addEventListener("input",()=>{Z=Number(v.value),u.textContent=String(Z)}),x.append(c,v),P.appendChild(x),_.appendChild(P);let n=document.createElement("div");n.className="preset-buttons";let m=null;for(let X of J1){let Y=document.createElement("button");Y.className="preset-btn",Y.textContent=X.label,Y.addEventListener("click",()=>{let C=X.generate();if(g(C),H(),m)m.classList.remove("active");Y.classList.add("active"),m=Y}),n.appendChild(Y)}_.appendChild(n);let r=document.createElement("div");r.className="mask-tools";let l=document.createElement("button");l.textContent="CLEAR",l.addEventListener("click",()=>{if(g(new Float32Array(V*V)),H(),m)m.classList.remove("active");m=null});let d=document.createElement("button");return d.textContent="INVERT",d.addEventListener("click",()=>{let X=S().mask;for(let Y=0;Y<V*V;Y++)X[Y]=X[Y]>0?0:1;g(X),H()}),r.append(l,d),_.appendChild(r),H(),{setDisplaySize(X){A.style.width=X+"px",A.style.height=X+"px"}}}var t=[{label:"S",size:192},{label:"M",size:384},{label:"L",size:512},{label:"XL",size:768}];function R1(F){if(!Number.isFinite(F))return 128;return Math.round(Math.max(128,Math.min(768,F)))}function Z1(F,U){let _=document.createElement("div");_.className="canvas-size-controls";let G=document.createElement("div");G.className="param-group";let A=document.createElement("div");A.className="param-label";let Q=document.createElement("span");Q.className="param-name",Q.textContent="Canvas Size";let J=document.createElement("span");J.className="param-value";let D=document.createElement("span");D.className="param-unit",D.textContent="px";let Z=document.createElement("span");Z.append(J,D),A.append(Q,Z);let $=document.createElement("input");$.type="range",$.min=String(128),$.max=String(768),$.step="1",$.value=String(384),G.append(A,$),_.appendChild(G);let K=document.createElement("div");K.className="size-preset-row";let H=[];for(let I of t){let q=document.createElement("button");q.className="stamp-btn",q.textContent=I.label,q.addEventListener("click",()=>W(I.size)),H.push(q),K.appendChild(q)}_.appendChild(K);let E=document.createElement("div");E.className="size-input-row";let L=document.createElement("input");L.type="number",L.className="size-text-input",L.min=String(128),L.max=String(768),L.value=String(384);let T=document.createElement("span");T.className="param-unit",T.textContent="px",L.addEventListener("change",()=>{W(Number(L.value))}),E.append(L,T),_.appendChild(E),F.appendChild(_);function W(I){let q=R1(I);$.value=String(q),J.textContent=String(q),L.value=String(q);for(let O=0;O<t.length;O++)H[O].classList.toggle("active",t[O].size===q);U(q)}$.addEventListener("input",()=>{W(Number($.value))}),W(384)}var w1=[{key:"wavelength",label:"Wavelength",unit:"nm",min:193,max:365,step:1,decimals:0},{key:"na",label:"NA",unit:"",min:0.1,max:1.4,step:0.01,decimals:2},{key:"sigma",label:"Sigma (σ)",unit:"",min:0,max:1,step:0.01,decimals:2},{key:"defocus",label:"Defocus",unit:"μm",min:-2,max:2,step:0.01,decimals:2}];function $1(F){for(let U of w1){let _=document.createElement("div");_.className="param-group";let G=document.createElement("div");G.className="param-label";let A=document.createElement("span");A.className="param-name",A.textContent=U.label;let Q=document.createElement("span"),J=document.createElement("span");J.className="param-value";let D=document.createElement("span");D.className="param-unit",D.textContent=U.unit,Q.append(J,D),G.append(A,Q);let Z=document.createElement("input");Z.type="range",Z.min=String(U.min),Z.max=String(U.max),Z.step=String(U.step),Z.value=String(S().params[U.key]);let $=(K)=>{J.textContent=K.toFixed(U.decimals)};$(S().params[U.key]),Z.addEventListener("input",()=>{let K=parseFloat(Z.value);$(K),_1(U.key,K)}),_.append(G,Z),F.appendChild(_)}}var K1=`#version 300 es
precision highp float;

// Fullscreen triangle trick — 3 vertices, no buffers needed
const vec2 positions[3] = vec2[3](
  vec2(-1.0, -1.0),
  vec2( 3.0, -1.0),
  vec2(-1.0,  3.0)
);

out vec2 vUV;

void main() {
  vec2 pos = positions[gl_VertexID];
  vUV = pos * 0.5 + 0.5;
  gl_Position = vec4(pos, 0.0, 1.0);
}
`,X1=`#version 300 es
precision highp float;

uniform sampler2D uIntensity;  // R32F intensity data
uniform sampler2D uColormap;   // 256x1 RGBA viridis lookup

in vec2 vUV;
out vec4 fragColor;

void main() {
  float val = texture(uIntensity, vUV).r;
  val = clamp(val, 0.0, 1.0);
  fragColor = texture(uColormap, vec2(val, 0.5));
}
`;var B1=[[68,1,84],[68,2,86],[69,4,87],[69,5,89],[70,7,90],[70,8,92],[70,10,93],[70,11,94],[71,13,96],[71,14,97],[71,16,99],[71,17,100],[71,19,101],[72,20,103],[72,22,104],[72,23,105],[72,24,106],[72,26,108],[72,27,109],[72,28,110],[72,29,111],[72,31,112],[72,32,113],[72,33,115],[72,35,116],[72,36,117],[72,37,118],[72,38,119],[72,40,120],[72,41,121],[71,42,122],[71,44,122],[71,45,123],[71,46,124],[71,47,125],[70,48,126],[70,50,126],[70,51,127],[69,52,128],[69,53,129],[69,55,129],[68,56,130],[68,57,131],[68,58,131],[67,60,132],[67,61,132],[66,62,133],[66,63,133],[66,64,134],[65,66,134],[65,67,135],[64,68,135],[64,69,136],[63,71,136],[63,72,137],[62,73,137],[62,74,137],[62,76,138],[61,77,138],[61,78,138],[60,79,139],[60,80,139],[59,82,139],[59,83,140],[58,84,140],[58,85,140],[57,86,140],[57,87,141],[56,88,141],[56,90,141],[55,91,141],[55,92,141],[54,93,141],[54,94,142],[53,95,142],[53,96,142],[52,97,142],[52,98,142],[51,99,142],[51,100,142],[50,101,142],[50,102,142],[49,103,142],[49,104,142],[49,105,142],[48,106,142],[48,107,142],[47,108,142],[47,109,142],[46,110,142],[46,111,142],[46,112,142],[45,113,142],[45,114,142],[44,115,142],[44,116,141],[44,117,141],[43,118,141],[43,119,141],[42,120,141],[42,121,141],[42,122,141],[41,123,140],[41,124,140],[40,125,140],[40,126,140],[40,127,140],[39,128,139],[39,129,139],[39,130,139],[38,131,139],[38,132,139],[37,133,138],[37,134,138],[37,135,138],[36,136,138],[36,137,137],[36,138,137],[35,139,137],[35,140,136],[35,141,136],[34,142,136],[34,143,135],[34,144,135],[33,145,135],[33,146,134],[33,147,134],[33,148,133],[32,149,133],[32,150,133],[32,151,132],[32,152,132],[31,153,131],[31,154,131],[31,155,130],[31,156,130],[31,157,129],[31,158,129],[30,159,128],[30,160,128],[30,161,127],[30,162,127],[30,163,126],[30,164,126],[30,165,125],[30,166,124],[30,167,124],[31,168,123],[31,169,123],[31,170,122],[31,171,121],[31,172,121],[32,173,120],[32,174,119],[33,175,119],[33,176,118],[33,177,117],[34,178,117],[34,179,116],[35,180,115],[35,181,114],[36,182,114],[36,183,113],[37,184,112],[38,185,111],[38,186,111],[39,187,110],[40,188,109],[41,189,108],[41,190,107],[42,191,106],[43,192,106],[44,193,105],[45,194,104],[46,195,103],[47,196,102],[48,197,101],[49,198,100],[50,199,99],[52,200,98],[53,201,97],[54,202,96],[56,203,95],[57,204,94],[59,205,93],[60,206,92],[62,207,91],[63,208,90],[65,209,89],[67,210,87],[68,210,86],[70,211,85],[72,212,84],[74,213,83],[75,214,81],[77,214,80],[79,215,79],[81,216,78],[83,217,76],[85,217,75],[87,218,74],[89,219,72],[91,219,71],[93,220,70],[95,221,68],[97,221,67],[99,222,65],[101,222,64],[104,223,63],[106,223,61],[108,224,60],[110,224,58],[112,225,57],[115,225,55],[117,226,54],[119,226,52],[121,227,51],[124,227,49],[126,228,48],[128,228,46],[131,229,45],[133,229,43],[135,229,42],[138,230,40],[140,230,39],[142,231,37],[145,231,36],[147,231,34],[150,232,33],[152,232,31],[155,232,30],[157,233,28],[159,233,27],[162,233,25],[164,234,24],[167,234,23],[169,234,21],[172,235,20],[174,235,19],[177,235,18],[179,235,17],[182,236,16],[184,236,15],[187,236,14],[189,236,14],[192,237,13],[194,237,13],[197,237,13],[199,237,13],[201,237,13],[204,238,14],[206,238,14],[209,238,15],[211,238,16],[213,238,17],[216,239,18]];function Y1(){let F=new Uint8Array(1024);for(let U=0;U<256;U++){let _=B1[U];F[U*4+0]=_[0],F[U*4+1]=_[1],F[U*4+2]=_[2],F[U*4+3]=255}return F}var b=256;class e{gl;program;intensityTex;colormapTex;vao;constructor(F){F.width=b,F.height=b;let U=F.getContext("webgl2",{antialias:!1,alpha:!1,premultipliedAlpha:!1});if(!U)throw Error("WebGL2 not supported");this.gl=U;let _=U.getExtension("EXT_color_buffer_float");this.program=this.createProgram(K1,X1),this.vao=U.createVertexArray(),this.intensityTex=U.createTexture(),U.bindTexture(U.TEXTURE_2D,this.intensityTex),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texImage2D(U.TEXTURE_2D,0,U.R32F,b,b,0,U.RED,U.FLOAT,null),this.colormapTex=U.createTexture(),U.bindTexture(U.TEXTURE_2D,this.colormapTex),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE);let G=Y1();U.texImage2D(U.TEXTURE_2D,0,U.RGBA,256,1,0,U.RGBA,U.UNSIGNED_BYTE,G),U.useProgram(this.program),U.uniform1i(U.getUniformLocation(this.program,"uIntensity"),0),U.uniform1i(U.getUniformLocation(this.program,"uColormap"),1)}draw(F){let U=this.gl;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,this.intensityTex),U.texSubImage2D(U.TEXTURE_2D,0,0,0,b,b,U.RED,U.FLOAT,F),U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,this.colormapTex),U.useProgram(this.program),U.bindVertexArray(this.vao),U.viewport(0,0,b,b),U.drawArrays(U.TRIANGLES,0,3)}resize(F,U){}createProgram(F,U){let _=this.gl,G=this.compileShader(_.VERTEX_SHADER,F),A=this.compileShader(_.FRAGMENT_SHADER,U),Q=_.createProgram();if(_.attachShader(Q,G),_.attachShader(Q,A),_.linkProgram(Q),!_.getProgramParameter(Q,_.LINK_STATUS)){let J=_.getProgramInfoLog(Q);throw _.deleteProgram(Q),Error("Shader link error: "+J)}return _.deleteShader(G),_.deleteShader(A),Q}compileShader(F,U){let _=this.gl,G=_.createShader(F);if(_.shaderSource(G,U),_.compileShader(G),!_.getShaderParameter(G,_.COMPILE_STATUS)){let A=_.getShaderInfoLog(G);throw _.deleteShader(G),Error("Shader compile error: "+A)}return G}}function b1(F,U){let _=0;for(let G=0;G<U;G++)_=_<<1|F&1,F>>=1;return _}function u1(F){let U=Math.log2(F)|0,_=new Uint32Array(F);for(let G=0;G<F;G++)_[G]=b1(G,U);return _}var H1=new Map,q1=new Map;function v1(F){let U=H1.get(F);if(!U)U=u1(F),H1.set(F,U);return U}function y1(F,U){let _=`${F}_${U?1:0}`,G=q1.get(_);if(!G){let A=F*2;G=new Float64Array(F*2);let J=(U?1:-1)*Math.PI/F;for(let D=0;D<F;D++){let Z=J*D;G[D*2]=Math.cos(Z),G[D*2+1]=Math.sin(Z)}q1.set(_,G)}return G}function E1(F,U,_,G=0,A=1){let Q=Math.log2(U)|0,J=v1(U);if(A===1&&G===0)for(let D=0;D<U;D++){let Z=J[D];if(Z>D){let $=D*2,K=Z*2,H=F[$];F[$]=F[K],F[K]=H,H=F[$+1],F[$+1]=F[K+1],F[K+1]=H}}else{let D=new Float64Array(U*2);for(let Z=0;Z<U;Z++){let $=(G+Z*A)*2,K=J[Z]*2;D[K]=F[$],D[K+1]=F[$+1]}for(let Z=0;Z<U;Z++){let $=(G+Z*A)*2;F[$]=D[Z*2],F[$+1]=D[Z*2+1]}}for(let D=1;D<=Q;D++){let Z=1<<D,$=Z>>1,K=y1($,_);for(let H=0;H<U;H+=Z)for(let E=0;E<$;E++){let L=(G+(H+E)*A)*2,T=(G+(H+E+$)*A)*2,W=K[E*2],I=K[E*2+1],q=F[T],O=F[T+1],w=W*q-I*O,P=W*O+I*q,M=F[L],B=F[L+1];F[L]=M+w,F[L+1]=B+P,F[T]=M-w,F[T+1]=B-P}}if(_){let D=1/U;for(let Z=0;Z<U;Z++){let $=(G+Z*A)*2;F[$]*=D,F[$+1]*=D}}}function a(F,U,_){let G=new Float64Array(U*2);for(let Q=0;Q<U;Q++){let J=Q*U*2;G.set(F.subarray(J,J+U*2)),E1(G,U,_),F.set(G,J)}let A=new Float64Array(U*2);for(let Q=0;Q<U;Q++){for(let J=0;J<U;J++)A[J*2]=F[(J*U+Q)*2],A[J*2+1]=F[(J*U+Q)*2+1];E1(A,U,_);for(let J=0;J<U;J++)F[(J*U+Q)*2]=A[J*2],F[(J*U+Q)*2+1]=A[J*2+1]}}function U1(F,U){let _=U>>1;for(let G=0;G<_;G++)for(let A=0;A<U;A++){let Q=G+_,J=(A+_)%U,D=(G*U+A)*2,Z=(Q*U+J)*2,$=F[D];F[D]=F[Z],F[Z]=$,$=F[D+1],F[D+1]=F[Z+1],F[Z+1]=$}}function L1(F,U,_){let{wavelength:G,na:A,sigma:Q,defocus:J}=_,D=19.53125,Z=1/(U*19.53125),K=A*(1+Q)/G,H=K*K,E=J*1000,L=Math.PI*G*E,T=U>>1;for(let W=0;W<U;W++){let I=(W-T)*Z,q=I*I;for(let O=0;O<U;O++){let w=(O-T)*Z,P=w*w+q,M=(W*U+O)*2;if(P>H)F[M]=0,F[M+1]=0;else if(E!==0){let B=L*P,x=Math.cos(B),c=Math.sin(B),h=F[M],u=F[M+1];F[M]=h*x-u*c,F[M+1]=h*c+u*x}}}}var z=256,N=z*z,p=null;function k1(){if(!p||p.length!==N*2)p=new Float64Array(N*2);return p}function V1(F,U){let _=performance.now(),G=k1();for(let D=0;D<N;D++)G[D*2]=F[D],G[D*2+1]=0;a(G,z,!1),U1(G,z),L1(G,z,U),U1(G,z),a(G,z,!0);let A=new Float32Array(N),Q=0;for(let D=0;D<N;D++){let Z=G[D*2],$=G[D*2+1],K=Z*Z+$*$;if(A[D]=K,K>Q)Q=K}if(Q>0){let D=1/Q;for(let Z=0;Z<N;Z++)A[Z]*=D}let J=performance.now()-_;return{intensity:A,timeMs:J}}function j1(){let F=document.getElementById("app"),{maskPanel:U,heatmapCanvas:_,paramsPanel:G,timingReadout:A}=F1(F),Q=Q1(U),J=document.createElement("div");G.insertBefore(J,G.firstChild),Z1(J,(E)=>{_.style.width=E+"px",_.style.height=E+"px"});let D=document.createElement("div");D.style.padding="10px 0",G.insertBefore(D,A),$1(D);let Z=new e(_),$=document.getElementById("timing-sim"),K=document.getElementById("timing-render");D1((E)=>{let L=V1(E.mask,E.params);$.textContent=L.timeMs.toFixed(1);let T=performance.now();Z.draw(L.intensity);let W=performance.now()-T;K.textContent=W.toFixed(1)});let H=U.querySelector(".preset-btn");if(H)H.click()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",j1);else j1();
